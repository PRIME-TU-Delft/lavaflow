import{w as S}from"./index-aa581d55.js";import{D as R}from"./draggable-10e2ef03.js";let r;const A=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});A.decode();let w=null;function h(){return(w===null||w.buffer!==r.memory.buffer)&&(w=new Uint8Array(r.memory.buffer)),w}function u(o,t){return A.decode(h().subarray(o,o+t))}const p=new Array(32).fill(void 0);p.push(void 0,null,!0,!1);let f=p.length;function g(o){f===p.length&&p.push(p.length+1);const t=f;return f=p[t],p[t]=o,t}function U(o){return p[o]}function E(o){o<36||(p[o]=f,f=o)}function l(o){const t=U(o);return E(o),t}let O=0;const y=new TextEncoder("utf-8"),I=typeof y.encodeInto=="function"?function(o,t){return y.encodeInto(o,t)}:function(o,t){const e=y.encode(o);return t.set(e),{read:o.length,written:e.length}};function M(o,t,e){if(e===void 0){const c=y.encode(o),d=t(c.length);return h().subarray(d,d+c.length).set(c),O=c.length,d}let _=o.length,n=t(_);const a=h();let i=0;for(;i<_;i++){const c=o.charCodeAt(i);if(c>127)break;a[n+i]=c}if(i!==_){i!==0&&(o=o.slice(i)),n=e(n,_,_=i+o.length*3);const c=h().subarray(n+i,n+_);i+=I(o,c).written}return O=i,n}let m=null;function s(){return(m===null||m.buffer!==r.memory.buffer)&&(m=new Int32Array(r.memory.buffer)),m}function T(o,t){if(!(o instanceof t))throw new Error(`expected instance of ${t.name}`);return o.ptr}class v{static __wrap(t){const e=Object.create(v.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_altitudegradientpair_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return v.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const _=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_debug(_,this.ptr);var t=s()[_/4+0],e=s()[_/4+1];return u(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_to_js(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class k{static __wrap(t){const e=Object.create(k.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionapi_free(t)}get rows(){return r.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){r.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get border_size(){return r.__wbg_get_modelconstructionapi_border_size(this.ptr)}set border_size(t){r.__wbg_set_modelconstructionapi_border_size(this.ptr,t)}get altitude_step(){return r.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){r.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get svc_distance(){return r.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){r.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return r.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){r.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return r.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){r.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return r.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){r.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=r.modelconstructionapi_new();return k.__wrap(t)}set_basic_parameters(t,e,_){r.modelconstructionapi_set_basic_parameters(this.ptr,t,e,_)}set_svc_parameters(t){r.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){r.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,e){r.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t){T(t,b);var e=t.ptr;t.ptr=0,r.modelconstructionapi_base(this.ptr,e)}build(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_build(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return j.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_get_altitude_and_gradient_for_point(i,this.ptr,t,e);var _=s()[i/4+0],n=s()[i/4+1],a=s()[i/4+2];if(a)throw l(n);return v.__wrap(_)}finally{r.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,e,_,n,a){r.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,_,n,a)}set_altitude_for_layer(t,e,_){r.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,_)}apply_smooth_to_altitude_group(t,e,_,n,a){r.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,_,n,a)}increase_altitude_for_altitude_group(t,e,_){r.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,_)}apply_smooth_to_middle_layers(t,e,_,n){r.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,_,n)}apply_smooth_to_mountain_tops(t,e,_,n){r.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,_,n)}increase_altitude_for_mountain_tops(t,e){r.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,_,n){r.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,_,n)}correct_for_altitude_constraints_to_all_layers(){r.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class j{static __wrap(t){const e=Object.create(j.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionresult_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return j.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const _=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_debug(_,this.ptr);var t=s()[_/4+0],e=s()[_/4+1];return u(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_to_js(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class b{static __wrap(t){const e=Object.create(b.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_opencvtree_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return b.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_debug(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}async function z(o,t){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,t)}catch(_){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await o.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(o,t);return e instanceof WebAssembly.Instance?{instance:e,module:o}:e}}async function W(o){typeof o=="undefined"&&(o="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(n,a){const i=u(n,a);return g(i)},t.wbg.__wbindgen_object_drop_ref=function(n){l(n)},t.wbg.__wbindgen_json_parse=function(n,a){const i=JSON.parse(u(n,a));return g(i)},t.wbg.__wbindgen_json_serialize=function(n,a){const i=U(a),c=JSON.stringify(i===void 0?null:i),d=M(c,r.__wbindgen_malloc,r.__wbindgen_realloc),x=O;s()[n/4+1]=x,s()[n/4+0]=d},t.wbg.__wbindgen_throw=function(n,a){throw new Error(u(n,a))},(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:e,module:_}=await z(await o,t);return r=e.exports,W.__wbindgen_wasm_module=_,r}function L(){const{subscribe:o,update:t}=S([new R(500,500,0)]);return{subscribe:o,add:e=>t(_=>[..._,e]),remove:e=>t(_=>_.filter((n,a)=>a!==e))}}L();function B(o){const t=new Blob([o],{type:"application/json"});return URL.createObjectURL(t)}function D(){const{subscribe:o,set:t}=S("");let e,_=!1,n;return{subscribe:o,set:t,setup:async a=>{_||(await W(),_=!0);const i=new b({pixels_per_curve:a.curves,parent_relations:a.hierarchy});e=new k,e.base(i),e.set_basic_parameters(100,100,0),e.correct_for_altitude_constraints_to_all_layers(),e.apply_smooth_to_layer(0,.7,4,10,!1),e.increase_altitude_for_mountain_tops(.3,!1),e.apply_smooth_to_mountain_tops(.2,2,5,!1)},build:()=>{n=e.build().to_js();const a=B(n.gltf);t(a),console.log(a)},getAlitituteAndGradient:(a,i)=>{if(!e)return console.warn("no api initialized");const c=e.get_altitude_and_gradient_for_point(a,i).to_js();return console.log(c),c}}}const q=D();export{k as M,b as O,q as g,W as i};
