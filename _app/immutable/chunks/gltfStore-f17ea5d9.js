import{w as d}from"./index-b55d7b60.js";import{a as f,t as g}from"./contourLineStore-22a814b1.js";import{d as m}from"./difficultyStore-686b8d7b.js";import{i as w,O as y,M as v,S,a as b,b as x,c as A,L}from"./@vite-plugin-wasm-pack@wasm-9c455baf.js";import{P as c}from"./index-78deb6b4.js";class M{constructor(a,e,n,p,i,t,s,r,l,h,_){this.tree=a,this.rows=e,this.columns=n,this.width=p,this.height=i,this.curve_point_separation=t,this.svc_distance=s,this.catmull_clark_iterations=r,this.lava_path_length=l,this.lava_path_fork_val=h,this.smoothing_operations=_}apply_to_api(a){a.base(this.tree,this.curve_point_separation),a.set_basic_parameters(this.rows,this.columns,this.width,this.height),a.set_svc_parameters(this.svc_distance),a.set_catmull_clark_parameters(this.catmull_clark_iterations),a.set_lava_path_parameters(this.lava_path_length,this.lava_path_fork_val);for(const e of this.smoothing_operations)e.apply_to_api(a)}}function j(o){return o*(180/Math.PI)}function O(o){let a=o.altitude;return a+=1*o.gradient.map(e=>Math.abs(e)).reduce((e,n)=>Math.max(e,n)),a*1.07}function u(o){const a=new Blob([o],{type:"application/json"});return URL.createObjectURL(a)}function z(){const{subscribe:o,set:a}=d();let e,n,p=!1,i;return{subscribe:o,set:a,setup:async(t,s)=>{p||(await w(),p=!0),n=t.size;const r=new y({pixels_per_curve:t.curves,parent_relations:t.hierarchy});e=new v,new M(r,45,45,t.size.width,t.size.height,5,50,1,20,s,[new S(0,.9,5,1,!1),new b(.7,3,5,!1),new x(2,!1),new A(1,8,1,!1)]).apply_to_api(e)},build:t=>{i=e.build().to_js(),i.gltf_url=u(i.gltf),i.lava_gltf_url=u(i.lava_gltf),i.craters=i.craters.map(s=>[s[0]*t.size.width/100,s[1]*t.size.height/100]),f.set(i.craters),a(i)},getAlitituteAndGradient:(t,s=!1)=>{if(!e)return{x:0,y:0,altitude:0,gradient:[0,0,0]};let[r,l]=[t.x,t.y];s||(r=t.x/n.width*100,l=t.y/n.height*100);const h=e.get_altitude_and_gradient_for_point(r,l).to_js();return h.gradient.map(_=>j(_)),h.altitude=O(h),h},computePlayerPoints:t=>{if(!e)return 0;const{width:s,height:r}=n;return e.compute_player_points(new L({lava_paths:i.lava_paths,turbines:c(g).map(l=>[l.x/s*100,l.y/r*100]),max_lava_distance:c(m).max_lava_distance,max_points_total:t}))}}}const k=z();export{k as g};
