import{w as u}from"./index-bcf3c295.js";import{a as d,t as m}from"./contourLineStore-080ee4cb.js";import{d as f}from"./difficultyStore-d15690e4.js";import{i as g,O as w,M as y,S as v,a as S,b,c as x,L as A}from"./@vite-plugin-wasm-pack@wasm-9c455baf.js";import{P as c}from"./index-ca5d62ed.js";class L{constructor(a,e,n,h,i,t,s,r,l,p,_){this.tree=a,this.rows=e,this.columns=n,this.width=h,this.height=i,this.curve_point_separation=t,this.svc_distance=s,this.catmull_clark_iterations=r,this.lava_path_length=l,this.lava_path_fork_val=p,this.smoothing_operations=_}apply_to_api(a){a.base(this.tree,this.curve_point_separation),a.set_basic_parameters(this.rows,this.columns,this.width,this.height),a.set_svc_parameters(this.svc_distance),a.set_catmull_clark_parameters(this.catmull_clark_iterations),a.set_lava_path_parameters(this.lava_path_length,this.lava_path_fork_val);for(const e of this.smoothing_operations)e.apply_to_api(a)}}function M(o){return o*(180/Math.PI)}function j(o){let a=o.altitude;return a+=1*o.gradient.map(e=>Math.abs(e)).reduce((e,n)=>Math.max(e,n)),a*1.07}function O(o){const a=new Blob([o],{type:"application/json"});return URL.createObjectURL(a)}function z(){const{subscribe:o,set:a}=u();let e,n,h=!1,i;return{subscribe:o,set:a,setup:async(t,s)=>{h||(await g(),h=!0),n=t.size;const r=new w({pixels_per_curve:t.curves,parent_relations:t.hierarchy});e=new y,new L(r,45,45,t.size.width,t.size.height,5,50,1,20,s,[new v(0,.9,5,1,!1),new S(.7,3,5,!1),new b(2,!1),new x(1,8,1,!1)]).apply_to_api(e)},build:t=>{i=e.build().to_js(),i.gltf_url=O(i.gltf),i.craters=i.craters.map(s=>[s[0]*t.size.width/100,s[1]*t.size.height/100]),d.set(i.craters),a(i)},getAlitituteAndGradient:(t,s=!1)=>{if(!e)return{x:0,y:0,altitude:0,gradient:[0,0,0]};let[r,l]=[t.x,t.y];s||(r=t.x/n.width*100,l=t.y/n.height*100);const p=e.get_altitude_and_gradient_for_point(r,l).to_js();return p.gradient.map(_=>M(_)),p.altitude=j(p),p},computePlayerPoints:t=>{if(!e)return 0;const{width:s,height:r}=n;return e.compute_player_points(new A({lava_paths:i.lava_paths,turbines:c(m).map(l=>[l.x/s*100,l.y/r*100]),max_lava_distance:c(f).max_lava_distance,max_points_total:t}))}}}const k=z();export{k as g};
