import{w as S}from"./index-082afcc0.js";const y=4;class X{constructor(t,e,r,n=0,i=0){this.dragging=!1,this.enable_selection=!1,this.last_selected=!0,this.drag_translated=!1,this.too_close_to_crater=!1,this.too_close_to_other_target=!1,this.x=t,this.y=e,this.old_x=t,this.old_y=e,this.size=r,this.offsetX=n,this.offsetY=i}enableSelection(){this.enable_selection=!0}disableSelection(){this.enable_selection=!1}update(t,e,r,n,i,_){if(!!this.dragging&&!(t.mouseX<=0||t.mouseY<=0)&&!(t.mouseX>=t.width||t.mouseY>=t.height)){if(this.x=t.mouseX+this.offsetX,this.y=t.mouseY+this.offsetY,this.translateForDragging(),e!=null&&r!=null){this.too_close_to_crater=!1;for(let a=0;a<e.length;a++){let l=e[a][0]-this.x,d=e[a][1]-this.y;if(Math.sqrt(l*l+d*d)<=r){this.too_close_to_crater=!0;break}}}if(n!=null&&i!=null){this.too_close_to_other_target=!1;for(let a=0;a<n.length;a++){if(_!=null&&_==a)continue;let l=n[a].x-this.x,d=n[a].y-this.y;if(Math.sqrt(l*l+d*d)<=i){this.too_close_to_other_target=!0;break}}}}}setPosition(t,e){this.x=t,this.y=e}translateForDragging(){this.dragging&&!this.drag_translated&&(this.y-=50,this.drag_translated=!0)}translateBackAfterDragging(){this.drag_translated&&(this.drag_translated=!1)}displayWarningMessage(t,e){t.noStroke(),t.fill(51),t.textSize(15),t.textAlign(t.CENTER);let r=t.textWidth(e);t.rect(this.x-r/2-5,this.y-35,r+10,20),t.strokeWeight(1),t.fill(255),t.text(e,this.x,this.y-20)}drawRect(t,e){this.translateForDragging(),t.stroke(0),t.fill(255),t.strokeWeight(y),t.rect(this.x-e/2,this.y-e/2,e,e),this.translateBackAfterDragging()}drawCircle(t,e,r){this.translateForDragging(),r!=null&&(t.strokeWeight(.5),t.stroke(0),t.fill(200),t.rect(this.x,this.y-e/2,50,e),t.fill(0),t.textAlign(t.CENTER),t.textSize(15),t.text("#"+r,this.x+30,this.y+5)),t.fill(255),this.enable_selection&&this.last_selected&&t.fill(0,140,220),this.too_close_to_crater?(this.displayWarningMessage(t,"Too close to the crater"),t.fill(255,0,0)):this.too_close_to_other_target&&(this.displayWarningMessage(t,"Too close to another turbine"),t.fill(255,0,0)),t.stroke(0),t.strokeWeight(y),t.ellipse(this.x,this.y,e),this.translateBackAfterDragging()}drawTriangle(t,e){this.translateForDragging(),t.stroke(0),t.fill(255),t.strokeWeight(y),t.triangle(this.x-e/2,this.y+e/2,this.x+e/2,this.y+e/2,this.x,this.y-e/2),this.translateBackAfterDragging()}drawCross(t,e){this.translateForDragging(),t.stroke(0),t.strokeWeight(y*2),t.line(this.x-e/2,this.y-e/2,this.x+e/2,this.y+e/2),t.line(this.x+e/2,this.y-e/2,this.x-e/2,this.y+e/2),this.translateBackAfterDragging()}deselect(){this.last_selected=!1}pressed(t){const e=t.mouseX>this.x-this.size/2&&t.mouseX<this.x+this.size/2,r=t.mouseY>this.y-this.size/2&&t.mouseY<this.y+this.size/2;return e&&r?(this.dragging=!0,this.offsetX=this.x-t.mouseX,this.offsetY=this.y-t.mouseY,this.old_x=this.x,this.old_y=this.y,this.last_selected=!0,!0):!1}released(){this.dragging=!1,this.translateBackAfterDragging(),(this.too_close_to_crater||this.too_close_to_other_target)&&(this.x=this.old_x,this.y=this.old_y,this.too_close_to_crater=!1,this.too_close_to_other_target=!1)}}let s;const B=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});B.decode();let m=null;function x(){return(m===null||m.buffer!==s.memory.buffer)&&(m=new Uint8Array(s.memory.buffer)),m}function f(o,t){return B.decode(x().subarray(o,o+t))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let p=u.length;function L(o){p===u.length&&u.push(u.length+1);const t=p;return p=u[t],u[t]=o,t}function k(o){return u[o]}function Y(o){o<36||(u[o]=p,p=o)}function h(o){const t=k(o);return Y(o),t}let W=0;const j=new TextEncoder("utf-8"),U=typeof j.encodeInto=="function"?function(o,t){return j.encodeInto(o,t)}:function(o,t){const e=j.encode(o);return t.set(e),{read:o.length,written:e.length}};function M(o,t,e){if(e===void 0){const a=j.encode(o),l=t(a.length);return x().subarray(l,l+a.length).set(a),W=a.length,l}let r=o.length,n=t(r);const i=x();let _=0;for(;_<r;_++){const a=o.charCodeAt(_);if(a>127)break;i[n+_]=a}if(_!==r){_!==0&&(o=o.slice(_)),n=e(n,r,r=_+o.length*3);const a=x().subarray(n+_,n+r);_+=U(o,a).written}return W=_,n}let v=null;function c(){return(v===null||v.buffer!==s.memory.buffer)&&(v=new Int32Array(s.memory.buffer)),v}let g=32;function E(o){if(g==1)throw new Error("out of js stack");return u[--g]=o,g}function F(o,t){if(!(o instanceof t))throw new Error(`expected instance of ${t.name}`);return o.ptr}class A{static __wrap(t){const e=Object.create(A.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_altitudegradientpair_free(t)}constructor(t){try{const i=s.__wbindgen_add_to_stack_pointer(-16);s.altitudegradientpair_new(i,E(t));var e=c()[i/4+0],r=c()[i/4+1],n=c()[i/4+2];if(n)throw h(r);return A.__wrap(e)}finally{s.__wbindgen_add_to_stack_pointer(16),u[g++]=void 0}}debug(){try{const r=s.__wbindgen_add_to_stack_pointer(-16);s.altitudegradientpair_debug(r,this.ptr);var t=c()[r/4+0],e=c()[r/4+1];return f(t,e)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,e)}}to_js(){try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.altitudegradientpair_to_js(n,this.ptr);var t=c()[n/4+0],e=c()[n/4+1],r=c()[n/4+2];if(r)throw h(e);return h(t)}finally{s.__wbindgen_add_to_stack_pointer(16)}}}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_modelconstructionapi_free(t)}get rows(){return s.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){s.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return s.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){s.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get width(){return s.__wbg_get_modelconstructionapi_width(this.ptr)}set width(t){s.__wbg_set_modelconstructionapi_width(this.ptr,t)}get height(){return s.__wbg_get_modelconstructionapi_height(this.ptr)}set height(t){s.__wbg_set_modelconstructionapi_height(this.ptr,t)}get altitude_step(){return s.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){s.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get curve_point_separation(){return s.__wbg_get_modelconstructionapi_curve_point_separation(this.ptr)}set curve_point_separation(t){s.__wbg_set_modelconstructionapi_curve_point_separation(this.ptr,t)}get svc_distance(){return s.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){s.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return s.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){s.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return s.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){s.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return s.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){s.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=s.modelconstructionapi_new();return O.__wrap(t)}set_basic_parameters(t,e,r,n){s.modelconstructionapi_set_basic_parameters(this.ptr,t,e,r,n)}set_svc_parameters(t){s.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){s.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,e){s.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t,e){F(t,w);var r=t.ptr;t.ptr=0,s.modelconstructionapi_base(this.ptr,r,e)}build(){try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.modelconstructionapi_build(n,this.ptr);var t=c()[n/4+0],e=c()[n/4+1],r=c()[n/4+2];if(r)throw h(e);return D.__wrap(t)}finally{s.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const _=s.__wbindgen_add_to_stack_pointer(-16);s.modelconstructionapi_get_altitude_and_gradient_for_point(_,this.ptr,t,e);var r=c()[_/4+0],n=c()[_/4+1],i=c()[_/4+2];if(i)throw h(n);return A.__wrap(r)}finally{s.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,e,r,n,i){s.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,r,n,i)}set_altitude_for_layer(t,e,r){s.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,r)}apply_smooth_to_altitude_group(t,e,r,n,i){s.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,r,n,i)}increase_altitude_for_altitude_group(t,e,r){s.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,r)}apply_smooth_to_middle_layers(t,e,r,n){s.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,r,n)}apply_smooth_to_mountain_tops(t,e,r,n){s.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,r,n)}increase_altitude_for_mountain_tops(t,e){s.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,r,n){s.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,r,n)}correct_for_altitude_constraints_to_all_layers(){s.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class D{static __wrap(t){const e=Object.create(D.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_modelconstructionresult_free(t)}constructor(t){try{const i=s.__wbindgen_add_to_stack_pointer(-16);s.modelconstructionresult_new(i,E(t));var e=c()[i/4+0],r=c()[i/4+1],n=c()[i/4+2];if(n)throw h(r);return D.__wrap(e)}finally{s.__wbindgen_add_to_stack_pointer(16),u[g++]=void 0}}debug(){try{const r=s.__wbindgen_add_to_stack_pointer(-16);s.modelconstructionresult_debug(r,this.ptr);var t=c()[r/4+0],e=c()[r/4+1];return f(t,e)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,e)}}to_js(){try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.modelconstructionresult_to_js(n,this.ptr);var t=c()[n/4+0],e=c()[n/4+1],r=c()[n/4+2];if(r)throw h(e);return h(t)}finally{s.__wbindgen_add_to_stack_pointer(16)}}}class w{static __wrap(t){const e=Object.create(w.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_opencvtree_free(t)}constructor(t){try{const i=s.__wbindgen_add_to_stack_pointer(-16);s.opencvtree_new(i,E(t));var e=c()[i/4+0],r=c()[i/4+1],n=c()[i/4+2];if(n)throw h(r);return w.__wrap(e)}finally{s.__wbindgen_add_to_stack_pointer(16),u[g++]=void 0}}debug(){try{const n=s.__wbindgen_add_to_stack_pointer(-16);s.opencvtree_debug(n,this.ptr);var t=c()[n/4+0],e=c()[n/4+1],r=c()[n/4+2];if(r)throw h(e);return h(t)}finally{s.__wbindgen_add_to_stack_pointer(16)}}}async function N(o,t){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,t)}catch(r){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await o.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(o,t);return e instanceof WebAssembly.Instance?{instance:e,module:o}:e}}async function I(o){typeof o=="undefined"&&(o="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(n,i){const _=f(n,i);return L(_)},t.wbg.__wbindgen_object_drop_ref=function(n){h(n)},t.wbg.__wbindgen_json_parse=function(n,i){const _=JSON.parse(f(n,i));return L(_)},t.wbg.__wbindgen_json_serialize=function(n,i){const _=k(i),a=JSON.stringify(_===void 0?null:_),l=M(a,s.__wbindgen_malloc,s.__wbindgen_realloc),d=W;c()[n/4+1]=d,c()[n/4+0]=l},t.wbg.__wbg_new_693216e109162396=function(){const n=new Error;return L(n)},t.wbg.__wbg_stack_0ddaca5d1abfb52f=function(n,i){const _=k(i).stack,a=M(_,s.__wbindgen_malloc,s.__wbindgen_realloc),l=W;c()[n/4+1]=l,c()[n/4+0]=a},t.wbg.__wbg_error_09919627ac0992f5=function(n,i){try{console.error(f(n,i))}finally{s.__wbindgen_free(n,i)}},t.wbg.__wbg_log_e8ba7b992c7ad0eb=function(n){console.log(k(n))},t.wbg.__wbindgen_throw=function(n,i){throw new Error(f(n,i))},(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:e,module:r}=await N(await o,t);return s=e.exports,I.__wbindgen_wasm_module=r,s}function C(o){return o.map(t=>{const e=new X(t.x,t.y,t.size,t.offsetX,t.offsetY);return e.enableSelection(),e.deselect(),e})}function R(o,t){function e(){if(typeof window!="undefined"){const a=localStorage==null?void 0:localStorage.getItem(o);try{if(a){const l=JSON.parse(a);return t(l)}}catch{return[]}}return[]}function r(a){typeof window!="undefined"&&localStorage.setItem(o,JSON.stringify(a))}const{subscribe:n,update:i,set:_}=S(e());return{subscribe:n,clear:()=>_([]),set:a=>{_(a),r(a)},add:a=>i(l=>{const d=[...l,a];return r(d),d}),remove:a=>i(l=>{const d=l.filter((b,T)=>T!==a);return r(d),d})}}const J=R("targets",C),q=R("craters",o=>o);function G(o){return o*(180/Math.PI)}function H(o){let t=o.altitude;return t+=.02*o.gradient.map(e=>Math.abs(e)).reduce((e,r)=>Math.max(e,r)),t+1}function P(o){const t=new Blob([o],{type:"application/json"});return URL.createObjectURL(t)}function K(){const{subscribe:o,set:t}=S();let e,r,n=!1,i;return{subscribe:o,set:t,setup:async _=>{n||(await I(),n=!0),r=_.size;const a=new w({pixels_per_curve:_.curves,parent_relations:_.hierarchy});e=new O,e.base(a,5),e.set_basic_parameters(45,45,_.size.width,_.size.height),e.set_lava_path_parameters(20,.02),e.set_svc_parameters(50),e.increase_altitude_for_mountain_tops(2,!1),e.apply_smooth_to_mountain_tops(1,5,3,!1),e.apply_smooth_to_middle_layers(.7,3,5,!1),e.set_catmull_clark_parameters(1)},build:()=>{i=e.build().to_js(),i.gltf_url=P(i.gltf),q.set(i.craters),t(i)},getAlitituteAndGradient:_=>{if(!e)return{x:0,y:0,altitude:0,gradient:[0,0,0]};const a=_.x/r.width*100,l=_.y/r.height*100,d=e.get_altitude_and_gradient_for_point(a,l).to_js();return d.gradient.map(b=>G(b)),d.altitude=H(d),d}}}const V=K();function $(){const{subscribe:o,set:t}=S();let e=!1;if(!e&&typeof window!="undefined"){const r=localStorage==null?void 0:localStorage.getItem("contourlines");r&&(t(JSON.parse(r)),e=!0)}return{subscribe:o,set:r=>{localStorage.setItem("contourlines",JSON.stringify(r)),t(r),J.clear(),e=!0}}}const Z=$();export{X as D,q as a,Z as c,V as g,J as t};
