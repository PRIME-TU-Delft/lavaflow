import{w as W}from"./index-6c269418.js";let r;const M=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});M.decode();let h=null;function y(){return(h===null||h.buffer!==r.memory.buffer)&&(h=new Uint8Array(r.memory.buffer)),h}function f(o,t){return M.decode(y().subarray(o,o+t))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let w=u.length;function g(o){w===u.length&&u.push(u.length+1);const t=w;return w=u[t],u[t]=o,t}function x(o){return u[o]}function I(o){o<36||(u[o]=w,w=o)}function l(o){const t=x(o);return I(o),t}let k=0;const v=new TextEncoder("utf-8"),R=typeof v.encodeInto=="function"?function(o,t){return v.encodeInto(o,t)}:function(o,t){const e=v.encode(o);return t.set(e),{read:o.length,written:e.length}};function U(o,t,e){if(e===void 0){const c=v.encode(o),d=t(c.length);return y().subarray(d,d+c.length).set(c),k=c.length,d}let _=o.length,n=t(_);const a=y();let i=0;for(;i<_;i++){const c=o.charCodeAt(i);if(c>127)break;a[n+i]=c}if(i!==_){i!==0&&(o=o.slice(i)),n=e(n,_,_=i+o.length*3);const c=y().subarray(n+i,n+_);i+=R(o,c).written}return k=i,n}let m=null;function s(){return(m===null||m.buffer!==r.memory.buffer)&&(m=new Int32Array(r.memory.buffer)),m}function L(o,t){if(!(o instanceof t))throw new Error(`expected instance of ${t.name}`);return o.ptr}class j{static __wrap(t){const e=Object.create(j.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_altitudegradientpair_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return j.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const _=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_debug(_,this.ptr);var t=s()[_/4+0],e=s()[_/4+1];return f(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_to_js(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class S{static __wrap(t){const e=Object.create(S.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionapi_free(t)}get rows(){return r.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){r.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get width(){return r.__wbg_get_modelconstructionapi_width(this.ptr)}set width(t){r.__wbg_set_modelconstructionapi_width(this.ptr,t)}get height(){return r.__wbg_get_modelconstructionapi_height(this.ptr)}set height(t){r.__wbg_set_modelconstructionapi_height(this.ptr,t)}get altitude_step(){return r.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){r.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get curve_point_separation(){return r.__wbg_get_modelconstructionapi_curve_point_separation(this.ptr)}set curve_point_separation(t){r.__wbg_set_modelconstructionapi_curve_point_separation(this.ptr,t)}get svc_distance(){return r.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){r.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return r.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){r.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return r.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){r.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return r.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){r.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=r.modelconstructionapi_new();return S.__wrap(t)}set_basic_parameters(t,e,_,n){r.modelconstructionapi_set_basic_parameters(this.ptr,t,e,_,n)}set_svc_parameters(t){r.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){r.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,e){r.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t,e){L(t,b);var _=t.ptr;t.ptr=0,r.modelconstructionapi_base(this.ptr,_,e)}build(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_build(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return O.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_get_altitude_and_gradient_for_point(i,this.ptr,t,e);var _=s()[i/4+0],n=s()[i/4+1],a=s()[i/4+2];if(a)throw l(n);return j.__wrap(_)}finally{r.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,e,_,n,a){r.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,_,n,a)}set_altitude_for_layer(t,e,_){r.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,_)}apply_smooth_to_altitude_group(t,e,_,n,a){r.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,_,n,a)}increase_altitude_for_altitude_group(t,e,_){r.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,_)}apply_smooth_to_middle_layers(t,e,_,n){r.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,_,n)}apply_smooth_to_mountain_tops(t,e,_,n){r.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,_,n)}increase_altitude_for_mountain_tops(t,e){r.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,_,n){r.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,_,n)}correct_for_altitude_constraints_to_all_layers(){r.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionresult_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return O.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const _=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_debug(_,this.ptr);var t=s()[_/4+0],e=s()[_/4+1];return f(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_to_js(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class b{static __wrap(t){const e=Object.create(b.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_opencvtree_free(t)}constructor(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_new(a,g(t));var e=s()[a/4+0],_=s()[a/4+1],n=s()[a/4+2];if(n)throw l(_);return b.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_debug(n,this.ptr);var t=s()[n/4+0],e=s()[n/4+1],_=s()[n/4+2];if(_)throw l(e);return l(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}async function z(o,t){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,t)}catch(_){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await o.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(o,t);return e instanceof WebAssembly.Instance?{instance:e,module:o}:e}}async function E(o){typeof o=="undefined"&&(o="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(n,a){const i=f(n,a);return g(i)},t.wbg.__wbindgen_object_drop_ref=function(n){l(n)},t.wbg.__wbindgen_json_parse=function(n,a){const i=JSON.parse(f(n,a));return g(i)},t.wbg.__wbindgen_json_serialize=function(n,a){const i=x(a),c=JSON.stringify(i===void 0?null:i),d=U(c,r.__wbindgen_malloc,r.__wbindgen_realloc),p=k;s()[n/4+1]=p,s()[n/4+0]=d},t.wbg.__wbg_new_693216e109162396=function(){const n=new Error;return g(n)},t.wbg.__wbg_stack_0ddaca5d1abfb52f=function(n,a){const i=x(a).stack,c=U(i,r.__wbindgen_malloc,r.__wbindgen_realloc),d=k;s()[n/4+1]=d,s()[n/4+0]=c},t.wbg.__wbg_error_09919627ac0992f5=function(n,a){try{console.error(f(n,a))}finally{r.__wbindgen_free(n,a)}},t.wbg.__wbindgen_throw=function(n,a){throw new Error(f(n,a))},(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:e,module:_}=await z(await o,t);return r=e.exports,E.__wbindgen_wasm_module=_,r}function T(){const{subscribe:o,update:t}=W([]);return{subscribe:o,add:e=>t(_=>[..._,e]),remove:e=>t(_=>_.filter((n,a)=>a!==e))}}const q=T();function A(o){return o*(180/Math.PI)}function B(o){let t=o.altitude;return t+=.02*o.gradient.map(e=>Math.abs(e)).reduce((e,_)=>Math.max(e,_)),t+1}function D(o){const t=new Blob([o],{type:"application/json"});return URL.createObjectURL(t)}function F(){const{subscribe:o,set:t}=W();let e,_,n=!1,a;return{subscribe:o,set:t,setup:async i=>{n||(await E(),n=!0),_=i.size;const c=new b({pixels_per_curve:i.curves,parent_relations:i.hierarchy});e=new S,e.base(c,5),e.set_basic_parameters(50,50,i.size.width,i.size.height),e.set_svc_parameters(50),e.correct_for_altitude_constraints_to_all_layers(),e.apply_smooth_to_layer(0,.7,4,10,!1),e.apply_smooth_to_middle_layers(.7,4,10,!1),e.increase_altitude_for_mountain_tops(1,!1),e.apply_smooth_to_mountain_tops(.3,5,10,!1),e.set_catmull_clark_parameters(1)},build:()=>{console.log("before build"),a=e.build().to_js(),a.gltf_url=D(a.gltf),t(a),console.log(a)},getAlitituteAndGradient:i=>{if(!e)return{x:0,y:0,altitude:0,gradient:[0,0,0]};const c=i.x/_.width*100,d=i.y/_.height*100,p=e.get_altitude_and_gradient_for_point(c,d).to_js();return p.gradient[0]=A(p.gradient[0]),p.gradient[1]=A(p.gradient[1]),p.gradient[2]=A(p.gradient[2]),p.altitude=B(p),p}}}const G=F();export{G as g,q as t};
