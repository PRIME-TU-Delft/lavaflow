import{w as A}from"./index-aa581d55.js";import{D as R}from"./draggable-10e2ef03.js";let r;const S=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});S.decode();let b=null;function w(){return(b===null||b.buffer!==r.memory.buffer)&&(b=new Uint8Array(r.memory.buffer)),b}function m(o,t){return S.decode(w().subarray(o,o+t))}const l=new Array(32).fill(void 0);l.push(void 0,null,!0,!1);let d=l.length;function y(o){d===l.length&&l.push(l.length+1);const t=d;return d=l[t],l[t]=o,t}function U(o){return l[o]}function E(o){o<36||(l[o]=d,d=o)}function p(o){const t=U(o);return E(o),t}let j=0;const h=new TextEncoder("utf-8"),I=typeof h.encodeInto=="function"?function(o,t){return h.encodeInto(o,t)}:function(o,t){const e=h.encode(o);return t.set(e),{read:o.length,written:e.length}};function M(o,t,e){if(e===void 0){const c=h.encode(o),u=t(c.length);return w().subarray(u,u+c.length).set(c),j=c.length,u}let _=o.length,n=t(_);const s=w();let a=0;for(;a<_;a++){const c=o.charCodeAt(a);if(c>127)break;s[n+a]=c}if(a!==_){a!==0&&(o=o.slice(a)),n=e(n,_,_=a+o.length*3);const c=w().subarray(n+a,n+_);a+=I(o,c).written}return j=a,n}let g=null;function i(){return(g===null||g.buffer!==r.memory.buffer)&&(g=new Int32Array(r.memory.buffer)),g}function T(o,t){if(!(o instanceof t))throw new Error(`expected instance of ${t.name}`);return o.ptr}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_altitudegradientpair_free(t)}}class v{static __wrap(t){const e=Object.create(v.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionapi_free(t)}get rows(){return r.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){r.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get border_size(){return r.__wbg_get_modelconstructionapi_border_size(this.ptr)}set border_size(t){r.__wbg_set_modelconstructionapi_border_size(this.ptr,t)}get altitude_step(){return r.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){r.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get svc_distance(){return r.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){r.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return r.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){r.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return r.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){r.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return r.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){r.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=r.modelconstructionapi_new();return v.__wrap(t)}set_basic_parameters(t,e,_){r.modelconstructionapi_set_basic_parameters(this.ptr,t,e,_)}set_svc_parameters(t){r.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){r.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,e){r.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t){T(t,f);var e=t.ptr;t.ptr=0,r.modelconstructionapi_base(this.ptr,e)}build(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_build(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],_=i()[n/4+2];if(_)throw p(e);return k.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_get_altitude_and_gradient_for_point(a,this.ptr,t,e);var _=i()[a/4+0],n=i()[a/4+1],s=i()[a/4+2];if(s)throw p(n);return O.__wrap(_)}finally{r.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,e,_,n,s){r.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,_,n,s)}set_altitude_for_layer(t,e,_){r.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,_)}apply_smooth_to_altitude_group(t,e,_,n,s){r.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,_,n,s)}increase_altitude_for_altitude_group(t,e,_){r.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,_)}apply_smooth_to_middle_layers(t,e,_,n){r.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,_,n)}apply_smooth_to_mountain_tops(t,e,_,n){r.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,_,n)}increase_altitude_for_mountain_tops(t,e){r.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,_,n){r.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,_,n)}correct_for_altitude_constraints_to_all_layers(){r.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class k{static __wrap(t){const e=Object.create(k.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionresult_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_new(s,y(t));var e=i()[s/4+0],_=i()[s/4+1],n=i()[s/4+2];if(n)throw p(_);return k.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const _=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_debug(_,this.ptr);var t=i()[_/4+0],e=i()[_/4+1];return m(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_to_js(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],_=i()[n/4+2];if(_)throw p(e);return p(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class f{static __wrap(t){const e=Object.create(f.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_opencvtree_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_new(s,y(t));var e=i()[s/4+0],_=i()[s/4+1],n=i()[s/4+2];if(n)throw p(_);return f.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_debug(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],_=i()[n/4+2];if(_)throw p(e);return p(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}async function z(o,t){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,t)}catch(_){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await o.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(o,t);return e instanceof WebAssembly.Instance?{instance:e,module:o}:e}}async function W(o){typeof o=="undefined"&&(o="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(n,s){const a=m(n,s);return y(a)},t.wbg.__wbindgen_object_drop_ref=function(n){p(n)},t.wbg.__wbindgen_json_parse=function(n,s){const a=JSON.parse(m(n,s));return y(a)},t.wbg.__wbindgen_json_serialize=function(n,s){const a=U(s),c=JSON.stringify(a===void 0?null:a),u=M(c,r.__wbindgen_malloc,r.__wbindgen_realloc),x=j;i()[n/4+1]=x,i()[n/4+0]=u},t.wbg.__wbindgen_throw=function(n,s){throw new Error(m(n,s))},(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:e,module:_}=await z(await o,t);return r=e.exports,W.__wbindgen_wasm_module=_,r}function L(){const{subscribe:o,update:t}=A([new R(500,500,0)]);return{subscribe:o,add:e=>t(_=>[..._,e]),remove:e=>t(_=>_.filter((n,s)=>s!==e))}}L();function B(o){const t=new Blob([o],{type:"application/json"});return URL.createObjectURL(t)}function D(){const{subscribe:o,set:t}=A("");let e,_=!1,n;return{subscribe:o,set:t,setup:async s=>{_||(await W(),_=!0);const a=new f({pixels_per_curve:s.curves,parent_relations:s.hierarchy});e=new v,e.base(a),e.set_basic_parameters(100,100,0),e.correct_for_altitude_constraints_to_all_layers(),e.apply_smooth_to_layer(0,.7,4,10,!1),e.increase_altitude_for_mountain_tops(.3,!1),e.apply_smooth_to_mountain_tops(.2,2,5,!1)},build:()=>{n=e.build().to_js();const s=B(n.gltf);t(s),console.log(s)},getAlitituteAndGradient:(s,a)=>{if(!e)return console.warn("no api initialized");const c=e.get_altitude_and_gradient_for_point(s,a).to_js();return console.log(c),c}}}const N=D();export{v as M,f as O,N as g,W as i};
