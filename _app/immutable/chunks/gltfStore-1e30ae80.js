var P=Object.defineProperty;var C=(_,t,e)=>t in _?P(_,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[t]=e;var g=(_,t,e)=>(C(_,typeof t!="symbol"?t+"":t,e),e);import{a1 as N,B as H}from"./index-5adb68ea.js";import{c as X,t as Y}from"./contourLineStore-50093bfb.js";import{d as $}from"./difficultyStore-7cc4eead.js";class K{constructor(t,e,o,n,s,a,c,p,u,m,L){g(this,"tree");g(this,"rows");g(this,"columns");g(this,"width");g(this,"height");g(this,"curve_point_separation");g(this,"svc_distance");g(this,"catmull_clark_iterations");g(this,"lava_path_length");g(this,"lava_path_fork_val");g(this,"smoothing_operations");this.tree=t,this.rows=e,this.columns=o,this.width=n,this.height=s,this.curve_point_separation=a,this.svc_distance=c,this.catmull_clark_iterations=p,this.lava_path_length=u,this.lava_path_fork_val=m,this.smoothing_operations=L}apply_to_api(t){t.base(this.tree,this.curve_point_separation),t.set_basic_parameters(this.rows,this.columns,this.width,this.height),t.set_svc_parameters(this.svc_distance),t.set_catmull_clark_parameters(this.catmull_clark_iterations),t.set_lava_path_parameters(this.lava_path_length,this.lava_path_fork_val);for(const e of this.smoothing_operations)e.apply_to_api(t)}}let r;const G=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});G.decode();let j=new Uint8Array;function x(){return j.byteLength===0&&(j=new Uint8Array(r.memory.buffer)),j}function b(_,t){return G.decode(x().subarray(_,_+t))}const l=new Array(32).fill(void 0);l.push(void 0,null,!0,!1);let y=l.length;function D(_){y===l.length&&l.push(l.length+1);const t=y;return y=l[t],l[t]=_,t}function O(_){return l[_]}let W=0;const A=new TextEncoder("utf-8"),Q=typeof A.encodeInto=="function"?function(_,t){return A.encodeInto(_,t)}:function(_,t){const e=A.encode(_);return t.set(e),{read:_.length,written:e.length}};function q(_,t,e){if(e===void 0){const c=A.encode(_),p=t(c.length);return x().subarray(p,p+c.length).set(c),W=c.length,p}let o=_.length,n=t(o);const s=x();let a=0;for(;a<o;a++){const c=_.charCodeAt(a);if(c>127)break;s[n+a]=c}if(a!==o){a!==0&&(_=_.slice(a)),n=e(n,o,o=a+_.length*3);const c=x().subarray(n+a,n+o),p=Q(_,c);a+=p.written}return W=a,n}let U=new Int32Array;function i(){return U.byteLength===0&&(U=new Int32Array(r.memory.buffer)),U}function V(_){_<36||(l[_]=y,y=_)}function h(_){const t=O(_);return V(_),t}let w=32;function B(_){if(w==1)throw new Error("out of js stack");return l[--w]=_,w}function f(_,t){if(!(_ instanceof t))throw new Error(`expected instance of ${t.name}`);return _.ptr}class z{static __wrap(t){const e=Object.create(z.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_altitudegradientpair_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_new(s,B(t));var e=i()[s/4+0],o=i()[s/4+1],n=i()[s/4+2];if(n)throw h(o);return z.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16),l[w++]=void 0}}debug(){try{const o=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_debug(o,this.ptr);var t=i()[o/4+0],e=i()[o/4+1];return b(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.altitudegradientpair_to_js(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],o=i()[n/4+2];if(o)throw h(e);return h(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class v{static __wrap(t){const e=Object.create(v.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_lavapathturbineinput_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.lavapathturbineinput_new(s,B(t));var e=i()[s/4+0],o=i()[s/4+1],n=i()[s/4+2];if(n)throw h(o);return v.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16),l[w++]=void 0}}}class d{static __wrap(t){const e=Object.create(d.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionapi_free(t)}get rows(){return r.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){r.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get width(){return r.__wbg_get_modelconstructionapi_width(this.ptr)}set width(t){r.__wbg_set_modelconstructionapi_width(this.ptr,t)}get height(){return r.__wbg_get_modelconstructionapi_height(this.ptr)}set height(t){r.__wbg_set_modelconstructionapi_height(this.ptr,t)}get altitude_step(){return r.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){r.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get curve_point_separation(){return r.__wbg_get_modelconstructionapi_curve_point_separation(this.ptr)}set curve_point_separation(t){r.__wbg_set_modelconstructionapi_curve_point_separation(this.ptr,t)}get svc_distance(){return r.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){r.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return r.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){r.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return r.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){r.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return r.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){r.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=r.modelconstructionapi_new();return d.__wrap(t)}set_basic_parameters(t,e,o,n){r.modelconstructionapi_set_basic_parameters(this.ptr,t,e,o,n)}set_svc_parameters(t){r.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}set_catmull_clark_parameters(t){r.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}set_lava_path_parameters(t,e){r.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t,e){f(t,k);var o=t.ptr;t.ptr=0,r.modelconstructionapi_base(this.ptr,o,e)}build(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_build(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],o=i()[n/4+2];if(o)throw h(e);return I.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionapi_get_altitude_and_gradient_for_point(a,this.ptr,t,e);var o=i()[a/4+0],n=i()[a/4+1],s=i()[a/4+2];if(s)throw h(n);return z.__wrap(o)}finally{r.__wbindgen_add_to_stack_pointer(16)}}compute_player_points(t){f(t,v);var e=t.ptr;return t.ptr=0,r.modelconstructionapi_compute_player_points(this.ptr,e)>>>0}apply_smooth_to_layer(t,e,o,n,s){r.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,o,n,s)}set_altitude_for_layer(t,e,o){r.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,o)}apply_smooth_to_altitude_group(t,e,o,n,s){r.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,o,n,s)}increase_altitude_for_altitude_group(t,e,o){r.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,o)}apply_smooth_to_middle_layers(t,e,o,n){r.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,o,n)}apply_smooth_to_mountain_tops(t,e,o,n){r.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,o,n)}increase_altitude_for_mountain_tops(t,e){r.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,o,n){r.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,o,n)}correct_for_altitude_constraints_to_all_layers(){r.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class I{static __wrap(t){const e=Object.create(I.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_modelconstructionresult_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_new(s,B(t));var e=i()[s/4+0],o=i()[s/4+1],n=i()[s/4+2];if(n)throw h(o);return I.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16),l[w++]=void 0}}debug(){try{const o=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_debug(o,this.ptr);var t=i()[o/4+0],e=i()[o/4+1];return b(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}to_js(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.modelconstructionresult_to_js(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],o=i()[n/4+2];if(o)throw h(e);return h(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class k{static __wrap(t){const e=Object.create(k.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_opencvtree_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_new(s,B(t));var e=i()[s/4+0],o=i()[s/4+1],n=i()[s/4+2];if(n)throw h(o);return k.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16),l[w++]=void 0}}debug(){try{const n=r.__wbindgen_add_to_stack_pointer(-16);r.opencvtree_debug(n,this.ptr);var t=i()[n/4+0],e=i()[n/4+1],o=i()[n/4+2];if(o)throw h(e);return h(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class E{static __wrap(t){const e=Object.create(E.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_smoothingoperationapplysmoothtolayer_free(t)}get layer(){return r.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set layer(t){r.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get strength(){return r.__wbg_get_smoothingoperationapplysmoothtoaltitudegroup_strength(this.ptr)}set strength(t){r.__wbg_set_smoothingoperationapplysmoothtoaltitudegroup_strength(this.ptr,t)}get coverage(){return r.__wbg_get_smoothingoperationapplysmoothtoall_svc_weight(this.ptr)>>>0}set coverage(t){r.__wbg_set_smoothingoperationapplysmoothtoall_svc_weight(this.ptr,t)}get svc_weight(){return r.__wbg_get_smoothingoperationapplysmoothtoaltitudegroup_svc_weight(this.ptr)>>>0}set svc_weight(t){r.__wbg_set_smoothingoperationapplysmoothtoaltitudegroup_svc_weight(this.ptr,t)}get allow_svc_change(){return r.__wbg_get_smoothingoperationapplysmoothtoaltitudegroup_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){r.__wbg_set_smoothingoperationapplysmoothtoaltitudegroup_allow_svc_change(this.ptr,t)}constructor(t,e,o,n,s){const a=r.smoothingoperationapplysmoothtoaltitudegroup_new(t,e,o,n,s);return E.__wrap(a)}apply_to_api(t){f(t,d),r.smoothingoperationapplysmoothtolayer_apply_to_api(this.ptr,t.ptr)}}class S{static __wrap(t){const e=Object.create(S.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_smoothingoperationapplysmoothtomiddlelayers_free(t)}get strength(){return r.__wbg_get_smoothingoperationapplysmoothtoall_strength(this.ptr)}set strength(t){r.__wbg_set_smoothingoperationapplysmoothtoall_strength(this.ptr,t)}get coverage(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set coverage(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get svc_weight(){return r.__wbg_get_smoothingoperationapplysmoothtoall_svc_weight(this.ptr)>>>0}set svc_weight(t){r.__wbg_set_smoothingoperationapplysmoothtoall_svc_weight(this.ptr,t)}get allow_svc_change(){return r.__wbg_get_smoothingoperationapplysmoothtoall_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){r.__wbg_set_smoothingoperationapplysmoothtoall_allow_svc_change(this.ptr,t)}constructor(t,e,o,n){const s=r.smoothingoperationapplysmoothtoall_new(t,e,o,n);return S.__wrap(s)}apply_to_api(t){f(t,d),r.smoothingoperationapplysmoothtomiddlelayers_apply_to_api(this.ptr,t.ptr)}}class R{static __wrap(t){const e=Object.create(R.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_smoothingoperationapplysmoothtomountaintops_free(t)}get strength(){return r.__wbg_get_smoothingoperationapplysmoothtoall_strength(this.ptr)}set strength(t){r.__wbg_set_smoothingoperationapplysmoothtoall_strength(this.ptr,t)}get coverage(){return r.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set coverage(t){r.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get svc_weight(){return r.__wbg_get_smoothingoperationapplysmoothtoall_svc_weight(this.ptr)>>>0}set svc_weight(t){r.__wbg_set_smoothingoperationapplysmoothtoall_svc_weight(this.ptr,t)}get allow_svc_change(){return r.__wbg_get_smoothingoperationapplysmoothtoall_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){r.__wbg_set_smoothingoperationapplysmoothtoall_allow_svc_change(this.ptr,t)}constructor(t,e,o,n){const s=r.smoothingoperationapplysmoothtoall_new(t,e,o,n);return R.__wrap(s)}apply_to_api(t){f(t,d),r.smoothingoperationapplysmoothtomountaintops_apply_to_api(this.ptr,t.ptr)}}class M{static __wrap(t){const e=Object.create(M.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_smoothingoperationincreasealtitudeformountaintops_free(t)}get percentage_of_altitude_step(){return r.__wbg_get_smoothingoperationapplysmoothtoall_strength(this.ptr)}set percentage_of_altitude_step(t){r.__wbg_set_smoothingoperationapplysmoothtoall_strength(this.ptr,t)}get allow_svc_change(){return r.__wbg_get_smoothingoperationincreasealtitudeformountaintops_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){r.__wbg_set_smoothingoperationincreasealtitudeformountaintops_allow_svc_change(this.ptr,t)}constructor(t,e){const o=r.smoothingoperationincreasealtitudeformountaintops_new(t,e);return M.__wrap(o)}apply_to_api(t){f(t,d),r.smoothingoperationincreasealtitudeformountaintops_apply_to_api(this.ptr,t.ptr)}}async function Z(_,t){if(typeof Response=="function"&&_ instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(_,t)}catch(o){if(_.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const e=await _.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(_,t);return e instanceof WebAssembly.Instance?{instance:e,module:_}:e}}function T(){const _={};return _.wbg={},_.wbg.__wbindgen_string_new=function(t,e){const o=b(t,e);return D(o)},_.wbg.__wbindgen_json_parse=function(t,e){const o=JSON.parse(b(t,e));return D(o)},_.wbg.__wbindgen_json_serialize=function(t,e){const o=O(e),n=JSON.stringify(o===void 0?null:o),s=q(n,r.__wbindgen_malloc,r.__wbindgen_realloc),a=W;i()[t/4+1]=a,i()[t/4+0]=s},_.wbg.__wbindgen_object_drop_ref=function(t){h(t)},_.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return D(t)},_.wbg.__wbg_stack_658279fe44541cf6=function(t,e){const o=O(e).stack,n=q(o,r.__wbindgen_malloc,r.__wbindgen_realloc),s=W;i()[t/4+1]=s,i()[t/4+0]=n},_.wbg.__wbg_error_f851667af71bcfc6=function(t,e){try{console.error(b(t,e))}finally{r.__wbindgen_free(t,e)}},_.wbg.__wbg_log_4b5638ad60bdc54a=function(t){console.log(O(t))},_.wbg.__wbindgen_throw=function(t,e){throw new Error(b(t,e))},_}function tt(_,t){return r=_.exports,J.__wbindgen_wasm_module=t,U=new Int32Array,j=new Uint8Array,r}async function J(_){typeof _>"u"&&(_="assets/wasm_bg.wasm");const t=T();(typeof _=="string"||typeof Request=="function"&&_ instanceof Request||typeof URL=="function"&&_ instanceof URL)&&(_=fetch(_));const{instance:e,module:o}=await Z(await _,t);return tt(e,o)}function et(_){return _*(180/Math.PI)}function rt(_){let t=_.altitude;return t+=1*_.gradient.map(e=>Math.abs(e)).reduce((e,o)=>Math.max(e,o)),t*1.07}function F(_){const t=new Blob([_],{type:"application/json"});return URL.createObjectURL(t)}function ot(){const{subscribe:_,set:t}=H();let e,o,n=!1,s;return{subscribe:_,set:t,setup:async(a,c)=>{n||(await J(),n=!0),o=a.size;const p=new k({pixels_per_curve:a.curves,parent_relations:a.hierarchy});e=new d,new K(p,45,45,a.size.width,a.size.height,5,Math.max(a.size.width,a.size.height)/(45*1.5),1,20,c,[new E(0,.3,5,1,!1),new S(.7,3,5,!1),new M(.25,!0),new R(1,8,1,!1)]).apply_to_api(e)},build:a=>{s=e.build().to_js(),s.gltf_url=F(s.gltf),s.lava_gltf_url=F(s.lava_gltf),s.craters=s.craters.map(c=>[c[0]*a.size.width/100,c[1]*a.size.height/100]),X.set(s.craters),t(s)},getAlitituteAndGradient:(a,c=!1)=>{if(!e)return{x:0,y:0,altitude:0,gradient:[0,0,0]};let[p,u]=[a.x,a.y];c||(p=a.x/o.width*100,u=a.y/o.height*100);const m=e.get_altitude_and_gradient_for_point(p,u).to_js();return m.gradient.map(L=>et(L)),m.altitude=rt(m),m},computePlayerPoints:a=>{if(!e)return 0;const{width:c,height:p}=o;return e.compute_player_points(new v({lava_paths:s.lava_paths,turbines:N(Y).map(u=>[u.x/c*100,u.y/p*100]),max_lava_distance:N($).max_lava_distance,max_points_total:a}))}}}const it=ot();export{it as g};
