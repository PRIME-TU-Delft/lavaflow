import{w as f}from"./index-b55d7b60.js";const c=4;class _{constructor(t,s,i,o=0,r=0){this.dragging=!1,this.enable_selection=!1,this.last_selected=!0,this.drag_translated=!1,this.too_close_to_crater=!1,this.too_close_to_other_target=!1,this.instruction="",this.instruction_width=-1,this.instruction_height=-1,this.instruction_show_initially=!1,this.x=t,this.y=s,this.old_x=t,this.old_y=s,this.size=i,this.offsetX=o,this.offsetY=r}setInstruction(t,s,i,o){this.instruction=t,s!=null&&(this.instruction_width=s),i!=null&&(this.instruction_height=i),o!=null&&(this.instruction_show_initially=o)}enableSelection(){this.enable_selection=!0}disableSelection(){this.enable_selection=!1}isTooCloseTo(t,s,i){const o=t-this.x,r=s-this.y;return Math.sqrt(o*o+r*r)<=i}update(t,s,i,o,r,a){if(!!this.dragging&&!(t.mouseX<=0||t.mouseY<=0)&&!(t.mouseX>=t.width||t.mouseY>=t.height)){if(this.x=t.mouseX+this.offsetX,this.y=t.mouseY+this.offsetY,this.translateForDragging(t),s!=null&&i!=null){this.too_close_to_crater=!1;for(let e=0;e<s.length;e++){const n=s[e][0]-this.x,h=s[e][1]-this.y;if(Math.sqrt(n*n+h*h)<=i){this.too_close_to_crater=!0;break}}}if(o!=null&&r!=null){this.too_close_to_other_target=!1;for(let e=0;e<o.length;e++){if(a!=null&&a==e)continue;const n=o[e].x-this.x,h=o[e].y-this.y;if(Math.sqrt(n*n+h*h)<=r){this.too_close_to_other_target=!0;break}}}}}setPosition(t,s){this.x=t,this.y=s}translateForDragging(t){t.mouseX<=0||t.mouseY<=0||t.mouseX>=t.width||t.mouseY>=t.height||this.dragging&&!this.drag_translated&&(this.y-=50,this.drag_translated=!0)}translateBackAfterDragging(){this.drag_translated&&(this.drag_translated=!1)}drawInstruction(t,s){if(this.instruction.length>0&&(this.dragging||this.instruction_show_initially)){this.dragging&&(this.instruction_show_initially=!1);let i=t.textWidth(this.instruction)+20,o=s;this.instruction_width>=0&&(i=this.instruction_width),this.instruction_height>=0&&(o=this.instruction_height),t.strokeWeight(.5),t.stroke(0),t.fill(200),t.rectMode(t.CENTER),t.rect(this.x,this.y-s/2-25,i,o),t.fill(0),t.textAlign(t.CENTER),t.textSize(15),t.text(this.instruction,this.x,this.y-40)}}displayWarningMessage(t,s){t.noStroke(),t.fill(51),t.textSize(15),t.textAlign(t.CENTER);const i=t.textWidth(s);t.rectMode(t.CORNER),t.rect(this.x-i/2-5,this.y-35,i+10,20),t.strokeWeight(1),t.fill(255),t.text(s,this.x,this.y-20)}drawRect(t,s){this.translateForDragging(t),this.drawInstruction(t,s),t.stroke(0),t.fill(255),t.strokeWeight(c),t.rectMode(t.CORNER),t.rect(this.x-s/2,this.y-s/2,s,s),this.translateBackAfterDragging()}drawCircle(t,s,i){this.translateForDragging(t),this.drawInstruction(t,s),i!=null&&(t.strokeWeight(.5),t.stroke(0),t.fill(200),t.rectMode(t.CORNER),t.rect(this.x,this.y-s/2,50,s),t.fill(0),t.textAlign(t.CENTER),t.textSize(15),t.text(i,this.x+30,this.y+5)),t.fill(255),this.enable_selection&&this.last_selected&&t.fill(0,140,220),this.too_close_to_crater?(this.displayWarningMessage(t,"Too close to the crater"),t.fill(255,0,0)):this.too_close_to_other_target&&(this.displayWarningMessage(t,"Too close to another turbine"),t.fill(255,0,0)),t.stroke(0),t.strokeWeight(c),t.ellipse(this.x,this.y,s),this.translateBackAfterDragging()}drawTriangle(t,s){this.translateForDragging(t),this.drawInstruction(t,s),t.stroke(0),t.fill(255),t.strokeWeight(c),t.triangle(this.x-s/2,this.y+s/2,this.x+s/2,this.y+s/2,this.x,this.y-s/2),this.translateBackAfterDragging()}drawCross(t,s){this.translateForDragging(t),this.drawInstruction(t,s),t.stroke(0),t.strokeWeight(c*2),t.line(this.x-s/2,this.y-s/2,this.x+s/2,this.y+s/2),t.line(this.x+s/2,this.y-s/2,this.x-s/2,this.y+s/2),this.translateBackAfterDragging()}deselect(){this.last_selected=!1}pressed(t){const s=t.mouseX>this.x-this.size/2&&t.mouseX<this.x+this.size/2,i=t.mouseY>this.y-this.size/2&&t.mouseY<this.y+this.size/2;return s&&i?(this.dragging=!0,this.offsetX=this.x-t.mouseX,this.offsetY=this.y-t.mouseY,this.old_x=this.x,this.old_y=this.y,this.last_selected=!0,!0):!1}released(){this.dragging=!1,this.translateBackAfterDragging(),(this.too_close_to_crater||this.too_close_to_other_target)&&(this.x=this.old_x,this.y=this.old_y,this.too_close_to_crater=!1,this.too_close_to_other_target=!1)}}function y(l){return l.map(t=>{const s=new _(t.x,t.y,t.size,t.offsetX,t.offsetY);return s.enableSelection(),s.deselect(),s})}function d(l,t){function s(){if(typeof window!="undefined"){const e=localStorage==null?void 0:localStorage.getItem(l);try{if(e){const n=JSON.parse(e);return t(n)}}catch{return[]}}return[]}function i(e){typeof window!="undefined"&&localStorage.setItem(l,JSON.stringify(e))}const{subscribe:o,update:r,set:a}=f(s());return{subscribe:o,clear:()=>a([]),set:e=>{a(e),i(e)},add:e=>r(n=>{const h=[...n,e];return i(h),h}),remove:e=>r(n=>{const h=n.filter((g,u)=>u!==e);return i(h),h})}}const x=d("targets",y),D=d("craters",l=>l);function w(){const{subscribe:l,set:t}=f();let s=!1;if(!s&&typeof window!="undefined"){const i=localStorage==null?void 0:localStorage.getItem("contourlines");i&&(t(JSON.parse(i)),s=!0)}return{subscribe:l,setup:i=>{localStorage.setItem("contourlines",JSON.stringify(i)),t(i),x.clear(),s=!0},clear:()=>{s=!1,localStorage.removeItem("contourlines")}}}const C=w();export{_ as D,D as a,C as c,x as t};
