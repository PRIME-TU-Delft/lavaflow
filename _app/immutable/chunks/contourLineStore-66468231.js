import{w as z}from"./index-082afcc0.js";class q{constructor(t,o,n,r,s,a,c,p,l,y,R){this.tree=t,this.rows=o,this.columns=n,this.width=r,this.height=s,this.curve_point_separation=a,this.svc_distance=c,this.catmull_clark_iterations=p,this.lava_path_length=l,this.lava_path_fork_val=y,this.smoothing_operations=R}apply_to_api(t){t.base(this.tree,this.curve_point_separation),t.set_basic_parameters(this.rows,this.columns,this.width,this.height),t.set_svc_parameters(this.svc_distance),t.set_catmull_clark_parameters(this.catmull_clark_iterations),t.set_lava_path_parameters(this.lava_path_length,this.lava_path_fork_val);for(let o of this.smoothing_operations)o.apply_to_api(t)}}let e;const B=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});B.decode();let v=null;function j(){return(v===null||v.buffer!==e.memory.buffer)&&(v=new Uint8Array(e.memory.buffer)),v}function d(_,t){return B.decode(j().subarray(_,_+t))}const h=new Array(32).fill(void 0);h.push(void 0,null,!0,!1);let m=h.length;function N(_){m===h.length&&h.push(h.length+1);const t=m;return m=h[t],h[t]=_,t}function S(_){return h[_]}function F(_){_<36||(h[_]=m,m=_)}function g(_){const t=S(_);return F(_),t}let L=0;const O=new TextEncoder("utf-8"),G=typeof O.encodeInto=="function"?function(_,t){return O.encodeInto(_,t)}:function(_,t){const o=O.encode(_);return t.set(o),{read:_.length,written:o.length}};function M(_,t,o){if(o===void 0){const c=O.encode(_),p=t(c.length);return j().subarray(p,p+c.length).set(c),L=c.length,p}let n=_.length,r=t(n);const s=j();let a=0;for(;a<n;a++){const c=_.charCodeAt(a);if(c>127)break;s[r+a]=c}if(a!==n){a!==0&&(_=_.slice(a)),r=o(r,n,n=a+_.length*3);const c=j().subarray(r+a,r+n);a+=G(_,c).written}return L=a,r}let k=null;function i(){return(k===null||k.buffer!==e.memory.buffer)&&(k=new Int32Array(e.memory.buffer)),k}let w=32;function J(_){if(w==1)throw new Error("out of js stack");return h[--w]=_,w}function b(_,t){if(!(_ instanceof t))throw new Error(`expected instance of ${t.name}`);return _.ptr}class x{static __wrap(t){const o=Object.create(x.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_altitudegradientpair_free(t)}constructor(t){try{const s=e.__wbindgen_add_to_stack_pointer(-16);e.altitudegradientpair_new(s,J(t));var o=i()[s/4+0],n=i()[s/4+1],r=i()[s/4+2];if(r)throw g(n);return x.__wrap(o)}finally{e.__wbindgen_add_to_stack_pointer(16),h[w++]=void 0}}debug(){try{const n=e.__wbindgen_add_to_stack_pointer(-16);e.altitudegradientpair_debug(n,this.ptr);var t=i()[n/4+0],o=i()[n/4+1];return d(t,o)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(t,o)}}to_js(){try{const r=e.__wbindgen_add_to_stack_pointer(-16);e.altitudegradientpair_to_js(r,this.ptr);var t=i()[r/4+0],o=i()[r/4+1],n=i()[r/4+2];if(n)throw g(o);return g(t)}finally{e.__wbindgen_add_to_stack_pointer(16)}}}class u{static __wrap(t){const o=Object.create(u.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_modelconstructionapi_free(t)}get rows(){return e.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){e.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return e.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){e.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get width(){return e.__wbg_get_modelconstructionapi_width(this.ptr)}set width(t){e.__wbg_set_modelconstructionapi_width(this.ptr,t)}get height(){return e.__wbg_get_modelconstructionapi_height(this.ptr)}set height(t){e.__wbg_set_modelconstructionapi_height(this.ptr,t)}get altitude_step(){return e.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){e.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get curve_point_separation(){return e.__wbg_get_modelconstructionapi_curve_point_separation(this.ptr)}set curve_point_separation(t){e.__wbg_set_modelconstructionapi_curve_point_separation(this.ptr,t)}get svc_distance(){return e.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){e.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return e.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){e.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return e.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){e.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return e.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){e.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=e.modelconstructionapi_new();return u.__wrap(t)}set_basic_parameters(t,o,n,r){e.modelconstructionapi_set_basic_parameters(this.ptr,t,o,n,r)}set_svc_parameters(t){e.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){e.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,o){e.modelconstructionapi_set_lava_path_parameters(this.ptr,t,o)}base(t,o){b(t,f);var n=t.ptr;t.ptr=0,e.modelconstructionapi_base(this.ptr,n,o)}build(){try{const r=e.__wbindgen_add_to_stack_pointer(-16);e.modelconstructionapi_build(r,this.ptr);var t=i()[r/4+0],o=i()[r/4+1],n=i()[r/4+2];if(n)throw g(o);return I.__wrap(t)}finally{e.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,o){try{const a=e.__wbindgen_add_to_stack_pointer(-16);e.modelconstructionapi_get_altitude_and_gradient_for_point(a,this.ptr,t,o);var n=i()[a/4+0],r=i()[a/4+1],s=i()[a/4+2];if(s)throw g(r);return x.__wrap(n)}finally{e.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,o,n,r,s){e.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,o,n,r,s)}set_altitude_for_layer(t,o,n){e.modelconstructionapi_set_altitude_for_layer(this.ptr,t,o,n)}apply_smooth_to_altitude_group(t,o,n,r,s){e.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,o,n,r,s)}increase_altitude_for_altitude_group(t,o,n){e.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,o,n)}apply_smooth_to_middle_layers(t,o,n,r){e.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,o,n,r)}apply_smooth_to_mountain_tops(t,o,n,r){e.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,o,n,r)}increase_altitude_for_mountain_tops(t,o){e.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,o)}apply_smooth_to_all(t,o,n,r){e.modelconstructionapi_apply_smooth_to_all(this.ptr,t,o,n,r)}correct_for_altitude_constraints_to_all_layers(){e.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class I{static __wrap(t){const o=Object.create(I.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_modelconstructionresult_free(t)}constructor(t){try{const s=e.__wbindgen_add_to_stack_pointer(-16);e.modelconstructionresult_new(s,J(t));var o=i()[s/4+0],n=i()[s/4+1],r=i()[s/4+2];if(r)throw g(n);return I.__wrap(o)}finally{e.__wbindgen_add_to_stack_pointer(16),h[w++]=void 0}}debug(){try{const n=e.__wbindgen_add_to_stack_pointer(-16);e.modelconstructionresult_debug(n,this.ptr);var t=i()[n/4+0],o=i()[n/4+1];return d(t,o)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(t,o)}}to_js(){try{const r=e.__wbindgen_add_to_stack_pointer(-16);e.modelconstructionresult_to_js(r,this.ptr);var t=i()[r/4+0],o=i()[r/4+1],n=i()[r/4+2];if(n)throw g(o);return g(t)}finally{e.__wbindgen_add_to_stack_pointer(16)}}}class f{static __wrap(t){const o=Object.create(f.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_opencvtree_free(t)}constructor(t){try{const s=e.__wbindgen_add_to_stack_pointer(-16);e.opencvtree_new(s,J(t));var o=i()[s/4+0],n=i()[s/4+1],r=i()[s/4+2];if(r)throw g(n);return f.__wrap(o)}finally{e.__wbindgen_add_to_stack_pointer(16),h[w++]=void 0}}debug(){try{const r=e.__wbindgen_add_to_stack_pointer(-16);e.opencvtree_debug(r,this.ptr);var t=i()[r/4+0],o=i()[r/4+1],n=i()[r/4+2];if(n)throw g(o);return g(t)}finally{e.__wbindgen_add_to_stack_pointer(16)}}}class U{static __wrap(t){const o=Object.create(U.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_smoothingoperationapplysmoothtolayer_free(t)}get layer(){return e.__wbg_get_smoothingoperationapplysmoothtolayer_layer(this.ptr)>>>0}set layer(t){e.__wbg_set_smoothingoperationapplysmoothtolayer_layer(this.ptr,t)}get strength(){return e.__wbg_get_smoothingoperationapplysmoothtolayer_strength(this.ptr)}set strength(t){e.__wbg_set_smoothingoperationapplysmoothtolayer_strength(this.ptr,t)}get coverage(){return e.__wbg_get_smoothingoperationapplysmoothtolayer_coverage(this.ptr)>>>0}set coverage(t){e.__wbg_set_smoothingoperationapplysmoothtolayer_coverage(this.ptr,t)}get svc_weight(){return e.__wbg_get_smoothingoperationapplysmoothtolayer_svc_weight(this.ptr)>>>0}set svc_weight(t){e.__wbg_set_smoothingoperationapplysmoothtolayer_svc_weight(this.ptr,t)}get allow_svc_change(){return e.__wbg_get_smoothingoperationapplysmoothtolayer_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){e.__wbg_set_smoothingoperationapplysmoothtolayer_allow_svc_change(this.ptr,t)}constructor(t,o,n,r,s){const a=e.smoothingoperationapplysmoothtolayer_new(t,o,n,r,s);return U.__wrap(a)}apply_to_api(t){b(t,u),e.smoothingoperationapplysmoothtolayer_apply_to_api(this.ptr,t.ptr)}}class W{static __wrap(t){const o=Object.create(W.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_smoothingoperationapplysmoothtomiddlelayers_free(t)}get strength(){return e.__wbg_get_smoothingoperationapplysmoothtomiddlelayers_strength(this.ptr)}set strength(t){e.__wbg_set_smoothingoperationapplysmoothtomiddlelayers_strength(this.ptr,t)}get coverage(){return e.__wbg_get_smoothingoperationapplysmoothtomiddlelayers_coverage(this.ptr)>>>0}set coverage(t){e.__wbg_set_smoothingoperationapplysmoothtomiddlelayers_coverage(this.ptr,t)}get svc_weight(){return e.__wbg_get_smoothingoperationapplysmoothtomiddlelayers_svc_weight(this.ptr)>>>0}set svc_weight(t){e.__wbg_set_smoothingoperationapplysmoothtomiddlelayers_svc_weight(this.ptr,t)}get allow_svc_change(){return e.__wbg_get_smoothingoperationapplysmoothtomiddlelayers_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){e.__wbg_set_smoothingoperationapplysmoothtomiddlelayers_allow_svc_change(this.ptr,t)}constructor(t,o,n,r){const s=e.smoothingoperationapplysmoothtomiddlelayers_new(t,o,n,r);return W.__wrap(s)}apply_to_api(t){b(t,u),e.smoothingoperationapplysmoothtomiddlelayers_apply_to_api(this.ptr,t.ptr)}}class A{static __wrap(t){const o=Object.create(A.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_smoothingoperationapplysmoothtomountaintops_free(t)}get strength(){return e.__wbg_get_smoothingoperationapplysmoothtomountaintops_strength(this.ptr)}set strength(t){e.__wbg_set_smoothingoperationapplysmoothtomountaintops_strength(this.ptr,t)}get coverage(){return e.__wbg_get_smoothingoperationapplysmoothtomountaintops_coverage(this.ptr)>>>0}set coverage(t){e.__wbg_set_smoothingoperationapplysmoothtomountaintops_coverage(this.ptr,t)}get svc_weight(){return e.__wbg_get_smoothingoperationapplysmoothtomountaintops_svc_weight(this.ptr)>>>0}set svc_weight(t){e.__wbg_set_smoothingoperationapplysmoothtomountaintops_svc_weight(this.ptr,t)}get allow_svc_change(){return e.__wbg_get_smoothingoperationapplysmoothtomountaintops_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){e.__wbg_set_smoothingoperationapplysmoothtomountaintops_allow_svc_change(this.ptr,t)}constructor(t,o,n,r){const s=e.smoothingoperationapplysmoothtomountaintops_new(t,o,n,r);return A.__wrap(s)}apply_to_api(t){b(t,u),e.smoothingoperationapplysmoothtomountaintops_apply_to_api(this.ptr,t.ptr)}}class E{static __wrap(t){const o=Object.create(E.prototype);return o.ptr=t,o}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();e.__wbg_smoothingoperationincreasealtitudeformountaintops_free(t)}get percentage_of_altitude_step(){return e.__wbg_get_smoothingoperationincreasealtitudeformountaintops_percentage_of_altitude_step(this.ptr)}set percentage_of_altitude_step(t){e.__wbg_set_smoothingoperationincreasealtitudeformountaintops_percentage_of_altitude_step(this.ptr,t)}get allow_svc_change(){return e.__wbg_get_smoothingoperationincreasealtitudeformountaintops_allow_svc_change(this.ptr)!==0}set allow_svc_change(t){e.__wbg_set_smoothingoperationincreasealtitudeformountaintops_allow_svc_change(this.ptr,t)}constructor(t,o){const n=e.smoothingoperationincreasealtitudeformountaintops_new(t,o);return E.__wrap(n)}apply_to_api(t){b(t,u),e.smoothingoperationincreasealtitudeformountaintops_apply_to_api(this.ptr,t.ptr)}}async function X(_,t){if(typeof Response=="function"&&_ instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(_,t)}catch(n){if(_.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const o=await _.arrayBuffer();return await WebAssembly.instantiate(o,t)}else{const o=await WebAssembly.instantiate(_,t);return o instanceof WebAssembly.Instance?{instance:o,module:_}:o}}async function C(_){typeof _=="undefined"&&(_="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(r,s){const a=d(r,s);return N(a)},t.wbg.__wbindgen_object_drop_ref=function(r){g(r)},t.wbg.__wbindgen_json_parse=function(r,s){const a=JSON.parse(d(r,s));return N(a)},t.wbg.__wbindgen_json_serialize=function(r,s){const a=S(s),c=JSON.stringify(a===void 0?null:a),p=M(c,e.__wbindgen_malloc,e.__wbindgen_realloc),l=L;i()[r/4+1]=l,i()[r/4+0]=p},t.wbg.__wbg_new_693216e109162396=function(){const r=new Error;return N(r)},t.wbg.__wbg_stack_0ddaca5d1abfb52f=function(r,s){const a=S(s).stack,c=M(a,e.__wbindgen_malloc,e.__wbindgen_realloc),p=L;i()[r/4+1]=p,i()[r/4+0]=c},t.wbg.__wbg_error_09919627ac0992f5=function(r,s){try{console.error(d(r,s))}finally{e.__wbindgen_free(r,s)}},t.wbg.__wbg_log_e8ba7b992c7ad0eb=function(r){console.log(S(r))},t.wbg.__wbindgen_throw=function(r,s){throw new Error(d(r,s))},(typeof _=="string"||typeof Request=="function"&&_ instanceof Request||typeof URL=="function"&&_ instanceof URL)&&(_=fetch(_));const{instance:o,module:n}=await X(await _,t);return e=o.exports,C.__wbindgen_wasm_module=n,e}function Y(_){return _.map(t=>{const o=new Draggable(t.x,t.y,t.size,t.offsetX,t.offsetY);return o.enableSelection(),o.deselect(),o})}function D(_,t){function o(){if(typeof window!="undefined"){const c=localStorage==null?void 0:localStorage.getItem(_);try{if(c){const p=JSON.parse(c);return t(p)}}catch{return[]}}return[]}function n(c){typeof window!="undefined"&&localStorage.setItem(_,JSON.stringify(c))}const{subscribe:r,update:s,set:a}=z(o());return{subscribe:r,clear:()=>a([]),set:c=>{a(c),n(c)},add:c=>s(p=>{const l=[...p,c];return n(l),l}),remove:c=>s(p=>{const l=p.filter((y,R)=>R!==c);return n(l),l})}}const H=D("targets",Y),P=D("craters",_=>_);function $(_){return _*(180/Math.PI)}function K(_){let t=_.altitude;return t+=.02*_.gradient.map(o=>Math.abs(o)).reduce((o,n)=>Math.max(o,n)),t+1}function Q(_){const t=new Blob([_],{type:"application/json"});return URL.createObjectURL(t)}function T(){const{subscribe:_,set:t}=z();let o,n,r=!1,s;return{subscribe:_,set:t,setup:async a=>{r||(await C(),r=!0),n=a.size;const c=new f({pixels_per_curve:a.curves,parent_relations:a.hierarchy});o=new u,new q(c,45,45,a.size.width,a.size.height,5,50,1,20,.2,[new U(0,.9,5,1,!1),new W(.7,3,5,!1),new E(2,!1),new A(1,8,1,!1)]).apply_to_api(o)},build:()=>{s=o.build().to_js(),s.gltf_url=Q(s.gltf),P.set(s.craters),t(s)},getAlitituteAndGradient:a=>{if(!o)return{x:0,y:0,altitude:0,gradient:[0,0,0]};const c=a.x/n.width*100,p=a.y/n.height*100,l=o.get_altitude_and_gradient_for_point(c,p).to_js();return l.gradient.map(y=>$(y)),l.altitude=K(l),l}}}const tt=T();function V(){const{subscribe:_,set:t}=z();let o=!1;if(!o&&typeof window!="undefined"){const n=localStorage==null?void 0:localStorage.getItem("contourlines");n&&(t(JSON.parse(n)),o=!0)}return{subscribe:_,set:n=>{localStorage.setItem("contourlines",JSON.stringify(n)),t(n),H.clear(),o=!0}}}const et=V();export{P as a,et as c,tt as g,H as t};
