import{w as c}from"./index-bcbe7d6b.js";import{a as u}from"./contourLineStore-53888272.js";import{i as d,O as g,M as f,S as m,a as w,b as y,c as S}from"./@vite-plugin-wasm-pack@wasm-15893286.js";class b{constructor(t,i,n,p,s,e,o,r,h,l,_){this.tree=t,this.rows=i,this.columns=n,this.width=p,this.height=s,this.curve_point_separation=e,this.svc_distance=o,this.catmull_clark_iterations=r,this.lava_path_length=h,this.lava_path_fork_val=l,this.smoothing_operations=_}apply_to_api(t){t.base(this.tree,this.curve_point_separation),t.set_basic_parameters(this.rows,this.columns,this.width,this.height),t.set_svc_parameters(this.svc_distance),t.set_catmull_clark_parameters(this.catmull_clark_iterations),t.set_lava_path_parameters(this.lava_path_length,this.lava_path_fork_val);for(const i of this.smoothing_operations)i.apply_to_api(t)}}function v(a){return a*(180/Math.PI)}function A(a){let t=a.altitude;return t+=1*a.gradient.map(i=>Math.abs(i)).reduce((i,n)=>Math.max(i,n)),t*1.07}function M(a){const t=new Blob([a],{type:"application/json"});return URL.createObjectURL(t)}function j(){const{subscribe:a,set:t}=c();let i,n,p=!1,s;return{subscribe:a,set:t,setup:async(e,o)=>{p||(await d(),p=!0),n=e.size;const r=new g({pixels_per_curve:e.curves,parent_relations:e.hierarchy});i=new f,new b(r,45,45,e.size.width,e.size.height,5,50,1,20,o,[new m(0,.9,5,1,!1),new w(.7,3,5,!1),new y(2,!1),new S(1,8,1,!1)]).apply_to_api(i)},build:e=>{s=i.build().to_js(),s.gltf_url=M(s.gltf),s.craters=s.craters.map(o=>[o[0]*e.size.width/100,o[1]*e.size.height/100]),u.set(s.craters),t(s)},getAlitituteAndGradient:(e,o=!1)=>{if(!i)return{x:0,y:0,altitude:0,gradient:[0,0,0]};let[r,h]=[e.x,e.y];o||(r=e.x/n.width*100,h=e.y/n.height*100);const l=i.get_altitude_and_gradient_for_point(r,h).to_js();return l.gradient.map(_=>v(_)),l.altitude=A(l),l}}}const L=j();export{L as g};
