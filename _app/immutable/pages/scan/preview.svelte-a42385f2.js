import{S as z,i as j,s as E,w as h,x as _,y as $,E as v,q as f,o as c,B as p,l as W,g as m,n as q,p as F,d as u,J as M,v as Y,e as k,c as w,a as y,b as H,X as G,Y as Q,f as T,k as V,m as B,K as N,t as R,h as C}from"../../chunks/index-e68930ae.js";import{P as U}from"../../chunks/P5-6f1bf296.js";import{N as Z,B as I,I as J,c as K}from"../../chunks/NavigationButton-a585e3a7.js";import{P as x}from"../../chunks/Page-5d16365d.js";import{g as P}from"../../chunks/navigation-0e6511d1.js";import{c as ee}from"../../chunks/contourLineStore-1c6f2929.js";import{g as A}from"../../chunks/gltfStore-ba771f2f.js";import{d as te}from"../../chunks/difficultyStore-fde82265.js";import{d as re}from"../../chunks/debugStore-83cd0e31.js";import"../../chunks/preload-helper-60cab3ee.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/index-05c9b9b1.js";import"../../chunks/@vite-plugin-wasm-pack@wasm-9c455baf.js";function D(i){let e,n;return e=new U({props:{sketch:i[1]}}),{c(){h(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,o){$(e,t,o),n=!0},p:v,i(t){n||(f(e.$$.fragment,t),n=!0)},o(t){c(e.$$.fragment,t),n=!1},d(t){p(e,t)}}}function ne(i){let e=i[0],n,t,o=D(i);return{c(){o.c(),n=W()},l(s){o.l(s),n=W()},m(s,r){o.m(s,r),m(s,n,r),t=!0},p(s,[r]){r&1&&E(e,e=s[0])?(q(),c(o,1,1,v),F(),o=D(s),o.c(),f(o,1),o.m(n.parentNode,n)):o.p(s,r)},i(s){t||(f(o),t=!0)},o(s){c(o),t=!1},d(s){s&&u(n),o.d(s)}}}function oe(i,e,n){let{debugMode:t=!1}=e,{foregroundWidth:o}=e,{foregroundHeight:s}=e,{curves:r}=e,{hierarchy:a}=e;const d=l=>{l.setup=()=>{l.createCanvas(o,s),l.background(230),r.forEach((b,S)=>{l.strokeWeight(1),l.stroke(30),l.fill(30),t&&l.text(`${S} (${a[S]})`,b[0][0]-10,b[0][1]-10),l.strokeWeight(4),l.noFill(),l.beginShape();for(let g of b){let O=g[0],X=g[1];l.vertex(O,X)}l.endShape(l.CLOSE)})}};return i.$$set=l=>{"debugMode"in l&&n(0,t=l.debugMode),"foregroundWidth"in l&&n(2,o=l.foregroundWidth),"foregroundHeight"in l&&n(3,s=l.foregroundHeight),"curves"in l&&n(4,r=l.curves),"hierarchy"in l&&n(5,a=l.hierarchy)},[t,d,o,s,r,a]}class se extends z{constructor(e){super(),j(this,e,oe,ne,E,{debugMode:0,foregroundWidth:2,foregroundHeight:3,curves:4,hierarchy:5})}}function L(i){let e,n,t,o;return n=new se({props:{debugMode:i[4],curves:i[3].curves,hierarchy:i[3].hierarchy,foregroundHeight:i[1],foregroundWidth:i[0]}}),{c(){e=k("div"),h(n.$$.fragment),this.h()},l(s){e=w(s,"DIV",{class:!0});var r=y(e);_(n.$$.fragment,r),r.forEach(u),this.h()},h(){H(e,"class","sketch svelte-dbjsc6"),G(()=>i[7].call(e))},m(s,r){m(s,e,r),$(n,e,null),t=Q(e,i[7].bind(e)),o=!0},p(s,r){const a={};r&16&&(a.debugMode=s[4]),r&8&&(a.curves=s[3].curves),r&8&&(a.hierarchy=s[3].hierarchy),r&2&&(a.foregroundHeight=s[1]),r&1&&(a.foregroundWidth=s[0]),n.$set(a)},i(s){o||(f(n.$$.fragment,s),o=!0)},o(s){c(n.$$.fragment,s),o=!1},d(s){s&&u(e),p(n),t()}}}function ae(i){var o,s;let e,n,t=((o=i[3])==null?void 0:o.curves)&&((s=i[3])==null?void 0:s.hierarchy)&&L(i);return{c(){t&&t.c(),e=W()},l(r){t&&t.l(r),e=W()},m(r,a){t&&t.m(r,a),m(r,e,a),n=!0},p(r,a){var d,l;((d=r[3])==null?void 0:d.curves)&&((l=r[3])==null?void 0:l.hierarchy)?t?(t.p(r,a),a&8&&f(t,1)):(t=L(r),t.c(),f(t,1),t.m(e.parentNode,e)):t&&(q(),c(t,1,1,()=>{t=null}),F())},i(r){n||(f(t),n=!0)},o(r){c(t),n=!1},d(r){t&&t.d(r),r&&u(e)}}}function ie(i){let e;return{c(){e=R("Redraw borders")},l(n){e=C(n,"Redraw borders")},m(n,t){m(n,e,t)},d(n){n&&u(e)}}}function le(i){let e,n;return e=new Z({props:{slot:"headerButton",to:"/scan/maptransform",back:!0,$$slots:{default:[ie]},$$scope:{ctx:i}}}),{c(){h(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,o){$(e,t,o),n=!0},p(t,o){const s={};o&512&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(f(e.$$.fragment,t),n=!0)},o(t){c(e.$$.fragment,t),n=!1},d(t){p(e,t)}}}function ue(i){let e;return{c(){e=k("div"),this.h()},l(n){e=w(n,"DIV",{slot:!0,style:!0}),y(e).forEach(u),this.h()},h(){H(e,"slot","background"),T(e,"background","#aaa")},m(n,t){m(n,e,t)},p:v,d(n){n&&u(e)}}}function fe(i){let e,n,t,o,s;return o=new J({props:{path:K}}),{c(){e=k("span"),n=R("Visualise as model"),t=V(),h(o.$$.fragment)},l(r){e=w(r,"SPAN",{});var a=y(e);n=C(a,"Visualise as model"),a.forEach(u),t=B(r),_(o.$$.fragment,r)},m(r,a){m(r,e,a),N(e,n),m(r,t,a),$(o,r,a),s=!0},p:v,i(r){s||(f(o.$$.fragment,r),s=!0)},o(r){c(o.$$.fragment,r),s=!1},d(r){r&&u(e),r&&u(t),p(o,r)}}}function ce(i){let e,n,t,o,s;return o=new J({props:{path:K}}),{c(){e=k("span"),n=R("Visualise in AR"),t=V(),h(o.$$.fragment)},l(r){e=w(r,"SPAN",{});var a=y(e);n=C(a,"Visualise in AR"),a.forEach(u),t=B(r),_(o.$$.fragment,r)},m(r,a){m(r,e,a),N(e,n),m(r,t,a),$(o,r,a),s=!0},p:v,i(r){s||(f(o.$$.fragment,r),s=!0)},o(r){c(o.$$.fragment,r),s=!1},d(r){r&&u(e),r&&u(t),p(o,r)}}}function de(i){let e,n,t,o,s;return n=new I({props:{secondary:!0,loading:!i[2],$$slots:{default:[fe]},$$scope:{ctx:i}}}),n.$on("click",i[5]),o=new I({props:{loading:!i[2],$$slots:{default:[ce]},$$scope:{ctx:i}}}),o.$on("click",i[6]),{c(){e=k("div"),h(n.$$.fragment),t=V(),h(o.$$.fragment),this.h()},l(r){e=w(r,"DIV",{slot:!0});var a=y(e);_(n.$$.fragment,a),t=B(a),_(o.$$.fragment,a),a.forEach(u),this.h()},h(){H(e,"slot","footer")},m(r,a){m(r,e,a),$(n,e,null),N(e,t),$(o,e,null),s=!0},p(r,a){const d={};a&4&&(d.loading=!r[2]),a&512&&(d.$$scope={dirty:a,ctx:r}),n.$set(d);const l={};a&4&&(l.loading=!r[2]),a&512&&(l.$$scope={dirty:a,ctx:r}),o.$set(l)},i(r){s||(f(n.$$.fragment,r),f(o.$$.fragment,r),s=!0)},o(r){c(n.$$.fragment,r),c(o.$$.fragment,r),s=!1},d(r){r&&u(e),p(n),p(o)}}}function me(i){let e,n;return e=new x({props:{title:"Result of transformation",$$slots:{footer:[de],background:[ue],headerButton:[le],default:[ae]},$$scope:{ctx:i}}}),{c(){h(e.$$.fragment)},l(t){_(e.$$.fragment,t)},m(t,o){$(e,t,o),n=!0},p(t,[o]){const s={};o&543&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(f(e.$$.fragment,t),n=!0)},o(t){c(e.$$.fragment,t),n=!1},d(t){p(e,t)}}}function ge(i,e,n){let t,o,s;M(i,ee,g=>n(3,t=g)),M(i,te,g=>n(8,o=g)),M(i,re,g=>n(4,s=g));let r,a,d=!1;Y(async()=>{if(!t.curves||!t.hierarchy)return P("/scan/mapscanning");await A.setup(t,o.lava_forking),A.build(t),n(2,d=!0)});const l=()=>P("/visualise/model"),b=()=>P("/visualise/ar");function S(){r=this.clientWidth,a=this.clientHeight,n(0,r),n(1,a)}return[r,a,d,t,s,l,b,S]}class Ee extends z{constructor(e){super(),j(this,e,ge,me,E,{})}}export{Ee as default};
