import{S as P,i as V,s as W,e as w,c as k,K as E,b as g,g as h,E as B,d as u,w as d,x as p,y as $,q as f,o as m,B as v,O as C,v as R,a as H,$ as S,a0 as q,k as z,l as L,m as A,n as U,p as G,t as M,h as N,J}from"../../chunks/index-7d13a48d.js";import{B as K}from"../../chunks/Button-e0deb53f.js";import{N as T}from"../../chunks/NavigationButton-3046b84a.js";import{P as F,g as j,p as Q}from"../../chunks/imageStore-86a81731.js";import{P as X}from"../../chunks/P5-59b76c1c.js";import{c as Y}from"../../chunks/draggable-10e2ef03.js";import{i as Z,O as x,M as ee,g as te}from"../../chunks/gltfStore-fc398b16.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/index-aa581d55.js";import"../../chunks/preload-helper-60cab3ee.js";function re(o){let e,r;return{c(){e=w("img"),this.h()},l(t){e=k(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){E(e.src,r=o[0])||g(e,"src",r),g(e,"alt",o[1]),g(e,"class","svelte-1mad6ai")},m(t,n){h(t,e,n)},p(t,[n]){n&1&&!E(e.src,r=t[0])&&g(e,"src",r),n&2&&g(e,"alt",t[1])},i:B,o:B,d(t){t&&u(e)}}}function se(o,e,r){let{src:t}=e,{alt:n}=e;return o.$$set=s=>{"src"in s&&r(0,t=s.src),"alt"in s&&r(1,n=s.alt)},[t,n]}class O extends P{constructor(e){super(),V(this,e,se,re,W,{src:0,alt:1})}}function ne(o){let e,r;return e=new X({props:{sketch:o[0]}}),{c(){d(e.$$.fragment)},l(t){p(e.$$.fragment,t)},m(t,n){$(e,t,n),r=!0},p:B,i(t){r||(f(e.$$.fragment,t),r=!0)},o(t){m(e.$$.fragment,t),r=!1},d(t){v(e,t)}}}function ae(o,e,r){let{foregroundWidth:t}=e,{foregroundHeight:n}=e,{curves:s}=e,{hierarchy:a}=e;const l=i=>{i.setup=()=>{i.createCanvas(t,n),i.fill(i.color(255,255,255)),i.stroke(i.color(255,255,255)),s.forEach((b,_)=>{i.text(`${_} (${a[_]})`,b[0][0],b[0][1]);for(let c of b){let y=c[0],I=c[1];i.point(y,I)}})}};return o.$$set=i=>{"foregroundWidth"in i&&r(1,t=i.foregroundWidth),"foregroundHeight"in i&&r(2,n=i.foregroundHeight),"curves"in i&&r(3,s=i.curves),"hierarchy"in i&&r(4,a=i.hierarchy)},[l,t,n,s,a]}class oe extends P{constructor(e){super(),V(this,e,ae,ne,W,{foregroundWidth:1,foregroundHeight:2,curves:3,hierarchy:4})}}function D(o){let e,r,t,n;return r=new oe({props:{curves:o[3].curves,hierarchy:o[3].hierarchy,foregroundHeight:o[1],foregroundWidth:o[0]}}),{c(){e=w("div"),d(r.$$.fragment),this.h()},l(s){e=k(s,"DIV",{class:!0});var a=H(e);p(r.$$.fragment,a),a.forEach(u),this.h()},h(){g(e,"class","sketch svelte-dbjsc6"),S(()=>o[6].call(e))},m(s,a){h(s,e,a),$(r,e,null),t=q(e,o[6].bind(e)),n=!0},p(s,a){const l={};a&8&&(l.curves=s[3].curves),a&8&&(l.hierarchy=s[3].hierarchy),a&2&&(l.foregroundHeight=s[1]),a&1&&(l.foregroundWidth=s[0]),r.$set(l)},i(s){n||(f(r.$$.fragment,s),n=!0)},o(s){m(r.$$.fragment,s),n=!1},d(s){s&&u(e),v(r),t()}}}function ie(o){let e,r,t,n;e=new O({props:{src:o[4],alt:"foreground"}});let s=o[3].curves&&o[3].hierarchy&&D(o);return{c(){d(e.$$.fragment),r=z(),s&&s.c(),t=L()},l(a){p(e.$$.fragment,a),r=A(a),s&&s.l(a),t=L()},m(a,l){$(e,a,l),h(a,r,l),s&&s.m(a,l),h(a,t,l),n=!0},p(a,l){const i={};l&16&&(i.src=a[4]),e.$set(i),a[3].curves&&a[3].hierarchy?s?(s.p(a,l),l&8&&f(s,1)):(s=D(a),s.c(),f(s,1),s.m(t.parentNode,t)):s&&(U(),m(s,1,1,()=>{s=null}),G())},i(a){n||(f(e.$$.fragment,a),f(s),n=!0)},o(a){m(e.$$.fragment,a),m(s),n=!1},d(a){v(e,a),a&&u(r),s&&s.d(a),a&&u(t)}}}function le(o){let e;return{c(){e=M("Redraw borders")},l(r){e=N(r,"Redraw borders")},m(r,t){h(r,e,t)},d(r){r&&u(e)}}}function ce(o){let e,r;return e=new T({props:{slot:"headerButton",to:"/scan/maptransform",back:!0,$$slots:{default:[le]},$$scope:{ctx:o}}}),{c(){d(e.$$.fragment)},l(t){p(e.$$.fragment,t)},m(t,n){$(e,t,n),r=!0},p(t,n){const s={};n&128&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){r||(f(e.$$.fragment,t),r=!0)},o(t){m(e.$$.fragment,t),r=!1},d(t){v(e,t)}}}function ue(o){let e,r,t;return r=new O({props:{src:o[4],alt:"background"}}),{c(){e=w("div"),d(r.$$.fragment),this.h()},l(n){e=k(n,"DIV",{slot:!0});var s=H(e);p(r.$$.fragment,s),s.forEach(u),this.h()},h(){g(e,"slot","background")},m(n,s){h(n,e,s),$(r,e,null),t=!0},p(n,s){const a={};s&16&&(a.src=n[4]),r.$set(a)},i(n){t||(f(r.$$.fragment,n),t=!0)},o(n){m(r.$$.fragment,n),t=!1},d(n){n&&u(e),v(r)}}}function fe(o){let e,r;return{c(){e=w("span"),r=M("Visualise")},l(t){e=k(t,"SPAN",{});var n=H(e);r=N(n,"Visualise"),n.forEach(u)},m(t,n){h(t,e,n),J(e,r)},p:B,d(t){t&&u(e)}}}function me(o){let e,r,t;return r=new K({props:{loading:!o[2],$$slots:{default:[fe]},$$scope:{ctx:o}}}),r.$on("click",o[5]),{c(){e=w("div"),d(r.$$.fragment),this.h()},l(n){e=k(n,"DIV",{slot:!0});var s=H(e);p(r.$$.fragment,s),s.forEach(u),this.h()},h(){g(e,"slot","footer")},m(n,s){h(n,e,s),$(r,e,null),t=!0},p(n,s){const a={};s&4&&(a.loading=!n[2]),s&128&&(a.$$scope={dirty:s,ctx:n}),r.$set(a)},i(n){t||(f(r.$$.fragment,n),t=!0)},o(n){m(r.$$.fragment,n),t=!1},d(n){n&&u(e),v(r)}}}function _e(o){let e,r;return e=new F({props:{title:"image transformation",$$slots:{footer:[me],background:[ue],headerButton:[ce],default:[ie]},$$scope:{ctx:o}}}),{c(){d(e.$$.fragment)},l(t){p(e.$$.fragment,t)},m(t,n){$(e,t,n),r=!0},p(t,[n]){const s={};n&159&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){r||(f(e.$$.fragment,t),r=!0)},o(t){m(e.$$.fragment,t),r=!1},d(t){v(e,t)}}}function ge(o,e,r){let t,n;C(o,Y,_=>r(3,t=_)),C(o,Q,_=>r(4,n=_));let s,a,l=!1;function i(){j("/demo")}R(async()=>{if(!n||!t.curves||!t.hierarchy)return j("/scan/mapscanning");await Z();const _=new x({pixels_per_curve:t.curves,parent_relations:t.hierarchy}),c=new ee;c.base(_),c.set_basic_parameters(30,30,.2),c.set_svc_parameters(15),c.set_catmull_clark_parameters(1),c.set_lava_path_parameters(30,.1),c.apply_smooth_to_layer(0,.7,4,10,!1),c.increase_altitude_for_mountain_tops(.3,!1),c.apply_smooth_to_all(.3,6,10,!1);const y=c.build().to_js(),I=new Blob([y.gltf],{type:"application/json"});te.set(URL.createObjectURL(I)),console.log(y),r(2,l=!0)});function b(){s=this.clientWidth,a=this.clientHeight,r(0,s),r(1,a)}return[s,a,l,t,n,i,b]}class He extends P{constructor(e){super(),V(this,e,ge,_e,W,{})}}export{He as default};
