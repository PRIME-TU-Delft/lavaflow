import{S as T,i as q,s as C,e as O,c as E,K as J,b,g as w,E as L,d as f,w as v,x as $,y as k,q as p,o as m,B as j,O as G,v as nt,a as N,$ as ot,a0 as st,k as at,l as K,m as _t,n as it,p as ct,t as Y,h as Z,J as lt}from"../../chunks/index-7d13a48d.js";import{B as ut}from"../../chunks/Button-e0deb53f.js";import{N as ft}from"../../chunks/NavigationButton-3046b84a.js";import{P as pt,g as Q,p as dt}from"../../chunks/imageStore-801aaa81.js";import{P as mt,c as gt}from"../../chunks/P5-841000ea.js";import{g as ht}from"../../chunks/gltfStore-db91c240.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/index-aa581d55.js";import"../../chunks/preload-helper-60cab3ee.js";function bt(s){let t,e;return{c(){t=O("img"),this.h()},l(r){t=E(r,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){J(t.src,e=s[0])||b(t,"src",e),b(t,"alt",s[1]),b(t,"class","svelte-1mad6ai")},m(r,n){w(r,t,n)},p(r,[n]){n&1&&!J(t.src,e=r[0])&&b(t,"src",e),n&2&&b(t,"alt",r[1])},i:L,o:L,d(r){r&&f(t)}}}function wt(s,t,e){let{src:r}=t,{alt:n}=t;return s.$$set=o=>{"src"in o&&e(0,r=o.src),"alt"in o&&e(1,n=o.alt)},[r,n]}class x extends T{constructor(t){super(),q(this,t,wt,bt,C,{src:0,alt:1})}}function yt(s){let t,e;return t=new mt({props:{sketch:s[0]}}),{c(){v(t.$$.fragment)},l(r){$(t.$$.fragment,r)},m(r,n){k(t,r,n),e=!0},p:L,i(r){e||(p(t.$$.fragment,r),e=!0)},o(r){m(t.$$.fragment,r),e=!1},d(r){j(t,r)}}}function vt(s,t,e){let{foregroundWidth:r}=t,{foregroundHeight:n}=t,{curves:o}=t,{hierarchy:a}=t;const i=c=>{c.setup=()=>{c.createCanvas(r,n),c.fill(c.color(255,255,255)),c.stroke(c.color(255,255,255)),o.forEach((y,h)=>{c.text(`${h} (${a[h]})`,y[0][0],y[0][1]);for(let u of y){let A=u[0],V=u[1];c.point(A,V)}})}};return s.$$set=c=>{"foregroundWidth"in c&&e(1,r=c.foregroundWidth),"foregroundHeight"in c&&e(2,n=c.foregroundHeight),"curves"in c&&e(3,o=c.curves),"hierarchy"in c&&e(4,a=c.hierarchy)},[i,r,n,o,a]}class $t extends T{constructor(t){super(),q(this,t,vt,yt,C,{foregroundWidth:1,foregroundHeight:2,curves:3,hierarchy:4})}}let _;const tt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});tt.decode();let S=null;function R(){return(S===null||S.buffer!==_.memory.buffer)&&(S=new Uint8Array(_.memory.buffer)),S}function H(s,t){return tt.decode(R().subarray(s,s+t))}const d=new Array(32).fill(void 0);d.push(void 0,null,!0,!1);let W=d.length;function M(s){W===d.length&&d.push(d.length+1);const t=W;return W=d[t],d[t]=s,t}function et(s){return d[s]}function kt(s){s<36||(d[s]=W,W=s)}function g(s){const t=et(s);return kt(s),t}let D=0;const z=new TextEncoder("utf-8"),jt=typeof z.encodeInto=="function"?function(s,t){return z.encodeInto(s,t)}:function(s,t){const e=z.encode(s);return t.set(e),{read:s.length,written:e.length}};function Wt(s,t,e){if(e===void 0){const i=z.encode(s),c=t(i.length);return R().subarray(c,c+i.length).set(i),D=i.length,c}let r=s.length,n=t(r);const o=R();let a=0;for(;a<r;a++){const i=s.charCodeAt(a);if(i>127)break;o[n+a]=i}if(a!==r){a!==0&&(s=s.slice(a)),n=e(n,r,r=a+s.length*3);const i=R().subarray(n+a,n+r);a+=jt(s,i).written}return D=a,n}let B=null;function l(){return(B===null||B.buffer!==_.memory.buffer)&&(B=new Int32Array(_.memory.buffer)),B}function It(s,t){if(!(s instanceof t))throw new Error(`expected instance of ${t.name}`);return s.ptr}class F{static __wrap(t){const e=Object.create(F.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_altitudegradientpair_free(t)}}class P{static __wrap(t){const e=Object.create(P.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_modelconstructionapi_free(t)}get rows(){return _.__wbg_get_modelconstructionapi_rows(this.ptr)>>>0}set rows(t){_.__wbg_set_modelconstructionapi_rows(this.ptr,t)}get columns(){return _.__wbg_get_modelconstructionapi_columns(this.ptr)>>>0}set columns(t){_.__wbg_set_modelconstructionapi_columns(this.ptr,t)}get border_size(){return _.__wbg_get_modelconstructionapi_border_size(this.ptr)}set border_size(t){_.__wbg_set_modelconstructionapi_border_size(this.ptr,t)}get altitude_step(){return _.__wbg_get_modelconstructionapi_altitude_step(this.ptr)}set altitude_step(t){_.__wbg_set_modelconstructionapi_altitude_step(this.ptr,t)}get svc_distance(){return _.__wbg_get_modelconstructionapi_svc_distance(this.ptr)}set svc_distance(t){_.__wbg_set_modelconstructionapi_svc_distance(this.ptr,t)}get catmull_clark_iterations(){return _.__wbg_get_modelconstructionapi_catmull_clark_iterations(this.ptr)>>>0}set catmull_clark_iterations(t){_.__wbg_set_modelconstructionapi_catmull_clark_iterations(this.ptr,t)}get lava_path_length(){return _.__wbg_get_modelconstructionapi_lava_path_length(this.ptr)>>>0}set lava_path_length(t){_.__wbg_set_modelconstructionapi_lava_path_length(this.ptr,t)}get lava_path_fork_val(){return _.__wbg_get_modelconstructionapi_lava_path_fork_val(this.ptr)}set lava_path_fork_val(t){_.__wbg_set_modelconstructionapi_lava_path_fork_val(this.ptr,t)}constructor(){const t=_.modelconstructionapi_new();return P.__wrap(t)}set_basic_parameters(t,e,r){_.modelconstructionapi_set_basic_parameters(this.ptr,t,e,r)}set_svc_parameters(t){_.modelconstructionapi_set_svc_parameters(this.ptr,t)}set_catmull_clark_parameters(t){_.modelconstructionapi_set_catmull_clark_parameters(this.ptr,t)}set_lava_path_parameters(t,e){_.modelconstructionapi_set_lava_path_parameters(this.ptr,t,e)}base(t){It(t,I);var e=t.ptr;t.ptr=0,_.modelconstructionapi_base(this.ptr,e)}build(){try{const n=_.__wbindgen_add_to_stack_pointer(-16);_.modelconstructionapi_build(n,this.ptr);var t=l()[n/4+0],e=l()[n/4+1],r=l()[n/4+2];if(r)throw g(e);return U.__wrap(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_altitude_and_gradient_for_point(t,e){try{const a=_.__wbindgen_add_to_stack_pointer(-16);_.modelconstructionapi_get_altitude_and_gradient_for_point(a,this.ptr,t,e);var r=l()[a/4+0],n=l()[a/4+1],o=l()[a/4+2];if(o)throw g(n);return F.__wrap(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}apply_smooth_to_layer(t,e,r,n,o){_.modelconstructionapi_apply_smooth_to_layer(this.ptr,t,e,r,n,o)}set_altitude_for_layer(t,e,r){_.modelconstructionapi_set_altitude_for_layer(this.ptr,t,e,r)}apply_smooth_to_altitude_group(t,e,r,n,o){_.modelconstructionapi_apply_smooth_to_altitude_group(this.ptr,t,e,r,n,o)}increase_altitude_for_altitude_group(t,e,r){_.modelconstructionapi_increase_altitude_for_altitude_group(this.ptr,t,e,r)}apply_smooth_to_middle_layers(t,e,r,n){_.modelconstructionapi_apply_smooth_to_middle_layers(this.ptr,t,e,r,n)}apply_smooth_to_mountain_tops(t,e,r,n){_.modelconstructionapi_apply_smooth_to_mountain_tops(this.ptr,t,e,r,n)}increase_altitude_for_mountain_tops(t,e){_.modelconstructionapi_increase_altitude_for_mountain_tops(this.ptr,t,e)}apply_smooth_to_all(t,e,r,n){_.modelconstructionapi_apply_smooth_to_all(this.ptr,t,e,r,n)}correct_for_altitude_constraints_to_all_layers(){_.modelconstructionapi_correct_for_altitude_constraints_to_all_layers(this.ptr)}}class U{static __wrap(t){const e=Object.create(U.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_modelconstructionresult_free(t)}constructor(t){try{const o=_.__wbindgen_add_to_stack_pointer(-16);_.modelconstructionresult_new(o,M(t));var e=l()[o/4+0],r=l()[o/4+1],n=l()[o/4+2];if(n)throw g(r);return U.__wrap(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const r=_.__wbindgen_add_to_stack_pointer(-16);_.modelconstructionresult_debug(r,this.ptr);var t=l()[r/4+0],e=l()[r/4+1];return H(t,e)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_free(t,e)}}to_js(){try{const n=_.__wbindgen_add_to_stack_pointer(-16);_.modelconstructionresult_to_js(n,this.ptr);var t=l()[n/4+0],e=l()[n/4+1],r=l()[n/4+2];if(r)throw g(e);return g(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}}class I{static __wrap(t){const e=Object.create(I.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();_.__wbg_opencvtree_free(t)}constructor(t){try{const o=_.__wbindgen_add_to_stack_pointer(-16);_.opencvtree_new(o,M(t));var e=l()[o/4+0],r=l()[o/4+1],n=l()[o/4+2];if(n)throw g(r);return I.__wrap(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}debug(){try{const n=_.__wbindgen_add_to_stack_pointer(-16);_.opencvtree_debug(n,this.ptr);var t=l()[n/4+0],e=l()[n/4+1],r=l()[n/4+2];if(r)throw g(e);return g(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}}async function Ot(s,t){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,t)}catch(r){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await s.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(s,t);return e instanceof WebAssembly.Instance?{instance:e,module:s}:e}}async function rt(s){typeof s=="undefined"&&(s="/_app/immutable/assets/wasm_bg.wasm");const t={};t.wbg={},t.wbg.__wbindgen_string_new=function(n,o){const a=H(n,o);return M(a)},t.wbg.__wbindgen_object_drop_ref=function(n){g(n)},t.wbg.__wbindgen_json_parse=function(n,o){const a=JSON.parse(H(n,o));return M(a)},t.wbg.__wbindgen_json_serialize=function(n,o){const a=et(o),i=JSON.stringify(a===void 0?null:a),c=Wt(i,_.__wbindgen_malloc,_.__wbindgen_realloc),y=D;l()[n/4+1]=y,l()[n/4+0]=c},t.wbg.__wbindgen_throw=function(n,o){throw new Error(H(n,o))},(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:e,module:r}=await Ot(await s,t);return _=e.exports,rt.__wbindgen_wasm_module=r,_}function X(s){let t,e,r,n;return e=new $t({props:{curves:s[3].curves,hierarchy:s[3].hierarchy,foregroundHeight:s[1],foregroundWidth:s[0]}}),{c(){t=O("div"),v(e.$$.fragment),this.h()},l(o){t=E(o,"DIV",{class:!0});var a=N(t);$(e.$$.fragment,a),a.forEach(f),this.h()},h(){b(t,"class","sketch svelte-dbjsc6"),ot(()=>s[6].call(t))},m(o,a){w(o,t,a),k(e,t,null),r=st(t,s[6].bind(t)),n=!0},p(o,a){const i={};a&8&&(i.curves=o[3].curves),a&8&&(i.hierarchy=o[3].hierarchy),a&2&&(i.foregroundHeight=o[1]),a&1&&(i.foregroundWidth=o[0]),e.$set(i)},i(o){n||(p(e.$$.fragment,o),n=!0)},o(o){m(e.$$.fragment,o),n=!1},d(o){o&&f(t),j(e),r()}}}function Et(s){let t,e,r,n;t=new x({props:{src:s[4],alt:"foreground"}});let o=s[3].curves&&s[3].hierarchy&&X(s);return{c(){v(t.$$.fragment),e=at(),o&&o.c(),r=K()},l(a){$(t.$$.fragment,a),e=_t(a),o&&o.l(a),r=K()},m(a,i){k(t,a,i),w(a,e,i),o&&o.m(a,i),w(a,r,i),n=!0},p(a,i){const c={};i&16&&(c.src=a[4]),t.$set(c),a[3].curves&&a[3].hierarchy?o?(o.p(a,i),i&8&&p(o,1)):(o=X(a),o.c(),p(o,1),o.m(r.parentNode,r)):o&&(it(),m(o,1,1,()=>{o=null}),ct())},i(a){n||(p(t.$$.fragment,a),p(o),n=!0)},o(a){m(t.$$.fragment,a),m(o),n=!1},d(a){j(t,a),a&&f(e),o&&o.d(a),a&&f(r)}}}function At(s){let t;return{c(){t=Y("Redraw borders")},l(e){t=Z(e,"Redraw borders")},m(e,r){w(e,t,r)},d(e){e&&f(t)}}}function St(s){let t,e;return t=new ft({props:{slot:"headerButton",to:"/scan/maptransform",back:!0,$$slots:{default:[At]},$$scope:{ctx:s}}}),{c(){v(t.$$.fragment)},l(r){$(t.$$.fragment,r)},m(r,n){k(t,r,n),e=!0},p(r,n){const o={};n&128&&(o.$$scope={dirty:n,ctx:r}),t.$set(o)},i(r){e||(p(t.$$.fragment,r),e=!0)},o(r){m(t.$$.fragment,r),e=!1},d(r){j(t,r)}}}function Bt(s){let t,e,r;return e=new x({props:{src:s[4],alt:"background"}}),{c(){t=O("div"),v(e.$$.fragment),this.h()},l(n){t=E(n,"DIV",{slot:!0});var o=N(t);$(e.$$.fragment,o),o.forEach(f),this.h()},h(){b(t,"slot","background")},m(n,o){w(n,t,o),k(e,t,null),r=!0},p(n,o){const a={};o&16&&(a.src=n[4]),e.$set(a)},i(n){r||(p(e.$$.fragment,n),r=!0)},o(n){m(e.$$.fragment,n),r=!1},d(n){n&&f(t),j(e)}}}function Rt(s){let t,e;return{c(){t=O("span"),e=Y("Visualise")},l(r){t=E(r,"SPAN",{});var n=N(t);e=Z(n,"Visualise"),n.forEach(f)},m(r,n){w(r,t,n),lt(t,e)},p:L,d(r){r&&f(t)}}}function Ht(s){let t,e,r;return e=new ut({props:{loading:!s[2],$$slots:{default:[Rt]},$$scope:{ctx:s}}}),e.$on("click",s[5]),{c(){t=O("div"),v(e.$$.fragment),this.h()},l(n){t=E(n,"DIV",{slot:!0});var o=N(t);$(e.$$.fragment,o),o.forEach(f),this.h()},h(){b(t,"slot","footer")},m(n,o){w(n,t,o),k(e,t,null),r=!0},p(n,o){const a={};o&4&&(a.loading=!n[2]),o&128&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){r||(p(e.$$.fragment,n),r=!0)},o(n){m(e.$$.fragment,n),r=!1},d(n){n&&f(t),j(e)}}}function zt(s){let t,e;return t=new pt({props:{title:"image transformation",$$slots:{footer:[Ht],background:[Bt],headerButton:[St],default:[Et]},$$scope:{ctx:s}}}),{c(){v(t.$$.fragment)},l(r){$(t.$$.fragment,r)},m(r,n){k(t,r,n),e=!0},p(r,[n]){const o={};n&159&&(o.$$scope={dirty:n,ctx:r}),t.$set(o)},i(r){e||(p(t.$$.fragment,r),e=!0)},o(r){m(t.$$.fragment,r),e=!1},d(r){j(t,r)}}}function Lt(s,t,e){let r,n;G(s,gt,h=>e(3,r=h)),G(s,dt,h=>e(4,n=h));let o,a,i=!1;function c(){Q("/demo")}nt(async()=>{if(!n||!r.curves||!r.hierarchy)return Q("/scan/mapscanning");await rt();const h=new I({pixels_per_curve:r.curves,parent_relations:r.hierarchy}),u=new P;u.base(h),u.set_basic_parameters(30,30,.2),u.set_svc_parameters(15),u.set_catmull_clark_parameters(1),u.set_lava_path_parameters(30,.1),u.apply_smooth_to_layer(0,.7,4,10,!1),u.increase_altitude_for_mountain_tops(.3,!1),u.apply_smooth_to_all(.3,6,10,!1);const A=u.build().to_js(),V=new Blob([A.gltf],{type:"application/json"});ht.set(URL.createObjectURL(V)),console.log(A),e(2,i=!0)});function y(){o=this.clientWidth,a=this.clientHeight,e(0,o),e(1,a)}return[o,a,i,r,n,c,y]}class Ft extends T{constructor(t){super(),q(this,t,Lt,zt,C,{})}}export{Ft as default};
