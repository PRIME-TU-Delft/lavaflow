import{S as qt,i as Xt,s as Wt,F as qi,e as Ze,k as Zt,c as Je,a as mt,d as Oe,m as Jt,b as ye,g as Ye,K as ct,a6 as Ft,T as Pt,G as Xi,H as Wi,I as Zi,q as gt,o as yt,$ as Ji,t as Yi,h as Qi,a7 as $i,X as en,Y as tn,w as It,x as Bt,y as zt,W as nn,B as jt}from"../../chunks/index-78deb6b4.js";import{S as rn}from"../../chunks/aframe-master-96a99a91.js";import{g as an}from"../../chunks/_commonjsHelpers-56d41998.js";import"../../chunks/gltfStore-f17ea5d9.js";import"../../chunks/index-b55d7b60.js";import"../../chunks/contourLineStore-22a814b1.js";import"../../chunks/difficultyStore-686b8d7b.js";import"../../chunks/@vite-plugin-wasm-pack@wasm-9c455baf.js";import"../../chunks/NavigationButton-041fec4a.js";import"../../chunks/navigation-0e6511d1.js";import"../../chunks/singletons-d1fb5791.js";import"../../chunks/debugStore-9d35858d.js";const Vt=.1;AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){const t=this.el;if(!!this.active&&this.checkpoint!==e){if(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<Vt){this.checkpoint=null;return}t.emit("navigation-start",{checkpoint:e}),this.data.mode==="teleport"&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;const e=this.data,t=this.offset,i=this.position,r=this.targetPosition,a=this.checkpoint;return this.sync(),i.distanceTo(r)<Vt?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:a}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)},sync:function(){const e=this.offset,t=this.position,i=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(i).sub(t)}});var sn=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16});function on(e,t,i){this.type=e,this.index=t,this.pressed=i.pressed,this.value=i.value}var cn=on;const Fe=sn,lt=cn,Ce=.2,we={LEFT:"left",RIGHT:"right"},xe={MOVEMENT:1,ROTATION:2};AFRAME.registerComponent("gamepad-controls",{GamepadButton:Fe,schema:{enabled:{default:!0},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){const e=this.el.sceneEl;this.system=e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(t.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(t.y),this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(xe.MOVEMENT,t);const i=e.x||t.x,r=e.y||t.y;return Math.abs(i)>Ce||Math.abs(r)>Ce},getVelocityDelta:function(){const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(xe.MOVEMENT,t);const i=e.x||t.x,r=e.y||t.y,a=new THREE.Vector3;return Math.abs(i)>Ce&&(a.x+=i),Math.abs(r)>Ce&&(a.z+=r),a},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._lookVector;return this.getJoystick(xe.ROTATION,e),Math.abs(e.x)>Ce||Math.abs(e.y)>Ce},updateRotation:function(e){if(!this.isRotationActive())return;const t=this.data,i=this.yaw,r=this.pitch,a=t.camera.components["look-controls"],h=a&&a.pitchObject&&a.yawObject;h&&(r.rotation.copy(a.pitchObject.rotation),i.rotation.copy(a.yawObject.rotation));const m=this._lookVector;this.getJoystick(xe.ROTATION,m),Math.abs(m.x)<=Ce&&(m.x=0),Math.abs(m.y)<=Ce&&(m.y=0),m.multiplyScalar(t.rotationSensitivity*e/1e3),i.rotation.y-=m.x,r.rotation.x-=m.y,r.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.rotation.x)),t.camera.object3D.rotation.set(r.rotation.x,i.rotation.y,0),h&&(a.pitchObject.rotation.copy(r.rotation),a.yawObject.rotation.copy(i.rotation))},updateButtonState:function(){const e=this.getGamepad(we.RIGHT);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new lt("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new lt("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new lt(e.type,e.index,e))},getGamepad:function(){const e=[],t=[];return function(i){const r=this.el.sceneEl.components["proxy-controls"],a=r&&r.isConnected()&&r.getGamepad(0);if(a)return a;e.length=0;for(let m=0;m<this.system.controllers.length;m++){const b=this.system.controllers[m],w=b?b.gamepad:null;if(e.push(w),w&&w.handedness===i)return w}const h=navigator.getGamepads?navigator.getGamepads():t;for(let m=0;m<h.length;m++){const b=h[m];if(b&&b.hand===i)return b}return e[0]||h[0]}}(),getButton:function(e){return this.getGamepad(we.RIGHT).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?we.RIGHT:we.LEFT).axes[e]},getJoystick:function(e,t){const i=this.getGamepad(e===xe.MOVEMENT?we.LEFT:we.RIGHT);if(i.mapping==="xr-standard")switch(e){case xe.MOVEMENT:return t.set(i.axes[2],i.axes[3]);case xe.ROTATION:return t.set(i.axes[0],i.axes[1])}else switch(e){case xe.MOVEMENT:return t.set(i.axes[0],i.axes[1]);case xe.ROTATION:return t.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',e)},getDpad:function(e){const t=this.getGamepad(we.LEFT);return t.buttons[Fe.DPAD_RIGHT]?e.set((t.buttons[Fe.DPAD_RIGHT].pressed?1:0)+(t.buttons[Fe.DPAD_LEFT].pressed?-1:0),(t.buttons[Fe.DPAD_UP].pressed?-1:0)+(t.buttons[Fe.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){const e=this.getGamepad(we.LEFT);return!!(e&&e.connected)},getID:function(){return this.getGamepad(we.LEFT).id}});(function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,r=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,a=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,h=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function m(V,X){return String(V).indexOf(X)!==-1}var b=function(){return m(navigator.platform,"Win")?"win":m(navigator.platform,"Mac")?"mac":m(navigator.platform,"CrOS")?"cros":m(navigator.platform,"Linux")?"linux":m(navigator.userAgent,"iPad")||m(navigator.platform,"iPod")||m(navigator.platform,"iPhone")?"ios":""}(),w=function(){return m(navigator.userAgent,"Chrome/")?"chrome":m(navigator.vendor,"Apple")?"safari":m(navigator.userAgent,"MSIE")?"ie":m(navigator.userAgent,"Gecko/")?"moz":m(navigator.userAgent,"Opera/")?"opera":""}(),C=w+"-"+b;function x(V,X,G){(C===X||w===X||b===X)&&Object.keys(G).forEach(function(ae){V[ae]=G[ae]})}function N(V,X){var G={};return Object.keys(V).forEach(function(ae){var se=V[ae];X in se&&(G[se[X]]=se)}),G}var _={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:r},92:{code:"OSRight",location:a},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:h},97:{code:"Numpad1",keyCap:"1",location:h},98:{code:"Numpad2",keyCap:"2",location:h},99:{code:"Numpad3",keyCap:"3",location:h},100:{code:"Numpad4",keyCap:"4",location:h},101:{code:"Numpad5",keyCap:"5",location:h},102:{code:"Numpad6",keyCap:"6",location:h},103:{code:"Numpad7",keyCap:"7",location:h},104:{code:"Numpad8",keyCap:"8",location:h},105:{code:"Numpad9",keyCap:"9",location:h},106:{code:"NumpadMultiply",keyCap:"*",location:h},107:{code:"NumpadAdd",keyCap:"+",location:h},108:{code:"NumpadComma",keyCap:",",location:h},109:{code:"NumpadSubtract",keyCap:"-",location:h},110:{code:"NumpadDecimal",keyCap:".",location:h},111:{code:"NumpadDivide",keyCap:"/",location:h},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:h},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:r},161:{code:"ShiftRight",location:a},162:{code:"ControlLeft",location:r},163:{code:"ControlRight",location:a},164:{code:"AltLeft",location:r},165:{code:"AltRight",location:a},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};x(_,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:h},189:{code:"NumpadSubtract",keyCap:"-",location:h}}),x(_,"moz-mac",{12:{code:"NumLock",location:h},173:{code:"Minus",keyCap:"-"}}),x(_,"moz-win",{173:{code:"Minus",keyCap:"-"}}),x(_,"chrome-mac",{93:{code:"OSRight",location:a}}),x(_,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),x(_,"ios",{10:{code:"Enter",location:i}}),x(_,"safari-mac",{91:{code:"OSLeft",location:r},93:{code:"OSRight",location:a},229:{code:"KeyQ",keyCap:"Q"}});var M={};b==="cros"&&(M["U+00A0"]={code:"ShiftLeft",location:r},M["U+00A1"]={code:"ShiftRight",location:a},M["U+00A2"]={code:"ControlLeft",location:r},M["U+00A3"]={code:"ControlRight",location:a},M["U+00A4"]={code:"AltLeft",location:r},M["U+00A5"]={code:"AltRight",location:a}),C==="chrome-mac"&&(M["U+0010"]={code:"ContextMenu"}),C==="safari-mac"&&(M["U+0010"]={code:"ContextMenu"}),b==="ios"&&(M["U+0010"]={code:"Function"},M["U+001C"]={code:"ArrowLeft"},M["U+001D"]={code:"ArrowRight"},M["U+001E"]={code:"ArrowUp"},M["U+001F"]={code:"ArrowDown"},M["U+0001"]={code:"Home"},M["U+0004"]={code:"End"},M["U+000B"]={code:"PageUp"},M["U+000C"]={code:"PageDown"});var P=[];P[r]={16:{code:"ShiftLeft",location:r},17:{code:"ControlLeft",location:r},18:{code:"AltLeft",location:r}},P[a]={16:{code:"ShiftRight",location:a},17:{code:"ControlRight",location:a},18:{code:"AltRight",location:a}},P[h]={13:{code:"NumpadEnter",location:h}},x(P[h],"moz",{109:{code:"NumpadSubtract",location:h},107:{code:"NumpadAdd",location:h}}),x(P[r],"moz-mac",{224:{code:"OSLeft",location:r}}),x(P[a],"moz-mac",{224:{code:"OSRight",location:a}}),x(P[a],"moz-win",{91:{code:"OSRight",location:a}}),x(P[a],"mac",{93:{code:"OSRight",location:a}}),x(P[h],"chrome-mac",{12:{code:"NumLock",location:h}}),x(P[h],"safari-mac",{12:{code:"NumLock",location:h},187:{code:"NumpadAdd",location:h},189:{code:"NumpadSubtract",location:h},190:{code:"NumpadDecimal",location:h},191:{code:"NumpadDivide",location:h}});var re={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};x(re,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var he={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},ne=N(_,"code");try{var me=t&&"location"in new KeyboardEvent("")}catch{}function Ee(V){var X="keyCode"in V?V.keyCode:"which"in V?V.which:0,G=function(){if(me||"keyLocation"in V){var se=me?V.location:V.keyLocation;if(se&&X in P[se])return P[se][X]}return"keyIdentifier"in V&&V.keyIdentifier in M?M[V.keyIdentifier]:X in _?_[X]:null}();if(!G)return null;var ae=function(){var se=re[G.code];return se?V.shiftKey&&"shiftKey"in se?se.shiftKey:se.key:G.code}();return{code:G.code,key:ae,location:G.location,keyCap:G.keyCap}}function ke(V,X){if(V=String(V),!ne.hasOwnProperty(V))return"Undefined";if(X&&String(X).toLowerCase()!=="en-us")throw Error("Unsupported locale");var G=ne[V];return G.keyCap||G.code||"Undefined"}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function V(G,ae,se){ae in G||Object.defineProperty(G,ae,se)}if(V(KeyboardEvent.prototype,"code",{get:function(){var G=Ee(this);return G?G.code:""}}),"key"in KeyboardEvent.prototype){var X=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var G=X.get.call(this);return he.hasOwnProperty(G)?he[G]:G}})}V(KeyboardEvent.prototype,"key",{get:function(){var G=Ee(this);return G&&"key"in G?G.key:"Unidentified"}}),V(KeyboardEvent.prototype,"location",{get:function(){var G=Ee(this);return G&&"location"in G?G.location:i}}),V(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=ke),e.identifyKey=function(V){if(!("code"in V)){var X=Ee(V);V.code=X?X.code:"",V.key=X&&"key"in X?X.key:"Unidentified",V.location="location"in V?V.location:"keyLocation"in V?V.keyLocation:X&&"location"in X?X.location:i,V.locale=""}}})(window);const ln="__keyboard-controls-proxy",hn=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){ln in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new hn(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}});AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.el.sceneEl,t=e.canvas;if(!t){e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd)},removeEventListeners:function(){const e=this.el.sceneEl&&this.el.sceneEl.canvas;!e||(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches.length===2&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()}});const Kt="-controls",un=.2,dn=1e-5;AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const e=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){const t=this.el,i=this.data,r=t.sceneEl.systems.nav;t.sceneEl.hasLoaded&&this.injectControls(),r&&i.constrainToNavMesh!==e.constrainToNavMesh&&(i.constrainToNavMesh?r.addAgent(this):r.removeAgent(this))},injectControls:function(){const e=this.data;var t;for(let i=0;i<e.controls.length;i++)t=e.controls[i]+Kt,this.el.components[t]||this.el.setAttribute(t,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,a){if(!a)return;const h=this.el,m=this.data;if(!m.enabled)return;this.updateVelocityCtrl();const b=this.velocityCtrl,w=this.velocity;if(!!b)if(a/1e3>un?w.set(0,0,0):this.updateVelocity(a),m.constrainToNavMesh&&b.isNavMeshConstrained!==!1){if(w.lengthSq()<dn)return;e.copy(h.object3D.position),t.copy(w).multiplyScalar(a/1e3).add(e);const C=h.sceneEl.systems.nav;this.navGroup=this.navGroup===null?C.getGroup(e):this.navGroup,this.navNode=this.navNode||C.getNode(e,this.navGroup),this.navNode=C.clampStep(e,t,this.navGroup,this.navNode,i),h.object3D.position.copy(i)}else h.hasAttribute("velocity")?h.setAttribute("velocity",w):(h.object3D.position.x+=w.x*a/1e3,h.object3D.position.y+=w.y*a/1e3,h.object3D.position.z+=w.z*a/1e3)}}(),updateVelocityCtrl:function(){const e=this.data;if(e.enabled){for(let t=0,i=e.controls.length;t<i;t++){const r=this.el.components[e.controls[t]+Kt];if(r&&r.isVelocityActive()){this.velocityCtrl=r;return}}this.velocityCtrl=null}},updateVelocity:function(){const e=new THREE.Vector2,t=new THREE.Quaternion;return function(i){let r;const a=this.el,h=this.velocityCtrl,m=this.velocity,b=this.data;if(h)if(h.getVelocityDelta)r=h.getVelocityDelta(i);else if(h.getVelocity){m.copy(h.getVelocity());return}else if(h.getPositionDelta){m.copy(h.getPositionDelta(i).multiplyScalar(1e3/i));return}else throw new Error("Incompatible movement controls: ",h);if(a.hasAttribute("velocity")&&!b.constrainToNavMesh&&m.copy(this.el.getAttribute("velocity")),r&&b.enabled){const w=b.camera;t.copy(w.object3D.quaternion),t.premultiply(a.object3D.quaternion),r.applyQuaternion(t);const C=r.length();b.fly?(m.copy(r),m.multiplyScalar(this.data.speed*16.66667)):(e.set(r.x,r.z),e.setLength(C*this.data.speed*16.66667),m.x=e.x,m.z=e.y)}}}()});AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd);break}},removeEventListeners:function(){const e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":this.isMoving=!0;break;case"press":this.isMoving=!0;break}e.preventDefault()},onTouchEnd:function(e){this.data.mode=="swipe"&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){const t=this.data,i=e.detail.axis;if(this.startingAxisData.length===0&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let r=0,a=0;t.enableNegX&&i[0]<this.startingAxisData[0]&&(r=-1),t.enablePosX&&i[0]>this.startingAxisData[0]&&(r=1),t.enablePosZ&&i[1]>this.startingAxisData[1]&&(a=-1),t.enableNegZ&&i[1]<this.startingAxisData[1]&&(a=1);const h=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>h?(this.zVel=0,this.xVel=r,this.isMoving=!0):(this.xVel=0,this.zVel=a,this.isMoving=!0)}},handleTouchAxis:function(e){const t=this.data,i=e.detail.axis;let r=0,a=0;t.enableNegX&&i[0]<0&&(r=-1),t.enablePosX&&i[0]>0&&(r=1),t.enablePosZ&&i[1]>0&&(a=-1),t.enableNegZ&&i[1]<0&&(a=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=r):(this.xVel=0,this.zVel=a)}});const ht={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(ht)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",t=>{this.load(t.detail.model)})},load:function(e){const t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",i=>{t.emit("animation-loop",{action:i.action,loopDelta:i.loopDelta})}),this.mixer.addEventListener("finished",i=>{t.emit("animation-finished",{action:i.action,direction:i.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;const t=this.data,i=AFRAME.utils.diff(t,e);if("clip"in i){this.stopAction(),t.clip&&this.playAction();return}this.activeActions.forEach(r=>{"duration"in i&&t.duration&&r.setDuration(t.duration),"clampWhenFinished"in i&&(r.clampWhenFinished=t.clampWhenFinished),("loop"in i||"repetitions"in i)&&r.setLoop(ht[t.loop],t.repetitions),"timeScale"in i&&r.setEffectiveTimeScale(t.timeScale)})},stopAction:function(){const e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const e=this.model,t=this.data,i=e.animations||(e.geometry||{}).animations||[];if(!i.length)return;const r=fn(t.clip);for(let a,h=0;a=i[h];h++)if(a.name.match(r)){const m=this.mixer.clipAction(a,e);m.enabled=!0,m.clampWhenFinished=t.clampWhenFinished,t.duration&&m.setDuration(t.duration),t.timeScale!==1&&m.setEffectiveTimeScale(t.timeScale),m.setLoop(ht[t.loop],t.repetitions).fadeIn(t.crossFadeDuration).play(),this.activeActions.push(m)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}});function fn(e){return new RegExp("^"+e.split(/\*+/).map(pn).join(".*")+"$")}function pn(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}var vn=THREE.ColladaLoader=function(e){this.manager=e!==void 0?e:THREE.DefaultLoadingManager};THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var a=this,h=a.path===void 0?THREE.LoaderUtils.extractUrlBase(e):a.path,m=new THREE.FileLoader(a.manager);m.setPath(a.path),m.load(e,function(b){t(a.parse(b,h))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(s,o){for(var u=[],v=s.childNodes,d=0,E=v.length;d<E;d++){var R=v[d];R.nodeName===o&&u.push(R)}return u}function r(s){if(s.length===0)return[];for(var o=s.trim().split(/\s+/),u=new Array(o.length),v=0,d=o.length;v<d;v++)u[v]=o[v];return u}function a(s){if(s.length===0)return[];for(var o=s.trim().split(/\s+/),u=new Array(o.length),v=0,d=o.length;v<d;v++)u[v]=parseFloat(o[v]);return u}function h(s){if(s.length===0)return[];for(var o=s.trim().split(/\s+/),u=new Array(o.length),v=0,d=o.length;v<d;v++)u[v]=parseInt(o[v]);return u}function m(s){return s.substring(1)}function b(){return"three_default_"+Gi++}function w(s){return Object.keys(s).length===0}function C(s){return{unit:x(i(s,"unit")[0]),upAxis:N(i(s,"up_axis")[0])}}function x(s){return s!==void 0&&s.hasAttribute("meter")===!0?parseFloat(s.getAttribute("meter")):1}function N(s){return s!==void 0?s.textContent:"Y_UP"}function _(s,o,u,v){var d=i(s,o)[0];if(d!==void 0)for(var E=i(d,u),R=0;R<E.length;R++)v(E[R])}function M(s,o){for(var u in s){var v=s[u];v.build=o(s[u])}}function P(s,o){return s.build!==void 0||(s.build=o(s)),s.build}function re(s){for(var o={sources:{},samplers:{},channels:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1){var E;switch(d.nodeName){case"source":E=d.getAttribute("id"),o.sources[E]=it(d);break;case"sampler":E=d.getAttribute("id"),o.samplers[E]=he(d);break;case"channel":E=d.getAttribute("target"),o.channels[E]=ne(d);break;default:console.log(d)}}}K.animations[s.getAttribute("id")]=o}function he(s){for(var o={inputs:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"input":var E=m(d.getAttribute("source")),R=d.getAttribute("semantic");o.inputs[R]=E;break}}return o}function ne(s){var o={},u=s.getAttribute("target"),v=u.split("/"),d=v.shift(),E=v.shift(),R=E.indexOf("(")!==-1,L=E.indexOf(".")!==-1;if(L)v=E.split("."),E=v.shift(),o.member=v.shift();else if(R){var D=E.split("(");E=D.shift();for(var j=0;j<D.length;j++)D[j]=parseInt(D[j].replace(/\)/,""));o.indices=D}return o.id=d,o.sid=E,o.arraySyntax=R,o.memberSyntax=L,o.sampler=m(s.getAttribute("source")),o}function me(s){var o=[],u=s.channels,v=s.samplers,d=s.sources;for(var E in u)if(u.hasOwnProperty(E)){var R=u[E],L=v[R.sampler],D=L.inputs.INPUT,j=L.inputs.OUTPUT,O=d[D],z=d[j],$=ke(R,O,z);se($,o)}return o}function Ee(s){return P(K.animations[s],me)}function ke(s,o,u){var v=K.nodes[s.id],d=Ne(v.id),E=v.transforms[s.sid],R=v.matrix.clone().transpose(),L,D,j,O,z,$,q={};switch(E){case"matrix":for(j=0,O=o.array.length;j<O;j++)if(L=o.array[j],D=j*u.stride,q[L]===void 0&&(q[L]={}),s.arraySyntax===!0){var W=u.array[D],I=s.indices[0]+4*s.indices[1];q[L][I]=W}else for(z=0,$=u.stride;z<$;z++)q[L][z]=u.array[D+z];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',E);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',E);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',E);break}var Z=V(q,R),J={name:d.uuid,keyframes:Z};return J}function V(s,o){var u=[];for(var v in s)u.push({time:parseFloat(v),value:s[v]});u.sort(E);for(var d=0;d<16;d++)Qe(u,d,o.elements[d]);return u;function E(R,L){return R.time-L.time}}var X=new THREE.Vector3,G=new THREE.Vector3,ae=new THREE.Quaternion;function se(s,o){for(var u=s.keyframes,v=s.name,d=[],E=[],R=[],L=[],D=0,j=u.length;D<j;D++){var O=u[D],z=O.time,$=O.value;pe.fromArray($).transpose(),pe.decompose(X,ae,G),d.push(z),E.push(X.x,X.y,X.z),R.push(ae.x,ae.y,ae.z,ae.w),L.push(G.x,G.y,G.z)}return E.length>0&&o.push(new THREE.VectorKeyframeTrack(v+".position",d,E)),R.length>0&&o.push(new THREE.QuaternionKeyframeTrack(v+".quaternion",d,R)),L.length>0&&o.push(new THREE.VectorKeyframeTrack(v+".scale",d,L)),o}function Qe(s,o,u){var v,d=!0,E,R;for(E=0,R=s.length;E<R;E++)v=s[E],v.value[o]===void 0?v.value[o]=null:d=!1;if(d===!0)for(E=0,R=s.length;E<R;E++)v=s[E],v.value[o]=u;else $e(s,o)}function $e(s,o){for(var u,v,d=0,E=s.length;d<E;d++){var R=s[d];if(R.value[o]===null){if(u=Ve(s,d,o),v=n(s,d,o),u===null){R.value[o]=v.value[o];continue}if(v===null){R.value[o]=u.value[o];continue}c(R,u,v,o)}}}function Ve(s,o,u){for(;o>=0;){var v=s[o];if(v.value[u]!==null)return v;o--}return null}function n(s,o,u){for(;o<s.length;){var v=s[o];if(v.value[u]!==null)return v;o++}return null}function c(s,o,u,v){if(u.time-o.time===0){s.value[v]=o.value[v];return}s.value[v]=(s.time-o.time)*(u.value[v]-o.value[v])/(u.time-o.time)+o.value[v]}function l(s){for(var o={name:s.getAttribute("id")||"default",start:parseFloat(s.getAttribute("start")||0),end:parseFloat(s.getAttribute("end")||0),animations:[]},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"instance_animation":o.animations.push(m(d.getAttribute("url")));break}}K.clips[s.getAttribute("id")]=o}function f(s){for(var o=[],u=s.name,v=s.end-s.start||-1,d=s.animations,E=0,R=d.length;E<R;E++)for(var L=Ee(d[E]),D=0,j=L.length;D<j;D++)o.push(L[D]);return new THREE.AnimationClip(u,v,o)}function p(s){return P(K.clips[s],f)}function g(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"skin":o.id=m(d.getAttribute("source")),o.skin=y(d);break;case"morph":o.id=m(d.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}K.controllers[s.getAttribute("id")]=o}function y(s){for(var o={sources:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"bind_shape_matrix":o.bindShapeMatrix=a(d.textContent);break;case"source":var E=d.getAttribute("id");o.sources[E]=it(d);break;case"joints":o.joints=T(d);break;case"vertex_weights":o.vertexWeights=S(d);break}}return o}function T(s){for(var o={inputs:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"input":var E=d.getAttribute("semantic"),R=m(d.getAttribute("source"));o.inputs[E]=R;break}}return o}function S(s){for(var o={inputs:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"input":var E=d.getAttribute("semantic"),R=m(d.getAttribute("source")),L=parseInt(d.getAttribute("offset"));o.inputs[E]={id:R,offset:L};break;case"vcount":o.vcount=h(d.textContent);break;case"v":o.v=h(d.textContent);break}}return o}function H(s){var o={id:s.id},u=K.geometries[o.id];return s.skin!==void 0&&(o.skin=A(s.skin),u.sources.skinIndices=o.skin.indices,u.sources.skinWeights=o.skin.weights),o}function A(s){var o=4,u={joints:[],indices:{array:[],stride:o},weights:{array:[],stride:o}},v=s.sources,d=s.vertexWeights,E=d.vcount,R=d.v,L=d.inputs.JOINT.offset,D=d.inputs.WEIGHT.offset,j=s.sources[s.joints.inputs.JOINT],O=s.sources[s.joints.inputs.INV_BIND_MATRIX],z=v[d.inputs.WEIGHT.id].array,$=0,q,W,I;for(q=0,I=E.length;q<I;q++){var Z=E[q],J=[];for(W=0;W<Z;W++){var ee=R[$+L],ie=R[$+D],ce=z[ie];J.push({index:ee,weight:ce}),$+=2}for(J.sort(ot),W=0;W<o;W++){var Y=J[W];Y!==void 0?(u.indices.array.push(Y.index),u.weights.array.push(Y.weight)):(u.indices.array.push(0),u.weights.array.push(0))}}for(s.bindShapeMatrix?u.bindMatrix=new THREE.Matrix4().fromArray(s.bindShapeMatrix).transpose():u.bindMatrix=new THREE.Matrix4().identity(),q=0,I=j.array.length;q<I;q++){var fe=j.array[q],U=new THREE.Matrix4().fromArray(O.array,q*O.stride).transpose();u.joints.push({name:fe,boneInverse:U})}return u;function ot(Xe,Ui){return Ui.weight-Xe.weight}}function B(s){return P(K.controllers[s],H)}function F(s){var o={init_from:i(s,"init_from")[0].textContent};K.images[s.getAttribute("id")]=o}function te(s){return s.build!==void 0?s.build:s.init_from}function ue(s){var o=K.images[s];return o!==void 0?P(o,te):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",s),null)}function le(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"profile_COMMON":o.profile=de(d);break}}K.effects[s.getAttribute("id")]=o}function de(s){for(var o={surfaces:{},samplers:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"newparam":ve(d,o);break;case"technique":o.technique=be(d);break;case"extra":o.extra=Ue(d);break}}return o}function ve(s,o){for(var u=s.getAttribute("sid"),v=0,d=s.childNodes.length;v<d;v++){var E=s.childNodes[v];if(E.nodeType===1)switch(E.nodeName){case"surface":o.surfaces[u]=Pe(E);break;case"sampler2D":o.samplers[u]=Ke(E);break}}}function Pe(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"init_from":o.init_from=d.textContent;break}}return o}function Ke(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"source":o.source=d.textContent;break}}return o}function be(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"constant":case"lambert":case"blinn":case"phong":o.type=d.nodeName,o.parameters=et(d);break}}return o}function et(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":o[d.nodeName]=Te(d);break;case"transparent":o[d.nodeName]={opaque:d.getAttribute("opaque"),data:Te(d)};break}}return o}function Te(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"color":o[d.nodeName]=a(d.textContent);break;case"float":o[d.nodeName]=parseFloat(d.textContent);break;case"texture":o[d.nodeName]={id:d.getAttribute("texture"),extra:Ae(d)};break}}return o}function Ae(s){for(var o={technique:{}},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"extra":Re(d,o);break}}return o}function Re(s,o){for(var u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"technique":Ge(d,o);break}}}function Ge(s,o){for(var u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":o.technique[d.nodeName]=parseFloat(d.textContent);break;case"wrapU":case"wrapV":d.textContent.toUpperCase()==="TRUE"?o.technique[d.nodeName]=1:d.textContent.toUpperCase()==="FALSE"?o.technique[d.nodeName]=0:o.technique[d.nodeName]=parseInt(d.textContent);break}}}function Ue(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"technique":o.technique=Ie(d);break}}return o}function Ie(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"double_sided":o[d.nodeName]=parseInt(d.textContent);break}}return o}function qe(s){return s}function tt(s){return P(K.effects[s],qe)}function $t(s){for(var o={name:s.getAttribute("name")},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"instance_effect":o.url=m(d.getAttribute("url"));break}}K.materials[s.getAttribute("id")]=o}function ei(s){var o,u=s.slice((s.lastIndexOf(".")-1>>>0)+2);switch(u=u.toLowerCase(),u){case"tga":o=rt;break;default:o=Dt}return o}function bt(s){var o=tt(s.url),u=o.profile.technique,v=o.profile.extra,d;switch(u.type){case"phong":case"blinn":d=new THREE.MeshPhongMaterial;break;case"lambert":d=new THREE.MeshLambertMaterial;break;default:d=new THREE.MeshBasicMaterial;break}d.name=s.name;function E($){var q=o.profile.samplers[$.id],W=null;if(q!==void 0){var I=o.profile.surfaces[q.source];W=ue(I.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),W=ue($.id);if(W!==null){var Z=ei(W);if(Z!==void 0){var J=Z.load(W),ee=$.extra;if(ee!==void 0&&ee.technique!==void 0&&w(ee.technique)===!1){var ie=ee.technique;J.wrapS=ie.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,J.wrapT=ie.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,J.offset.set(ie.offsetU||0,ie.offsetV||0),J.repeat.set(ie.repeatU||1,ie.repeatV||1)}else J.wrapS=THREE.RepeatWrapping,J.wrapT=THREE.RepeatWrapping;return J}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",W),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",$.id),null}var R=u.parameters;for(var L in R){var D=R[L];switch(L){case"diffuse":D.color&&d.color.fromArray(D.color),D.texture&&(d.map=E(D.texture));break;case"specular":D.color&&d.specular&&d.specular.fromArray(D.color),D.texture&&(d.specularMap=E(D.texture));break;case"bump":D.texture&&(d.normalMap=E(D.texture));break;case"ambient":D.texture&&(d.lightMap=E(D.texture));break;case"shininess":D.float&&d.shininess&&(d.shininess=D.float);break;case"emission":D.color&&d.emissive&&d.emissive.fromArray(D.color),D.texture&&(d.emissiveMap=E(D.texture));break}}var j=R.transparent,O=R.transparency;if(O===void 0&&j&&(O={float:1}),j===void 0&&O&&(j={opaque:"A_ONE",data:{color:[1,1,1,1]}}),j&&O)if(j.data.texture)d.transparent=!0;else{var z=j.data.color;switch(j.opaque){case"A_ONE":d.opacity=z[3]*O.float;break;case"RGB_ZERO":d.opacity=1-z[0]*O.float;break;case"A_ZERO":d.opacity=1-z[3]*O.float;break;case"RGB_ONE":d.opacity=z[0]*O.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',j.opaque)}d.opacity<1&&(d.transparent=!0)}return v!==void 0&&v.technique!==void 0&&v.technique.double_sided===1&&(d.side=THREE.DoubleSide),d}function ti(s){return P(K.materials[s],bt)}function ii(s){for(var o={name:s.getAttribute("name")},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"optics":o.optics=ni(d);break}}K.cameras[s.getAttribute("id")]=o}function ni(s){for(var o=0;o<s.childNodes.length;o++){var u=s.childNodes[o];switch(u.nodeName){case"technique_common":return ri(u)}}return{}}function ri(s){for(var o={},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];switch(v.nodeName){case"perspective":case"orthographic":o.technique=v.nodeName,o.parameters=ai(v);break}}return o}function ai(s){for(var o={},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];switch(v.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":o[v.nodeName]=parseFloat(v.textContent);break}}return o}function Tt(s){var o;switch(s.optics.technique){case"perspective":o=new THREE.PerspectiveCamera(s.optics.parameters.yfov,s.optics.parameters.aspect_ratio,s.optics.parameters.znear,s.optics.parameters.zfar);break;case"orthographic":var u=s.optics.parameters.ymag,v=s.optics.parameters.xmag,d=s.optics.parameters.aspect_ratio;v=v===void 0?u*d:v,u=u===void 0?v/d:u,v*=.5,u*=.5,o=new THREE.OrthographicCamera(-v,v,u,-u,s.optics.parameters.znear,s.optics.parameters.zfar);break;default:o=new THREE.PerspectiveCamera;break}return o.name=s.name,o}function si(s){var o=K.cameras[s];return o!==void 0?P(o,Tt):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",s),null)}function oi(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"technique_common":o=ci(d);break}}K.lights[s.getAttribute("id")]=o}function ci(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"directional":case"point":case"spot":case"ambient":o.technique=d.nodeName,o.parameters=li(d)}}return o}function li(s){for(var o={},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"color":var E=a(d.textContent);o.color=new THREE.Color().fromArray(E);break;case"falloff_angle":o.falloffAngle=parseFloat(d.textContent);break;case"quadratic_attenuation":var R=parseFloat(d.textContent);o.distance=R?Math.sqrt(1/R):0;break}}return o}function wt(s){var o;switch(s.technique){case"directional":o=new THREE.DirectionalLight;break;case"point":o=new THREE.PointLight;break;case"spot":o=new THREE.SpotLight;break;case"ambient":o=new THREE.AmbientLight;break}return s.parameters.color&&o.color.copy(s.parameters.color),s.parameters.distance&&(o.distance=s.parameters.distance),o}function hi(s){var o=K.lights[s];return o!==void 0?P(o,wt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",s),null)}function ui(s){var o={name:s.getAttribute("name"),sources:{},vertices:{},primitives:[]},u=i(s,"mesh")[0];if(u!==void 0){for(var v=0;v<u.childNodes.length;v++){var d=u.childNodes[v];if(d.nodeType===1){var E=d.getAttribute("id");switch(d.nodeName){case"source":o.sources[E]=it(d);break;case"vertices":o.vertices=di(d);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",d.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":o.primitives.push(fi(d));break;default:console.log(d)}}}K.geometries[s.getAttribute("id")]=o}}function it(s){for(var o={array:[],stride:3},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"float_array":o.array=a(v.textContent);break;case"Name_array":o.array=r(v.textContent);break;case"technique_common":var d=i(v,"accessor")[0];d!==void 0&&(o.stride=parseInt(d.getAttribute("stride")));break}}return o}function di(s){for(var o={},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];v.nodeType===1&&(o[v.getAttribute("semantic")]=m(v.getAttribute("source")))}return o}function fi(s){for(var o={type:s.nodeName,material:s.getAttribute("material"),count:parseInt(s.getAttribute("count")),inputs:{},stride:0,hasUV:!1},u=0,v=s.childNodes.length;u<v;u++){var d=s.childNodes[u];if(d.nodeType===1)switch(d.nodeName){case"input":var E=m(d.getAttribute("source")),R=d.getAttribute("semantic"),L=parseInt(d.getAttribute("offset")),D=parseInt(d.getAttribute("set")),j=D>0?R+D:R;o.inputs[j]={id:E,offset:L},o.stride=Math.max(o.stride,L+1),R==="TEXCOORD"&&(o.hasUV=!0);break;case"vcount":o.vcount=h(d.textContent);break;case"p":o.p=h(d.textContent);break}}return o}function pi(s){for(var o={},u=0;u<s.length;u++){var v=s[u];o[v.type]===void 0&&(o[v.type]=[]),o[v.type].push(v)}return o}function vi(s){for(var o=0,u=0,v=s.length;u<v;u++){var d=s[u];d.hasUV===!0&&o++}o>0&&o<s.length&&(s.uvsNeedsFix=!0)}function xt(s){var o={},u=s.sources,v=s.vertices,d=s.primitives;if(d.length===0)return{};var E=pi(d);for(var R in E){var L=E[R];vi(L),o[R]=mi(L,u,v)}return o}function mi(s,o,u){for(var v={},d={array:[],stride:0},E={array:[],stride:0},R={array:[],stride:0},L={array:[],stride:0},D={array:[],stride:0},j={array:[],stride:4},O={array:[],stride:4},z=new THREE.BufferGeometry,$=[],q=0,W=0;W<s.length;W++){var I=s[W],Z=I.inputs,J=0;switch(I.type){case"lines":case"linestrips":J=I.count*2;break;case"triangles":J=I.count*3;break;case"polylist":for(var ee=0;ee<I.count;ee++){var ie=I.vcount[ee];switch(ie){case 3:J+=3;break;case 4:J+=6;break;default:J+=(ie-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",I.type)}z.addGroup(q,J,W),q+=J,I.material&&$.push(I.material);for(var ce in Z){var Y=Z[ce];switch(ce){case"VERTEX":for(var fe in u){var U=u[fe];switch(fe){case"POSITION":var ot=d.array.length;if(ge(I,o[U],Y.offset,d.array),d.stride=o[U].stride,o.skinWeights&&o.skinIndices&&(ge(I,o.skinIndices,Y.offset,j.array),ge(I,o.skinWeights,Y.offset,O.array)),I.hasUV===!1&&s.uvsNeedsFix===!0)for(var J=(d.array.length-ot)/d.stride,Xe=0;Xe<J;Xe++)R.array.push(0,0);break;case"NORMAL":ge(I,o[U],Y.offset,E.array),E.stride=o[U].stride;break;case"COLOR":ge(I,o[U],Y.offset,D.array),D.stride=o[U].stride;break;case"TEXCOORD":ge(I,o[U],Y.offset,R.array),R.stride=o[U].stride;break;case"TEXCOORD1":ge(I,o[U],Y.offset,L.array),R.stride=o[U].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',fe)}}break;case"NORMAL":ge(I,o[Y.id],Y.offset,E.array),E.stride=o[Y.id].stride;break;case"COLOR":ge(I,o[Y.id],Y.offset,D.array),D.stride=o[Y.id].stride;break;case"TEXCOORD":ge(I,o[Y.id],Y.offset,R.array),R.stride=o[Y.id].stride;break;case"TEXCOORD1":ge(I,o[Y.id],Y.offset,L.array),L.stride=o[Y.id].stride;break}}}return d.array.length>0&&z.addAttribute("position",new THREE.Float32BufferAttribute(d.array,d.stride)),E.array.length>0&&z.addAttribute("normal",new THREE.Float32BufferAttribute(E.array,E.stride)),D.array.length>0&&z.addAttribute("color",new THREE.Float32BufferAttribute(D.array,D.stride)),R.array.length>0&&z.addAttribute("uv",new THREE.Float32BufferAttribute(R.array,R.stride)),L.array.length>0&&z.addAttribute("uv2",new THREE.Float32BufferAttribute(L.array,L.stride)),j.array.length>0&&z.addAttribute("skinIndex",new THREE.Float32BufferAttribute(j.array,j.stride)),O.array.length>0&&z.addAttribute("skinWeight",new THREE.Float32BufferAttribute(O.array,O.stride)),v.data=z,v.type=s[0].type,v.materialKeys=$,v}function ge(s,o,u,v){var d=s.p,E=s.stride,R=s.vcount;function L(ce){for(var Y=d[ce+u]*j,fe=Y+j;Y<fe;Y++)v.push(D[Y])}var D=o.array,j=o.stride;if(s.vcount!==void 0)for(var O=0,z=0,$=R.length;z<$;z++){var q=R[z];if(q===4){var W=O+E*0,I=O+E*1,Z=O+E*2,J=O+E*3;L(W),L(I),L(J),L(I),L(Z),L(J)}else if(q===3){var W=O+E*0,I=O+E*1,Z=O+E*2;L(W),L(I),L(Z)}else if(q>4)for(var ee=1,ie=q-2;ee<=ie;ee++){var W=O+E*0,I=O+E*ee,Z=O+E*(ee+1);L(W),L(I),L(Z)}O+=E*q}else for(var z=0,$=d.length;z<$;z+=E)L(z)}function kt(s){return P(K.geometries[s],xt)}function gi(s){for(var o={name:s.getAttribute("name")||"",joints:{},links:[]},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"technique_common":bi(v,o);break}}K.kinematicsModels[s.getAttribute("id")]=o}function yi(s){return s.build!==void 0?s.build:s}function Ei(s){return P(K.kinematicsModels[s],yi)}function bi(s,o){for(var u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"joint":o.joints[v.getAttribute("sid")]=Ti(v);break;case"link":o.links.push(At(v));break}}}function Ti(s){for(var o,u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"prismatic":case"revolute":o=wi(v);break}}return o}function wi(s,u){for(var u={sid:s.getAttribute("sid"),name:s.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:s.nodeName,static:!1,zeroPosition:0,middlePosition:0},v=0;v<s.childNodes.length;v++){var d=s.childNodes[v];if(d.nodeType===1)switch(d.nodeName){case"axis":var E=a(d.textContent);u.axis.fromArray(E);break;case"limits":var R=d.getElementsByTagName("max")[0],L=d.getElementsByTagName("min")[0];u.limits.max=parseFloat(R.textContent),u.limits.min=parseFloat(L.textContent);break}}return u.limits.min>=u.limits.max&&(u.static=!0),u.middlePosition=(u.limits.min+u.limits.max)/2,u}function At(s){for(var o={sid:s.getAttribute("sid"),name:s.getAttribute("name")||"",attachments:[],transforms:[]},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"attachment_full":o.attachments.push(xi(v));break;case"matrix":case"translate":case"rotate":o.transforms.push(Rt(v));break}}return o}function xi(s){for(var o={joint:s.getAttribute("joint").split("/").pop(),transforms:[],links:[]},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"link":o.links.push(At(v));break;case"matrix":case"translate":case"rotate":o.transforms.push(Rt(v));break}}return o}function Rt(s){var o={type:s.nodeName},u=a(s.textContent);switch(o.type){case"matrix":o.obj=new THREE.Matrix4,o.obj.fromArray(u).transpose();break;case"translate":o.obj=new THREE.Vector3,o.obj.fromArray(u);break;case"rotate":o.obj=new THREE.Vector3,o.obj.fromArray(u),o.angle=THREE.Math.degToRad(u[3]);break}return o}function ki(s){for(var o={name:s.getAttribute("name")||"",rigidBodies:{}},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"rigid_body":o.rigidBodies[v.getAttribute("name")]={},Ai(v,o.rigidBodies[v.getAttribute("name")]);break}}K.physicsModels[s.getAttribute("id")]=o}function Ai(s,o){for(var u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"technique_common":Ri(v,o);break}}}function Ri(s,o){for(var u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"inertia":o.inertia=a(v.textContent);break;case"mass":o.mass=a(v.textContent)[0];break}}}function Ci(s){for(var o={bindJointAxis:[]},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"bind_joint_axis":o.bindJointAxis.push(Si(v));break}}K.kinematicsScenes[m(s.getAttribute("url"))]=o}function Si(s){for(var o={target:s.getAttribute("target").split("/").pop()},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"axis":var d=v.getElementsByTagName("param")[0];o.axis=d.textContent;var E=o.axis.split("inst_").pop().split("axis")[0];o.jointIndex=E.substr(0,E.length-1);break}}return o}function Mi(s){return s.build!==void 0?s.build:s}function _i(s){return P(K.kinematicsScenes[s],Mi)}function Hi(){var s=Object.keys(K.kinematicsModels)[0],o=Object.keys(K.kinematicsScenes)[0],u=Object.keys(K.visualScenes)[0];if(s===void 0||o===void 0)return;for(var v=Ei(s),d=_i(o),E=Lt(u),R=d.bindJointAxis,L={},D=0,j=R.length;D<j;D++){var O=R[D],z=oe.querySelector('[sid="'+O.target+'"]');if(z){var $=z.parentElement;q(O.jointIndex,$)}}function q(I,Z){var J=Z.getAttribute("name"),ee=v.joints[I];E.traverse(function(ie){ie.name===J&&(L[I]={object:ie,transforms:Li(Z),joint:ee,position:ee.zeroPosition})})}var W=new THREE.Matrix4;Nt={joints:v&&v.joints,getJointValue:function(I){var Z=L[I];if(Z)return Z.position;console.warn("THREE.ColladaLoader: Joint "+I+" doesn't exist.")},setJointValue:function(I,Z){var J=L[I];if(J){var ee=J.joint;if(Z>ee.limits.max||Z<ee.limits.min)console.warn("THREE.ColladaLoader: Joint "+I+" value "+Z+" outside of limits (min: "+ee.limits.min+", max: "+ee.limits.max+").");else if(ee.static)console.warn("THREE.ColladaLoader: Joint "+I+" is static.");else{var ie=J.object,ce=ee.axis,Y=J.transforms;pe.identity();for(var fe=0;fe<Y.length;fe++){var U=Y[fe];if(U.sid&&U.sid.indexOf(I)!==-1)switch(ee.type){case"revolute":pe.multiply(W.makeRotationAxis(ce,THREE.Math.degToRad(Z)));break;case"prismatic":pe.multiply(W.makeTranslation(ce.x*Z,ce.y*Z,ce.z*Z));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+ee.type);break}else switch(U.type){case"matrix":pe.multiply(U.obj);break;case"translate":pe.multiply(W.makeTranslation(U.obj.x,U.obj.y,U.obj.z));break;case"scale":pe.scale(U.obj);break;case"rotate":pe.multiply(W.makeRotationAxis(U.obj,U.angle));break}}ie.matrix.copy(pe),ie.matrix.decompose(ie.position,ie.quaternion,ie.scale),L[I].position=Z}}else console.log("THREE.ColladaLoader: "+I+" does not exist.")}}}function Li(s){for(var o=[],u=oe.querySelector('[id="'+s.id+'"]'),v=0;v<u.childNodes.length;v++){var d=u.childNodes[v];if(d.nodeType===1)switch(d.nodeName){case"matrix":var R=a(d.textContent),E=new THREE.Matrix4().fromArray(R).transpose();o.push({sid:d.getAttribute("sid"),type:d.nodeName,obj:E});break;case"translate":case"scale":var R=a(d.textContent),L=new THREE.Vector3().fromArray(R);o.push({sid:d.getAttribute("sid"),type:d.nodeName,obj:L});break;case"rotate":var R=a(d.textContent),L=new THREE.Vector3().fromArray(R),D=THREE.Math.degToRad(R[3]);o.push({sid:d.getAttribute("sid"),type:d.nodeName,obj:L,angle:D});break}}return o}function Oi(s){for(var o=s.getElementsByTagName("node"),u=0;u<o.length;u++){var v=o[u];v.hasAttribute("id")===!1&&v.setAttribute("id",b())}}var pe=new THREE.Matrix4,De=new THREE.Vector3;function nt(s){for(var o={name:s.getAttribute("name")||"",type:s.getAttribute("type"),id:s.getAttribute("id"),sid:s.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];if(v.nodeType===1)switch(v.nodeName){case"node":o.nodes.push(v.getAttribute("id")),nt(v);break;case"instance_camera":o.instanceCameras.push(m(v.getAttribute("url")));break;case"instance_controller":o.instanceControllers.push(Ct(v));break;case"instance_light":o.instanceLights.push(m(v.getAttribute("url")));break;case"instance_geometry":o.instanceGeometries.push(Ct(v));break;case"instance_node":o.instanceNodes.push(m(v.getAttribute("url")));break;case"matrix":var E=a(v.textContent);o.matrix.multiply(pe.fromArray(E).transpose()),o.transforms[v.getAttribute("sid")]=v.nodeName;break;case"translate":var E=a(v.textContent);De.fromArray(E),o.matrix.multiply(pe.makeTranslation(De.x,De.y,De.z)),o.transforms[v.getAttribute("sid")]=v.nodeName;break;case"rotate":var E=a(v.textContent),d=THREE.Math.degToRad(E[3]);o.matrix.multiply(pe.makeRotationAxis(De.fromArray(E),d)),o.transforms[v.getAttribute("sid")]=v.nodeName;break;case"scale":var E=a(v.textContent);o.matrix.scale(De.fromArray(E)),o.transforms[v.getAttribute("sid")]=v.nodeName;break;case"extra":break;default:console.log(v)}}return _t(o.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",o.id):K.nodes[o.id]=o,o}function Ct(s){for(var o={id:m(s.getAttribute("url")),materials:{},skeletons:[]},u=0;u<s.childNodes.length;u++){var v=s.childNodes[u];switch(v.nodeName){case"bind_material":for(var d=v.getElementsByTagName("instance_material"),E=0;E<d.length;E++){var R=d[E],L=R.getAttribute("symbol"),D=R.getAttribute("target");o.materials[L]=m(D)}break;case"skeleton":o.skeletons.push(m(v.textContent));break}}return o}function Di(s,o){var u=[],v=[],d,E,R;for(d=0;d<s.length;d++){var L=s[d],D;if(_t(L))D=Ne(L),St(D,o,u);else if(Bi(L))for(var j=K.visualScenes[L],O=j.children,E=0;E<O.length;E++){var z=O[E];if(z.type==="JOINT"){var D=Ne(z.id);St(D,o,u)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",L)}for(d=0;d<o.length;d++)for(E=0;E<u.length;E++)if(R=u[E],R.bone.name===o[d].name){v[d]=R,R.processed=!0;break}for(d=0;d<u.length;d++)R=u[d],R.processed===!1&&(v.push(R),R.processed=!0);var $=[],q=[];for(d=0;d<v.length;d++)R=v[d],$.push(R.bone),q.push(R.boneInverse);return new THREE.Skeleton($,q)}function St(s,o,u){s.traverse(function(v){if(v.isBone===!0){for(var d,E=0;E<o.length;E++){var R=o[E];if(R.name===v.name){d=R.boneInverse;break}}d===void 0&&(d=new THREE.Matrix4),u.push({bone:v,boneInverse:d,processed:!1})}})}function Ni(s){for(var o=[],u=s.matrix,v=s.nodes,d=s.type,E=s.instanceCameras,R=s.instanceControllers,L=s.instanceLights,D=s.instanceGeometries,j=s.instanceNodes,O=0,z=v.length;O<z;O++)o.push(Ne(v[O]));for(var O=0,z=E.length;O<z;O++){var $=si(E[O]);$!==null&&o.push($.clone())}for(var O=0,z=R.length;O<z;O++)for(var q=R[O],W=B(q.id),I=kt(W.id),Z=Mt(I,q.materials),J=q.skeletons,ee=W.skin.joints,ie=Di(J,ee),ce=0,Y=Z.length;ce<Y;ce++){var U=Z[ce];U.isSkinnedMesh&&(U.bind(ie,W.skin.bindMatrix),U.normalizeSkinWeights()),o.push(U)}for(var O=0,z=L.length;O<z;O++){var fe=hi(L[O]);fe!==null&&o.push(fe.clone())}for(var O=0,z=D.length;O<z;O++)for(var q=D[O],I=kt(q.id),Z=Mt(I,q.materials),ce=0,Y=Z.length;ce<Y;ce++)o.push(Z[ce]);for(var O=0,z=j.length;O<z;O++)o.push(Ne(j[O]).clone());var U;if(v.length===0&&o.length===1)U=o[0];else{U=d==="JOINT"?new THREE.Bone:new THREE.Group;for(var O=0;O<o.length;O++)U.add(o[O])}return U.name===""&&(U.name=d==="JOINT"?s.sid:s.name),U.matrix.copy(u),U.matrix.decompose(U.position,U.quaternion,U.scale),U}var Fi=new THREE.MeshBasicMaterial({color:16711935});function Pi(s,o){for(var u=[],v=0,d=s.length;v<d;v++){var E=o[s[v]];E===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",s[v]),u.push(Fi)):u.push(ti(E))}return u}function Mt(s,o){var u=[];for(var v in s){var d=s[v],E=Pi(d.materialKeys,o);E.length===0&&(v==="lines"||v==="linestrips"?E.push(new THREE.LineBasicMaterial):E.push(new THREE.MeshPhongMaterial));var R=d.data.attributes.skinIndex!==void 0;if(R)for(var L=0,D=E.length;L<D;L++)E[L].skinning=!0;var j=E.length===1?E[0]:E,O;switch(v){case"lines":O=new THREE.LineSegments(d.data,j);break;case"linestrips":O=new THREE.Line(d.data,j);break;case"triangles":case"polylist":R?O=new THREE.SkinnedMesh(d.data,j):O=new THREE.Mesh(d.data,j);break}u.push(O)}return u}function _t(s){return K.nodes[s]!==void 0}function Ne(s){return P(K.nodes[s],Ni)}function Ii(s){var o={name:s.getAttribute("name"),children:[]};Oi(s);for(var u=i(s,"node"),v=0;v<u.length;v++)o.children.push(nt(u[v]));K.visualScenes[s.getAttribute("id")]=o}function Ht(s){var o=new THREE.Group;o.name=s.name;for(var u=s.children,v=0;v<u.length;v++){var d=u[v];o.add(Ne(d.id))}return o}function Bi(s){return K.visualScenes[s]!==void 0}function Lt(s){return P(K.visualScenes[s],Ht)}function zi(s){var o=i(s,"instance_visual_scene")[0];return Lt(m(o.getAttribute("url")))}function ji(){var s=K.clips;if(w(s)===!0){if(w(K.animations)===!1){var o=[];for(var u in K.animations)for(var v=Ee(u),d=0,E=v.length;d<E;d++)o.push(v[d]);at.push(new THREE.AnimationClip("default",-1,o))}}else for(var u in s)at.push(p(u))}if(e.length===0)return{scene:new THREE.Scene};var Vi=new DOMParser().parseFromString(e,"application/xml"),oe=i(Vi,"COLLADA")[0],Ki=oe.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ki);var Ot=C(i(oe,"asset")[0]),Dt=new THREE.TextureLoader(this.manager);Dt.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);var rt;THREE.TGALoader&&(rt=new THREE.TGALoader(this.manager),rt.setPath(this.resourcePath||t));var at=[],Nt={},Gi=0,K={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};_(oe,"library_animations","animation",re),_(oe,"library_animation_clips","animation_clip",l),_(oe,"library_controllers","controller",g),_(oe,"library_images","image",F),_(oe,"library_effects","effect",le),_(oe,"library_materials","material",$t),_(oe,"library_cameras","camera",ii),_(oe,"library_lights","light",oi),_(oe,"library_geometries","geometry",ui),_(oe,"library_nodes","node",nt),_(oe,"library_visual_scenes","visual_scene",Ii),_(oe,"library_kinematics_models","kinematics_model",gi),_(oe,"library_physics_models","physics_model",ki),_(oe,"scene","instance_kinematics_scene",Ci),M(K.animations,me),M(K.clips,f),M(K.controllers,H),M(K.images,te),M(K.effects,qe),M(K.materials,bt),M(K.cameras,Tt),M(K.lights,wt),M(K.geometries,xt),M(K.visualScenes,Ht),ji(),Hi();var st=zi(i(oe,"scene")[0]);return Ot.upAxis==="Z_UP"&&st.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),st.scale.multiplyScalar(Ot.unit),{animations:at,kinematics:Nt,library:K,scene:st}}};THREE.ColladaLoader=vn;AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,i=this.data,r=this.el.sceneEl.systems.renderer;!i||(this.remove(),this.loader.load(i,function(a){e.model=a.scene,e.model.traverse(function(h){if(h.isMesh){var m=h.material;m.color&&r.applyColorCorrection(m.color),m.map&&r.applyColorCorrection(m.map),m.emissive&&r.applyColorCorrection(m.emissive),m.emissiveMap&&r.applyColorCorrection(m.emissiveMap)}}),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})}))},remove:function(){!this.model||this.el.removeObject3D("mesh")}});var mn=THREE.FBXLoader=function(){var e,t,i;function r(n){this.manager=n!==void 0?n:THREE.DefaultLoadingManager}r.prototype={constructor:r,crossOrigin:"anonymous",load:function(n,c,l,f){var p=this,g=THREE.LoaderUtils.extractUrlBase(n),y=new THREE.FileLoader(this.manager);y.setResponseType("arraybuffer"),y.load(n,function(T){try{var S=p.parse(T,g);c(S)}catch(H){setTimeout(function(){f&&f(H),p.manager.itemError(n)},0)}},l,f)},setCrossOrigin:function(n){return this.crossOrigin=n,this},parse:function(n,c){if(N(n))e=new w().parse(n);else{var l=se(n);if(!_(l))throw new Error("THREE.FBXLoader: Unknown format.");if(M(l)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+M(l));e=new b().parse(l)}var f=new THREE.TextureLoader(this.manager).setPath(c).setCrossOrigin(this.crossOrigin);return new a(f).parse(e)}};function a(n){this.textureLoader=n}a.prototype={constructor:a,parse:function(){t=this.parseConnections();var n=this.parseImages(),c=this.parseTextures(n),l=this.parseMaterials(c),f=this.parseDeformers(),p=new h().parse(f);return this.parseScene(f,p,l),i},parseConnections:function(){var n=new Map;if("Connections"in e){var c=e.Connections.connections;c.forEach(function(l){var f=l[0],p=l[1],g=l[2];n.has(f)||n.set(f,{parents:[],children:[]});var y={ID:p,relationship:g};n.get(f).parents.push(y),n.has(p)||n.set(p,{parents:[],children:[]});var T={ID:f,relationship:g};n.get(p).children.push(T)})}return n},parseImages:function(){var n={},c={};if("Video"in e.Objects){var l=e.Objects.Video;for(var f in l){var p=l[f],g=parseInt(f);if(n[g]=p.RelativeFilename||p.Filename,"Content"in p){var y=p.Content instanceof ArrayBuffer&&p.Content.byteLength>0,T=typeof p.Content=="string"&&p.Content!=="";if(y||T){var S=this.parseImage(l[f]);c[p.RelativeFilename||p.Filename]=S}}}}for(var g in n){var H=n[g];c[H]!==void 0?n[g]=c[H]:n[g]=n[g].split("\\").pop()}return n},parseImage:function(n){var c=n.Content,l=n.RelativeFilename||n.Filename,f=l.slice(l.lastIndexOf(".")+1).toLowerCase(),p;switch(f){case"bmp":p="image/bmp";break;case"jpg":case"jpeg":p="image/jpeg";break;case"png":p="image/png";break;case"tif":p="image/tiff";break;case"tga":if(typeof THREE.TGALoader!="function"){console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");return}else{THREE.Loader.Handlers.get(".tga")===null&&THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),p="image/tga";break}default:console.warn('FBXLoader: Image type "'+f+'" is not supported.');return}if(typeof c=="string")return"data:"+p+";base64,"+c;var g=new Uint8Array(c);return window.URL.createObjectURL(new Blob([g],{type:p}))},parseTextures:function(n){var c=new Map;if("Texture"in e.Objects){var l=e.Objects.Texture;for(var f in l){var p=this.parseTexture(l[f],n);c.set(parseInt(f),p)}}return c},parseTexture:function(n,c){var l=this.loadTexture(n,c);l.ID=n.id,l.name=n.attrName;var f=n.WrapModeU,p=n.WrapModeV,g=f!==void 0?f.value:0,y=p!==void 0?p.value:0;if(l.wrapS=g===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.wrapT=y===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in n){var T=n.Scaling.value;l.repeat.x=T[0],l.repeat.y=T[1]}return l},loadTexture:function(n,c){var l,f=this.textureLoader.path,p=t.get(n.id).children;p!==void 0&&p.length>0&&c[p[0].ID]!==void 0&&(l=c[p[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));var g,y=n.FileName.slice(-3).toLowerCase();if(y==="tga"){var T=THREE.Loader.Handlers.get(".tga");T===null?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",l),g=new THREE.Texture):g=T.load(l)}else y==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",l),g=new THREE.Texture):g=this.textureLoader.load(l);return this.textureLoader.setPath(f),g},parseMaterials:function(n){var c=new Map;if("Material"in e.Objects){var l=e.Objects.Material;for(var f in l){var p=this.parseMaterial(l[f],n);p!==null&&c.set(parseInt(f),p)}}return c},parseMaterial:function(n,c){var l=n.id,f=n.attrName,p=n.ShadingModel;if(typeof p=="object"&&(p=p.value),!t.has(l))return null;var g=this.parseParameters(n,c,l),y;switch(p.toLowerCase()){case"phong":y=new THREE.MeshPhongMaterial;break;case"lambert":y=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',p),y=new THREE.MeshPhongMaterial({color:3342591});break}return y.setValues(g),y.name=f,y},parseParameters:function(n,c,l){var f={};n.BumpFactor&&(f.bumpScale=n.BumpFactor.value),n.Diffuse?f.color=new THREE.Color().fromArray(n.Diffuse.value):n.DiffuseColor&&n.DiffuseColor.type==="Color"&&(f.color=new THREE.Color().fromArray(n.DiffuseColor.value)),n.DisplacementFactor&&(f.displacementScale=n.DisplacementFactor.value),n.Emissive?f.emissive=new THREE.Color().fromArray(n.Emissive.value):n.EmissiveColor&&n.EmissiveColor.type==="Color"&&(f.emissive=new THREE.Color().fromArray(n.EmissiveColor.value)),n.EmissiveFactor&&(f.emissiveIntensity=parseFloat(n.EmissiveFactor.value)),n.Opacity&&(f.opacity=parseFloat(n.Opacity.value)),f.opacity<1&&(f.transparent=!0),n.ReflectionFactor&&(f.reflectivity=n.ReflectionFactor.value),n.Shininess&&(f.shininess=n.Shininess.value),n.Specular?f.specular=new THREE.Color().fromArray(n.Specular.value):n.SpecularColor&&n.SpecularColor.type==="Color"&&(f.specular=new THREE.Color().fromArray(n.SpecularColor.value));var p=this;return t.get(l).children.forEach(function(g){var y=g.relationship;switch(y){case"Bump":f.bumpMap=p.getTexture(c,g.ID);break;case"DiffuseColor":f.map=p.getTexture(c,g.ID);break;case"DisplacementColor":f.displacementMap=p.getTexture(c,g.ID);break;case"EmissiveColor":f.emissiveMap=p.getTexture(c,g.ID);break;case"NormalMap":f.normalMap=p.getTexture(c,g.ID);break;case"ReflectionColor":f.envMap=p.getTexture(c,g.ID),f.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":f.specularMap=p.getTexture(c,g.ID);break;case"TransparentColor":f.alphaMap=p.getTexture(c,g.ID),f.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",y);break}}),f},getTexture:function(n,c){return"LayeredTexture"in e.Objects&&c in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),c=t.get(c).children[0].ID),n.get(c)},parseDeformers:function(){var n={},c={};if("Deformer"in e.Objects){var l=e.Objects.Deformer;for(var f in l){var p=l[f],g=t.get(parseInt(f));if(p.attrType==="Skin"){var y=this.parseSkeleton(g,l);y.ID=f,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),y.geometryID=g.parents[0].ID,n[f]=y}else if(p.attrType==="BlendShape"){var T={id:f};T.rawTargets=this.parseMorphTargets(g,l),T.id=f,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),c[f]=T}}}return{skeletons:n,morphTargets:c}},parseSkeleton:function(n,c){var l=[];return n.children.forEach(function(f){var p=c[f.ID];if(p.attrType==="Cluster"){var g={ID:f.ID,indices:[],weights:[],transform:new THREE.Matrix4().fromArray(p.Transform.a),transformLink:new THREE.Matrix4().fromArray(p.TransformLink.a),linkMode:p.Mode};"Indexes"in p&&(g.indices=p.Indexes.a,g.weights=p.Weights.a),l.push(g)}}),{rawBones:l,bones:[]}},parseMorphTargets:function(n,c){for(var l=[],f=0;f<n.children.length;f++){if(f===8){console.warn("FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.");break}var p=n.children[f],g=c[p.ID],y={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a};if(g.attrType!=="BlendShapeChannel")return;var T=t.get(parseInt(p.ID));T.children.forEach(function(S){S.relationship===void 0&&(y.geoID=S.ID)}),l.push(y)}return l},parseScene:function(n,c,l){i=new THREE.Group;var f=this.parseModels(n.skeletons,c,l),p=e.Objects.Model,g=this;f.forEach(function(T){var S=p[T.ID];g.setLookAtProperties(T,S);var H=t.get(T.ID).parents;H.forEach(function(A){var B=f.get(A.ID);B!==void 0&&B.add(T)}),T.parent===null&&i.add(T)}),this.bindSkeleton(n.skeletons,c,f),this.createAmbientLight(),this.setupMorphMaterials();var y=new m().parse();i.children.length===1&&i.children[0].isGroup&&(i.children[0].animations=y,i=i.children[0]),i.animations=y},parseModels:function(n,c,l){var f=new Map,p=e.Objects.Model;for(var g in p){var y=parseInt(g),T=p[g],S=t.get(y),H=this.buildSkeleton(S,n,y,T.attrName);if(!H){switch(T.attrType){case"Camera":H=this.createCamera(S);break;case"Light":H=this.createLight(S);break;case"Mesh":H=this.createMesh(S,c,l);break;case"NurbsCurve":H=this.createCurve(S,c);break;case"LimbNode":case"Null":default:H=new THREE.Group;break}H.name=THREE.PropertyBinding.sanitizeNodeName(T.attrName),H.ID=y}this.setModelTransforms(H,T),f.set(y,H)}return f},buildSkeleton:function(n,c,l,f){var p=null;return n.parents.forEach(function(g){for(var y in c){var T=c[y];T.rawBones.forEach(function(S,H){if(S.ID===g.ID){var A=p;p=new THREE.Bone,p.matrixWorld.copy(S.transformLink),p.name=THREE.PropertyBinding.sanitizeNodeName(f),p.ID=l,T.bones[H]=p,A!==null&&p.add(A)}})}}),p},createCamera:function(n){var c,l;if(n.children.forEach(function(B){var F=e.Objects.NodeAttribute[B.ID];F!==void 0&&(l=F)}),l===void 0)c=new THREE.Object3D;else{var f=0;l.CameraProjectionType!==void 0&&l.CameraProjectionType.value===1&&(f=1);var p=1;l.NearPlane!==void 0&&(p=l.NearPlane.value/1e3);var g=1e3;l.FarPlane!==void 0&&(g=l.FarPlane.value/1e3);var y=window.innerWidth,T=window.innerHeight;l.AspectWidth!==void 0&&l.AspectHeight!==void 0&&(y=l.AspectWidth.value,T=l.AspectHeight.value);var S=y/T,H=45;l.FieldOfView!==void 0&&(H=l.FieldOfView.value);var A=l.FocalLength?l.FocalLength.value:null;switch(f){case 0:c=new THREE.PerspectiveCamera(H,S,p,g),A!==null&&c.setFocalLength(A);break;case 1:c=new THREE.OrthographicCamera(-y/2,y/2,T/2,-T/2,p,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+f+"."),c=new THREE.Object3D;break}}return c},createLight:function(n){var c,l;if(n.children.forEach(function(A){var B=e.Objects.NodeAttribute[A.ID];B!==void 0&&(l=B)}),l===void 0)c=new THREE.Object3D;else{var f;l.LightType===void 0?f=0:f=l.LightType.value;var p=16777215;l.Color!==void 0&&(p=new THREE.Color().fromArray(l.Color.value));var g=l.Intensity===void 0?1:l.Intensity.value/100;l.CastLightOnObject!==void 0&&l.CastLightOnObject.value===0&&(g=0);var y=0;l.FarAttenuationEnd!==void 0&&(l.EnableFarAttenuation!==void 0&&l.EnableFarAttenuation.value===0?y=0:y=l.FarAttenuationEnd.value);var T=1;switch(f){case 0:c=new THREE.PointLight(p,g,y,T);break;case 1:c=new THREE.DirectionalLight(p,g);break;case 2:var S=Math.PI/3;l.InnerAngle!==void 0&&(S=THREE.Math.degToRad(l.InnerAngle.value));var H=0;l.OuterAngle!==void 0&&(H=THREE.Math.degToRad(l.OuterAngle.value),H=Math.max(H,1)),c=new THREE.SpotLight(p,g,y,S,H,T);break;default:console.warn("THREE.FBXLoader: Unknown light type "+l.LightType.value+", defaulting to a THREE.PointLight."),c=new THREE.PointLight(p,g);break}l.CastShadows!==void 0&&l.CastShadows.value===1&&(c.castShadow=!0)}return c},createMesh:function(n,c,l){var f,p=null,g=null,y=[];return n.children.forEach(function(T){c.has(T.ID)&&(p=c.get(T.ID)),l.has(T.ID)&&y.push(l.get(T.ID))}),y.length>1?g=y:y.length>0?g=y[0]:(g=new THREE.MeshPhongMaterial({color:13421772}),y.push(g)),"color"in p.attributes&&y.forEach(function(T){T.vertexColors=THREE.VertexColors}),p.FBX_Deformer?(y.forEach(function(T){T.skinning=!0}),f=new THREE.SkinnedMesh(p,g)):f=new THREE.Mesh(p,g),f},createCurve:function(n,c){var l=n.children.reduce(function(p,g){return c.has(g.ID)&&(p=c.get(g.ID)),p},null),f=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(l,f)},setModelTransforms:function(n,c){var l={};"RotationOrder"in c&&(l.eulerOrder=parseInt(c.RotationOrder.value)),"Lcl_Translation"in c&&(l.translation=c.Lcl_Translation.value),"RotationOffset"in c&&(l.rotationOffset=c.RotationOffset.value),"Lcl_Rotation"in c&&(l.rotation=c.Lcl_Rotation.value),"PreRotation"in c&&(l.preRotation=c.PreRotation.value),"PostRotation"in c&&(l.postRotation=c.PostRotation.value),"Lcl_Scaling"in c&&(l.scale=c.Lcl_Scaling.value);var f=X(l);n.applyMatrix(f)},setLookAtProperties:function(n,c){if("LookAtProperty"in c){var l=t.get(n.ID).children;l.forEach(function(f){if(f.relationship==="LookAtProperty"){var p=e.Objects.Model[f.ID];if("Lcl_Translation"in p){var g=p.Lcl_Translation.value;n.target!==void 0?(n.target.position.fromArray(g),i.add(n.target)):n.lookAt(new THREE.Vector3().fromArray(g))}}})}},bindSkeleton:function(n,c,l){var f=this.parsePoseNodes();for(var p in n){var g=n[p],y=t.get(parseInt(g.ID)).parents;y.forEach(function(T){if(c.has(T.ID)){var S=T.ID,H=t.get(S);H.parents.forEach(function(A){if(l.has(A.ID)){var B=l.get(A.ID);B.bind(new THREE.Skeleton(g.bones),f[A.ID])}})}})}},parsePoseNodes:function(){var n={};if("Pose"in e.Objects){var c=e.Objects.Pose;for(var l in c)if(c[l].attrType==="BindPose"){var f=c[l].PoseNode;Array.isArray(f)?f.forEach(function(p){n[p.Node]=new THREE.Matrix4().fromArray(p.Matrix.a)}):n[f.Node]=new THREE.Matrix4().fromArray(f.Matrix.a)}}return n},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var n=e.GlobalSettings.AmbientColor.value,c=n[0],l=n[1],f=n[2];if(c!==0||l!==0||f!==0){var p=new THREE.Color(c,l,f);i.add(new THREE.AmbientLight(p,1))}}},setupMorphMaterials:function(){i.traverse(function(n){if(n.isMesh&&(n.geometry.morphAttributes.position||n.geometry.morphAttributes.normal)){var c=n.uuid,l=n.material.uuid,f=!1;i.traverse(function(p){p.isMesh&&p.material.uuid===l&&p.uuid!==c&&(f=!0)}),f===!0&&(n.material=n.material.clone()),n.material.morphTargets=!0}})}};function h(){}h.prototype={constructor:h,parse:function(n){var c=new Map;if("Geometry"in e.Objects){var l=e.Objects.Geometry;for(var f in l){var p=t.get(parseInt(f)),g=this.parseGeometry(p,l[f],n);c.set(parseInt(f),g)}}return c},parseGeometry:function(n,c,l){switch(c.attrType){case"Mesh":return this.parseMeshGeometry(n,c,l);case"NurbsCurve":return this.parseNurbsGeometry(c)}},parseMeshGeometry:function(n,c,l){var f=l.skeletons,p=l.morphTargets,g=n.parents.map(function(B){return e.Objects.Model[B.ID]});if(g.length!==0){var y=n.children.reduce(function(B,F){return f[F.ID]!==void 0&&(B=f[F.ID]),B},null),T=n.children.reduce(function(B,F){return p[F.ID]!==void 0&&(B=p[F.ID]),B},null),S=g[0],H={};"RotationOrder"in S&&(H.eulerOrder=S.RotationOrder.value),"GeometricTranslation"in S&&(H.translation=S.GeometricTranslation.value),"GeometricRotation"in S&&(H.rotation=S.GeometricRotation.value),"GeometricScaling"in S&&(H.scale=S.GeometricScaling.value);var A=X(H);return this.genGeometry(c,y,T,A)}},genGeometry:function(n,c,l,f){var p=new THREE.BufferGeometry;n.attrName&&(p.name=n.attrName);var g=this.parseGeoNode(n,c),y=this.genBuffers(g),T=new THREE.Float32BufferAttribute(y.vertex,3);if(f.applyToBufferAttribute(T),p.addAttribute("position",T),y.colors.length>0&&p.addAttribute("color",new THREE.Float32BufferAttribute(y.colors,3)),c&&(p.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(y.weightsIndices,4)),p.addAttribute("skinWeight",new THREE.Float32BufferAttribute(y.vertexWeights,4)),p.FBX_Deformer=c),y.normal.length>0){var S=new THREE.Float32BufferAttribute(y.normal,3),H=new THREE.Matrix3().getNormalMatrix(f);H.applyToBufferAttribute(S),p.addAttribute("normal",S)}if(y.uvs.forEach(function(ue,le){var de="uv"+(le+1).toString();le===0&&(de="uv"),p.addAttribute(de,new THREE.Float32BufferAttribute(y.uvs[le],2))}),g.material&&g.material.mappingType!=="AllSame"){var A=y.materialIndex[0],B=0;if(y.materialIndex.forEach(function(ue,le){ue!==A&&(p.addGroup(B,le-B,A),A=ue,B=le)}),p.groups.length>0){var F=p.groups[p.groups.length-1],te=F.start+F.count;te!==y.materialIndex.length&&p.addGroup(te,y.materialIndex.length-te,A)}p.groups.length===0&&p.addGroup(0,y.materialIndex.length,y.materialIndex[0])}return this.addMorphTargets(p,n,l,f),p},parseGeoNode:function(n,c){var l={};if(l.vertexPositions=n.Vertices!==void 0?n.Vertices.a:[],l.vertexIndices=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],n.LayerElementColor&&(l.color=this.parseVertexColors(n.LayerElementColor[0])),n.LayerElementMaterial&&(l.material=this.parseMaterialIndices(n.LayerElementMaterial[0])),n.LayerElementNormal&&(l.normal=this.parseNormals(n.LayerElementNormal[0])),n.LayerElementUV){l.uv=[];for(var f=0;n.LayerElementUV[f];)l.uv.push(this.parseUVs(n.LayerElementUV[f])),f++}return l.weightTable={},c!==null&&(l.skeleton=c,c.rawBones.forEach(function(p,g){p.indices.forEach(function(y,T){l.weightTable[y]===void 0&&(l.weightTable[y]=[]),l.weightTable[y].push({id:g,weight:p.weights[T]})})})),l},genBuffers:function(n){var c={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},l=0,f=0,p=!1,g=[],y=[],T=[],S=[],H=[],A=[],B=this;return n.vertexIndices.forEach(function(F,te){var ue=!1;F<0&&(F=F^-1,ue=!0);var le=[],de=[];if(g.push(F*3,F*3+1,F*3+2),n.color){var ve=he(te,l,F,n.color);T.push(ve[0],ve[1],ve[2])}if(n.skeleton){if(n.weightTable[F]!==void 0&&n.weightTable[F].forEach(function(Te){de.push(Te.weight),le.push(Te.id)}),de.length>4){p||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),p=!0);var Pe=[0,0,0,0],Ke=[0,0,0,0];de.forEach(function(Te,Ae){var Re=Te,Ge=le[Ae];Ke.forEach(function(Ue,Ie,qe){if(Re>Ue){qe[Ie]=Re,Re=Ue;var tt=Pe[Ie];Pe[Ie]=Ge,Ge=tt}})}),le=Pe,de=Ke}for(;de.length<4;)de.push(0),le.push(0);for(var be=0;be<4;++be)H.push(de[be]),A.push(le[be])}if(n.normal){var ve=he(te,l,F,n.normal);y.push(ve[0],ve[1],ve[2])}if(n.material&&n.material.mappingType!=="AllSame")var et=he(te,l,F,n.material)[0];n.uv&&n.uv.forEach(function(Te,Ae){var Re=he(te,l,F,Te);S[Ae]===void 0&&(S[Ae]=[]),S[Ae].push(Re[0]),S[Ae].push(Re[1])}),f++,ue&&(B.genFace(c,n,g,et,y,T,S,H,A,f),l++,f=0,g=[],y=[],T=[],S=[],H=[],A=[])}),c},genFace:function(n,c,l,f,p,g,y,T,S,H){for(var A=2;A<H;A++)n.vertex.push(c.vertexPositions[l[0]]),n.vertex.push(c.vertexPositions[l[1]]),n.vertex.push(c.vertexPositions[l[2]]),n.vertex.push(c.vertexPositions[l[(A-1)*3]]),n.vertex.push(c.vertexPositions[l[(A-1)*3+1]]),n.vertex.push(c.vertexPositions[l[(A-1)*3+2]]),n.vertex.push(c.vertexPositions[l[A*3]]),n.vertex.push(c.vertexPositions[l[A*3+1]]),n.vertex.push(c.vertexPositions[l[A*3+2]]),c.skeleton&&(n.vertexWeights.push(T[0]),n.vertexWeights.push(T[1]),n.vertexWeights.push(T[2]),n.vertexWeights.push(T[3]),n.vertexWeights.push(T[(A-1)*4]),n.vertexWeights.push(T[(A-1)*4+1]),n.vertexWeights.push(T[(A-1)*4+2]),n.vertexWeights.push(T[(A-1)*4+3]),n.vertexWeights.push(T[A*4]),n.vertexWeights.push(T[A*4+1]),n.vertexWeights.push(T[A*4+2]),n.vertexWeights.push(T[A*4+3]),n.weightsIndices.push(S[0]),n.weightsIndices.push(S[1]),n.weightsIndices.push(S[2]),n.weightsIndices.push(S[3]),n.weightsIndices.push(S[(A-1)*4]),n.weightsIndices.push(S[(A-1)*4+1]),n.weightsIndices.push(S[(A-1)*4+2]),n.weightsIndices.push(S[(A-1)*4+3]),n.weightsIndices.push(S[A*4]),n.weightsIndices.push(S[A*4+1]),n.weightsIndices.push(S[A*4+2]),n.weightsIndices.push(S[A*4+3])),c.color&&(n.colors.push(g[0]),n.colors.push(g[1]),n.colors.push(g[2]),n.colors.push(g[(A-1)*3]),n.colors.push(g[(A-1)*3+1]),n.colors.push(g[(A-1)*3+2]),n.colors.push(g[A*3]),n.colors.push(g[A*3+1]),n.colors.push(g[A*3+2])),c.material&&c.material.mappingType!=="AllSame"&&(n.materialIndex.push(f),n.materialIndex.push(f),n.materialIndex.push(f)),c.normal&&(n.normal.push(p[0]),n.normal.push(p[1]),n.normal.push(p[2]),n.normal.push(p[(A-1)*3]),n.normal.push(p[(A-1)*3+1]),n.normal.push(p[(A-1)*3+2]),n.normal.push(p[A*3]),n.normal.push(p[A*3+1]),n.normal.push(p[A*3+2])),c.uv&&c.uv.forEach(function(B,F){n.uvs[F]===void 0&&(n.uvs[F]=[]),n.uvs[F].push(y[F][0]),n.uvs[F].push(y[F][1]),n.uvs[F].push(y[F][(A-1)*2]),n.uvs[F].push(y[F][(A-1)*2+1]),n.uvs[F].push(y[F][A*2]),n.uvs[F].push(y[F][A*2+1])})},addMorphTargets:function(n,c,l,f){if(l!==null){n.morphAttributes.position=[],n.morphAttributes.normal=[];var p=this;l.rawTargets.forEach(function(g){var y=e.Objects.Geometry[g.geoID];y!==void 0&&p.genMorphGeometry(n,c,y,f)})}},genMorphGeometry:function(n,c,l,f){var p=new THREE.BufferGeometry;l.attrName&&(p.name=l.attrName);for(var g=c.PolygonVertexIndex!==void 0?c.PolygonVertexIndex.a:[],y=c.Vertices!==void 0?c.Vertices.a.slice():[],T=l.Vertices!==void 0?l.Vertices.a:[],S=l.Indexes!==void 0?l.Indexes.a:[],H=0;H<S.length;H++){var A=S[H]*3;y[A]+=T[H*3],y[A+1]+=T[H*3+1],y[A+2]+=T[H*3+2]}var B={vertexIndices:g,vertexPositions:y},F=this.genBuffers(B),te=new THREE.Float32BufferAttribute(F.vertex,3);te.name=l.attrName,f.applyToBufferAttribute(te),n.morphAttributes.position.push(te)},parseNormals:function(n){var c=n.MappingInformationType,l=n.ReferenceInformationType,f=n.Normals.a,p=[];return l==="IndexToDirect"&&("NormalIndex"in n?p=n.NormalIndex.a:"NormalsIndex"in n&&(p=n.NormalsIndex.a)),{dataSize:3,buffer:f,indices:p,mappingType:c,referenceType:l}},parseUVs:function(n){var c=n.MappingInformationType,l=n.ReferenceInformationType,f=n.UV.a,p=[];return l==="IndexToDirect"&&(p=n.UVIndex.a),{dataSize:2,buffer:f,indices:p,mappingType:c,referenceType:l}},parseVertexColors:function(n){var c=n.MappingInformationType,l=n.ReferenceInformationType,f=n.Colors.a,p=[];return l==="IndexToDirect"&&(p=n.ColorIndex.a),{dataSize:4,buffer:f,indices:p,mappingType:c,referenceType:l}},parseMaterialIndices:function(n){var c=n.MappingInformationType,l=n.ReferenceInformationType;if(c==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:l};for(var f=n.Materials.a,p=[],g=0;g<f.length;++g)p.push(g);return{dataSize:1,buffer:f,indices:p,mappingType:c,referenceType:l}},parseNurbsGeometry:function(n){if(THREE.NURBSCurve===void 0)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var c=parseInt(n.Order);if(isNaN(c))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",n.Order,n.id),new THREE.BufferGeometry;for(var l=c-1,f=n.KnotVector.a,p=[],g=n.Points.a,y=0,T=g.length;y<T;y+=4)p.push(new THREE.Vector4().fromArray(g,y));var S,H;if(n.Form==="Closed")p.push(p[0]);else if(n.Form==="Periodic"){S=l,H=f.length-1-S;for(var y=0;y<l;++y)p.push(p[y])}var A=new THREE.NURBSCurve(l,f,p,S,H),B=A.getPoints(p.length*7),F=new Float32Array(B.length*3);B.forEach(function(ue,le){ue.toArray(F,le*3)});var te=new THREE.BufferGeometry;return te.addAttribute("position",new THREE.BufferAttribute(F,3)),te}};function m(){}m.prototype={constructor:m,parse:function(){var n=[],c=this.parseClips();if(c===void 0)return n;for(var l in c){var f=c[l],p=this.addClip(f);n.push(p)}return n},parseClips:function(){if(e.Objects.AnimationCurve!==void 0){var n=this.parseAnimationCurveNodes();this.parseAnimationCurves(n);var c=this.parseAnimationLayers(n),l=this.parseAnimStacks(c);return l}},parseAnimationCurveNodes:function(){var n=e.Objects.AnimationCurveNode,c=new Map;for(var l in n){var f=n[l];if(f.attrName.match(/S|R|T|DeformPercent/)!==null){var p={id:f.id,attr:f.attrName,curves:{}};c.set(p.id,p)}}return c},parseAnimationCurves:function(n){var c=e.Objects.AnimationCurve;for(var l in c){var f={id:c[l].id,times:c[l].KeyTime.a.map(P),values:c[l].KeyValueFloat.a},p=t.get(f.id);if(p!==void 0){var g=p.parents[0].ID,y=p.parents[0].relationship;y.match(/X/)?n.get(g).curves.x=f:y.match(/Y/)?n.get(g).curves.y=f:y.match(/Z/)?n.get(g).curves.z=f:y.match(/d|DeformPercent/)&&n.has(g)&&(n.get(g).curves.morph=f)}}},parseAnimationLayers:function(n){var c=e.Objects.AnimationLayer,l=new Map;for(var f in c){var p=[],g=t.get(parseInt(f));if(g!==void 0){var y=g.children,T=this;y.forEach(function(S,H){if(n.has(S.ID)){var A=n.get(S.ID);if(A.curves.x!==void 0||A.curves.y!==void 0||A.curves.z!==void 0){if(p[H]===void 0){var B;t.get(S.ID).parents.forEach(function(ve){ve.relationship!==void 0&&(B=ve.ID)});var F=e.Objects.Model[B.toString()],te={modelName:THREE.PropertyBinding.sanitizeNodeName(F.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1],transform:T.getModelAnimTransform(F)};"PreRotation"in F&&(te.preRotations=F.PreRotation.value),"PostRotation"in F&&(te.postRotations=F.PostRotation.value),p[H]=te}p[H][A.attr]=A}else if(A.curves.morph!==void 0){if(p[H]===void 0){var ue;t.get(S.ID).parents.forEach(function(be){be.relationship!==void 0&&(ue=be.ID)});var le=t.get(ue).parents[0].ID,de=t.get(le).parents[0].ID,B=t.get(de).parents[0].ID,F=e.Objects.Model[B],te={modelName:THREE.PropertyBinding.sanitizeNodeName(F.attrName),morphName:e.Objects.Deformer[ue].attrName};p[H]=te}p[H][A.attr]=A}}}),l.set(parseInt(f),p)}}return l},getModelAnimTransform:function(n){var c={};return"RotationOrder"in n&&(c.eulerOrder=parseInt(n.RotationOrder.value)),"Lcl_Translation"in n&&(c.translation=n.Lcl_Translation.value),"RotationOffset"in n&&(c.rotationOffset=n.RotationOffset.value),"Lcl_Rotation"in n&&(c.rotation=n.Lcl_Rotation.value),"PreRotation"in n&&(c.preRotation=n.PreRotation.value),"PostRotation"in n&&(c.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(c.scale=n.Lcl_Scaling.value),X(c)},parseAnimStacks:function(n){var c=e.Objects.AnimationStack,l={};for(var f in c){var p=t.get(parseInt(f)).children;p.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var g=n.get(p[0].ID);l[f]={name:c[f].attrName,layer:g}}return l},addClip:function(n){var c=[],l=this;return n.layer.forEach(function(f){c=c.concat(l.generateTracks(f))}),new THREE.AnimationClip(n.name,-1,c)},generateTracks:function(n){var c=[],l=new THREE.Vector3,f=new THREE.Quaternion,p=new THREE.Vector3;if(n.transform&&n.transform.decompose(l,f,p),l=l.toArray(),f=new THREE.Euler().setFromQuaternion(f).toArray(),p=p.toArray(),n.T!==void 0&&Object.keys(n.T.curves).length>0){var g=this.generateVectorTrack(n.modelName,n.T.curves,l,"position");g!==void 0&&c.push(g)}if(n.R!==void 0&&Object.keys(n.R.curves).length>0){var y=this.generateRotationTrack(n.modelName,n.R.curves,f,n.preRotations,n.postRotations);y!==void 0&&c.push(y)}if(n.S!==void 0&&Object.keys(n.S.curves).length>0){var T=this.generateVectorTrack(n.modelName,n.S.curves,p,"scale");T!==void 0&&c.push(T)}if(n.DeformPercent!==void 0){var S=this.generateMorphTrack(n);S!==void 0&&c.push(S)}return c},generateVectorTrack:function(n,c,l,f){var p=this.getTimesForAllAxes(c),g=this.getKeyframeTrackValues(p,c,l);return new THREE.VectorKeyframeTrack(n+"."+f,p,g)},generateRotationTrack:function(n,c,l,f,p){c.x!==void 0&&(this.interpolateRotations(c.x),c.x.values=c.x.values.map(THREE.Math.degToRad)),c.y!==void 0&&(this.interpolateRotations(c.y),c.y.values=c.y.values.map(THREE.Math.degToRad)),c.z!==void 0&&(this.interpolateRotations(c.z),c.z.values=c.z.values.map(THREE.Math.degToRad));var g=this.getTimesForAllAxes(c),y=this.getKeyframeTrackValues(g,c,l);f!==void 0&&(f=f.map(THREE.Math.degToRad),f.push("ZYX"),f=new THREE.Euler().fromArray(f),f=new THREE.Quaternion().setFromEuler(f)),p!==void 0&&(p=p.map(THREE.Math.degToRad),p.push("ZYX"),p=new THREE.Euler().fromArray(p),p=new THREE.Quaternion().setFromEuler(p).inverse());for(var T=new THREE.Quaternion,S=new THREE.Euler,H=[],A=0;A<y.length;A+=3)S.set(y[A],y[A+1],y[A+2],"ZYX"),T.setFromEuler(S),f!==void 0&&T.premultiply(f),p!==void 0&&T.multiply(p),T.toArray(H,A/3*4);return new THREE.QuaternionKeyframeTrack(n+".quaternion",g,H)},generateMorphTrack:function(n){var c=n.DeformPercent.curves.morph,l=c.values.map(function(p){return p/100}),f=i.getObjectByName(n.modelName).morphTargetDictionary[n.morphName];return new THREE.NumberKeyframeTrack(n.modelName+".morphTargetInfluences["+f+"]",c.times,l)},getTimesForAllAxes:function(n){var c=[];return n.x!==void 0&&(c=c.concat(n.x.times)),n.y!==void 0&&(c=c.concat(n.y.times)),n.z!==void 0&&(c=c.concat(n.z.times)),c=c.sort(function(l,f){return l-f}).filter(function(l,f,p){return p.indexOf(l)==f}),c},getKeyframeTrackValues:function(n,c,l){var f=l,p=[],g=-1,y=-1,T=-1;return n.forEach(function(S){if(c.x&&(g=c.x.times.indexOf(S)),c.y&&(y=c.y.times.indexOf(S)),c.z&&(T=c.z.times.indexOf(S)),g!==-1){var H=c.x.values[g];p.push(H),f[0]=H}else p.push(f[0]);if(y!==-1){var A=c.y.values[y];p.push(A),f[1]=A}else p.push(f[1]);if(T!==-1){var B=c.z.values[T];p.push(B),f[2]=B}else p.push(f[2])}),p},interpolateRotations:function(n){for(var c=1;c<n.values.length;c++){var l=n.values[c-1],f=n.values[c]-l,p=Math.abs(f);if(p>=180){for(var g=p/180,y=f/g,T=l+y,S=n.times[c-1],H=n.times[c]-S,A=H/g,B=S+A,F=[],te=[];B<n.times[c];)F.push(B),B+=A,te.push(T),T+=y;n.times=Ve(n.times,c,F),n.values=Ve(n.values,c,te)}}}};function b(){}b.prototype={constructor:b,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(n){this.nodeStack.push(n),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(n,c){this.currentProp=n,this.currentPropName=c},parse:function(n){this.currentIndent=0,console.log("FBXTree: ",x),this.allNodes=new x,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var c=this,l=n.split(/[\r\n]+/);return l.forEach(function(f,p){var g=f.match(/^[\s\t]*;/),y=f.match(/^[\s\t]*$/);if(!(g||y)){var T=f.match("^\\t{"+c.currentIndent+"}(\\w+):(.*){",""),S=f.match("^\\t{"+c.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),H=f.match("^\\t{"+(c.currentIndent-1)+"}}");T?c.parseNodeBegin(f,T):S?c.parseNodeProperty(f,S,l[++p]):H?c.popStack():f.match(/^[^\s\t}]/)&&c.parseNodePropertyContinued(f)}}),this.allNodes},parseNodeBegin:function(n,c){var l=c[1].trim().replace(/^"/,"").replace(/"$/,""),f=c[2].split(",").map(function(T){return T.trim().replace(/^"/,"").replace(/"$/,"")}),p={name:l},g=this.parseNodeAttr(f),y=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(l,p):l in y?(l==="PoseNode"?y.PoseNode.push(p):y[l].id!==void 0&&(y[l]={},y[l][y[l].id]=y[l]),g.id!==""&&(y[l][g.id]=p)):typeof g.id=="number"?(y[l]={},y[l][g.id]=p):l!=="Properties70"&&(l==="PoseNode"?y[l]=[p]:y[l]=p),typeof g.id=="number"&&(p.id=g.id),g.name!==""&&(p.attrName=g.name),g.type!==""&&(p.attrType=g.type),this.pushStack(p)},parseNodeAttr:function(n){var c=n[0];n[0]!==""&&(c=parseInt(n[0]),isNaN(c)&&(c=n[0]));var l="",f="";return n.length>1&&(l=n[1].replace(/^(\w+)::/,""),f=n[2]),{id:c,name:l,type:f}},parseNodeProperty:function(n,c,l){var f=c[1].replace(/^"/,"").replace(/"$/,"").trim(),p=c[2].replace(/^"/,"").replace(/"$/,"").trim();f==="Content"&&p===","&&(p=l.replace(/"/g,"").replace(/,$/,"").trim());var g=this.getCurrentNode(),y=g.name;if(y==="Properties70"){this.parseNodeSpecialProperty(n,f,p);return}if(f==="C"){var T=p.split(",").slice(1),S=parseInt(T[0]),H=parseInt(T[1]),A=p.split(",").slice(3);A=A.map(function(B){return B.trim().replace(/^"/,"")}),f="connections",p=[S,H],Qe(p,A),g[f]===void 0&&(g[f]=[])}f==="Node"&&(g.id=p),f in g&&Array.isArray(g[f])?g[f].push(p):f!=="a"?g[f]=p:g.a=p,this.setCurrentProp(g,f),f==="a"&&p.slice(-1)!==","&&(g.a=ae(p))},parseNodePropertyContinued:function(n){var c=this.getCurrentNode();c.a+=n,n.slice(-1)!==","&&(c.a=ae(c.a))},parseNodeSpecialProperty:function(n,c,l){var f=l.split('",').map(function(H){return H.trim().replace(/^\"/,"").replace(/\s/,"_")}),p=f[0],g=f[1],y=f[2],T=f[3],S=f[4];switch(g){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":S=parseFloat(S);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":S=ae(S);break}this.getPrevNode()[p]={type:g,type2:y,flag:T,value:S},this.setCurrentProp(this.getPrevNode(),p)}};function w(){}w.prototype={constructor:w,parse:function(n){var c=new C(n);c.skip(23);var l=c.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+l);for(var f=new x;!this.endOfContent(c);){var p=this.parseNode(c,l);p!==null&&f.add(p.name,p)}return f},endOfContent:function(n){return n.size()%16===0?(n.getOffset()+160+16&-16)>=n.size():n.getOffset()+160+16>=n.size()},parseNode:function(n,c){var l={},f=c>=7500?n.getUint64():n.getUint32(),p=c>=7500?n.getUint64():n.getUint32();c>=7500?n.getUint64():n.getUint32();var g=n.getUint8(),y=n.getString(g);if(f===0)return null;for(var T=[],S=0;S<p;S++)T.push(this.parseProperty(n));var H=T.length>0?T[0]:"",A=T.length>1?T[1]:"",B=T.length>2?T[2]:"";for(l.singleProperty=p===1&&n.getOffset()===f;f>n.getOffset();){var F=this.parseNode(n,c);F!==null&&this.parseSubNode(y,l,F)}return l.propertyList=T,typeof H=="number"&&(l.id=H),A!==""&&(l.attrName=A),B!==""&&(l.attrType=B),y!==""&&(l.name=y),l},parseSubNode:function(n,c,l){if(l.singleProperty===!0){var f=l.propertyList[0];Array.isArray(f)?(c[l.name]=l,l.a=f):c[l.name]=f}else if(n==="Connections"&&l.name==="C"){var p=[];l.propertyList.forEach(function(B,F){F!==0&&p.push(B)}),c.connections===void 0&&(c.connections=[]),c.connections.push(p)}else if(l.name==="Properties70"){var g=Object.keys(l);g.forEach(function(B){c[B]=l[B]})}else if(n==="Properties70"&&l.name==="P"){var y=l.propertyList[0],T=l.propertyList[1],S=l.propertyList[2],H=l.propertyList[3],A;y.indexOf("Lcl ")===0&&(y=y.replace("Lcl ","Lcl_")),T.indexOf("Lcl ")===0&&(T=T.replace("Lcl ","Lcl_")),T==="Color"||T==="ColorRGB"||T==="Vector"||T==="Vector3D"||T.indexOf("Lcl_")===0?A=[l.propertyList[4],l.propertyList[5],l.propertyList[6]]:A=l.propertyList[4],c[y]={type:T,type2:S,flag:H,value:A}}else c[l.name]===void 0?typeof l.id=="number"?(c[l.name]={},c[l.name][l.id]=l):c[l.name]=l:l.name==="PoseNode"?(Array.isArray(c[l.name])||(c[l.name]=[c[l.name]]),c[l.name].push(l)):c[l.name][l.id]===void 0&&(c[l.name][l.id]=l)},parseProperty:function(n){var c=n.getString(1);switch(c){case"C":return n.getBoolean();case"D":return n.getFloat64();case"F":return n.getFloat32();case"I":return n.getInt32();case"L":return n.getInt64();case"R":var l=n.getUint32();return n.getArrayBuffer(l);case"S":var l=n.getUint32();return n.getString(l);case"Y":return n.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var f=n.getUint32(),p=n.getUint32(),g=n.getUint32();if(p===0)switch(c){case"b":case"c":return n.getBooleanArray(f);case"d":return n.getFloat64Array(f);case"f":return n.getFloat32Array(f);case"i":return n.getInt32Array(f);case"l":return n.getInt64Array(f)}typeof Zlib=="undefined"&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var y=new Zlib.Inflate(new Uint8Array(n.getArrayBuffer(g))),T=new C(y.decompress().buffer);switch(c){case"b":case"c":return T.getBooleanArray(f);case"d":return T.getFloat64Array(f);case"f":return T.getFloat32Array(f);case"i":return T.getInt32Array(f);case"l":return T.getInt64Array(f)}default:throw new Error("THREE.FBXLoader: Unknown property type "+c)}}};function C(n,c){this.dv=new DataView(n),this.offset=0,this.littleEndian=c!==void 0?c:!0}C.prototype={constructor:C,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(n){this.offset+=n},getBoolean:function(){return(this.getUint8()&1)===1},getBooleanArray:function(n){for(var c=[],l=0;l<n;l++)c.push(this.getBoolean());return c},getUint8:function(){var n=this.dv.getUint8(this.offset);return this.offset+=1,n},getInt16:function(){var n=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,n},getInt32:function(){var n=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,n},getInt32Array:function(n){for(var c=[],l=0;l<n;l++)c.push(this.getInt32());return c},getUint32:function(){var n=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,n},getInt64:function(){var n,c;return this.littleEndian?(n=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),n=this.getUint32()),c&2147483648?(c=~c&4294967295,n=~n&4294967295,n===4294967295&&(c=c+1&4294967295),n=n+1&4294967295,-(c*4294967296+n)):c*4294967296+n},getInt64Array:function(n){for(var c=[],l=0;l<n;l++)c.push(this.getInt64());return c},getUint64:function(){var n,c;return this.littleEndian?(n=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),n=this.getUint32()),c*4294967296+n},getFloat32:function(){var n=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,n},getFloat32Array:function(n){for(var c=[],l=0;l<n;l++)c.push(this.getFloat32());return c},getFloat64:function(){var n=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,n},getFloat64Array:function(n){for(var c=[],l=0;l<n;l++)c.push(this.getFloat64());return c},getArrayBuffer:function(n){var c=this.dv.buffer.slice(this.offset,this.offset+n);return this.offset+=n,c},getString:function(n){for(var c=[],l=0;l<n;l++)c[l]=this.getUint8();var f=c.indexOf(0);return f>=0&&(c=c.slice(0,f)),THREE.LoaderUtils.decodeText(new Uint8Array(c))}};function x(){}x.prototype={constructor:x,add:function(n,c){this[n]=c}};function N(n){var c="Kaydara FBX Binary  \0";return n.byteLength>=c.length&&c===se(n,0,c.length)}function _(n){var c=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],l=0;function f(y){var T=n[y-1];return n=n.slice(l+y),l++,T}for(var p=0;p<c.length;++p){var g=f(1);if(g===c[p])return!1}return!0}function M(n){var c=/FBXVersion: (\d+)/,l=n.match(c);if(l){var f=parseInt(l[1]);return f}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function P(n){return n/46186158e3}var re=[];function he(n,c,l,f){var p;switch(f.mappingType){case"ByPolygonVertex":p=n;break;case"ByPolygon":p=c;break;case"ByVertice":p=l;break;case"AllSame":p=f.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+f.mappingType)}f.referenceType==="IndexToDirect"&&(p=f.indices[p]);var g=p*f.dataSize,y=g+f.dataSize;return $e(re,f.buffer,g,y)}var ne=new THREE.Matrix4,me=new THREE.Euler,Ee=new THREE.Vector3,ke=new THREE.Vector3,V=new THREE.Matrix4;function X(n){var c=new THREE.Matrix4;ke.set(0,0,0),V.identity();var l=n.eulerOrder?G(n.eulerOrder):G(0);if(n.translation&&ke.fromArray(n.translation),n.rotationOffset&&ke.add(Ee.fromArray(n.rotationOffset)),n.rotation){var f=n.rotation.map(THREE.Math.degToRad);f.push(l),V.makeRotationFromEuler(me.fromArray(f))}if(n.preRotation){var f=n.preRotation.map(THREE.Math.degToRad);f.push(l),ne.makeRotationFromEuler(me.fromArray(f)),V.premultiply(ne)}if(n.postRotation){var f=n.postRotation.map(THREE.Math.degToRad);f.push(l),ne.makeRotationFromEuler(me.fromArray(f)),ne.getInverse(ne),V.multiply(ne)}return n.scale&&c.scale(Ee.fromArray(n.scale)),c.setPosition(ke),c.multiply(V),c}function G(n){var c=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),c[0]):c[n]}function ae(n){var c=n.split(",").map(function(l){return parseFloat(l)});return c}function se(n,c,l){return c===void 0&&(c=0),l===void 0&&(l=n.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(n,c,l))}function Qe(n,c){for(var l=0,f=n.length,p=c.length;l<p;l++,f++)n[f]=c[l]}function $e(n,c,l,f){for(var p=l,g=0;p<f;p++,g++)n[g]=c[p];return n}function Ve(n,c,l){return n.slice(0,c).concat(l).concat(n.slice(c))}return r}();THREE.FBXLoader=mn;AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const e=this.data;if(!e.src)return;this.remove();const t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});function gn(){return"script_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function yn(e,t){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=t,i.src=e,i}function ut(e){const t=document.getElementById(e),i=t.parentNode;try{i&&i.removeChild(t)}catch{}}function En(e){const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function bn(e,t,i){return new i(function(r,a){const h=t.timeout||5e3,m=gn(),b=yn(e,m),w=setTimeout(function(){a(new Error("Script request to "+e+" timed out")),ut(m)},h),C=function(x){clearTimeout(x)};b.addEventListener("load",function(x){r({ok:!0}),C(w),ut(m)}),b.addEventListener("error",function(x){a(new Error("Script request to "+e+" failed "+x)),C(w),ut(m)}),En(b)})}function Tn(e){return e=e||{},function(t,i){return i=i||{},bn(t,i,e.Promise||Promise)}}var wn=Tn;const xn=wn(),kn="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js",An=function(){let e;return function(){return e=e||xn(kn),e}}();AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=An().then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){const e=this,t=this.el,i=this.data;!i||(this.remove(),this.loaderPromise.then(()=>{this.loader.load(i,function(a){e.model=a.scene,e.model.animations=a.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})})}))},remove:function(){!this.model||this.el.removeObject3D("mesh")}});AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;const t=this.data;!t.src||(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,i=>{i.traverse(r=>{r instanceof THREE.SkinnedMesh&&r.material&&(r.material.skinning=!!(r.geometry&&r.geometry.bones||[]).length)}),this.load(i)}))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}});function Rn(e){return e?Array.isArray(e)?e:e.materials?e.materials:[e]:[]}function Be(e,t,i,r){!e||(t=t||[],e.traverse(a=>{if(!a.isMesh)return;Rn(a.material).forEach(m=>{m&&!("envMap"in m)||t.length&&t.indexOf(m.name)===-1||(m.envMap=i,m.reflectivity=r,m.needsUpdate=!0)})}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const e=this.data;this.texture=new THREE.CubeTextureLoader().load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE[e.format],this.object3dsetHandler=()=>{const t=this.el.getObject3D("mesh"),i=this.data;Be(t,i.materials,this.texture,i.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){const t=this.data,i=this.el.getObject3D("mesh");let r=[],a=[];if(t.materials.length&&(e.materials?(r=t.materials.filter(h=>!e.materials.includes(h)),a=e.materials.filter(h=>!t.materials.includes(h))):r=t.materials),r.length&&Be(i,r,this.texture,t.reflectivity),a.length&&Be(i,a,null,1),e.materials&&t.reflectivity!==e.reflectivity){const h=t.materials.filter(m=>e.materials.includes(m));h.length&&Be(i,h,this.texture,t.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const e=this.el.getObject3D("mesh"),t=this.data;Be(e,t.materials,null,1),t.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}});AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){const e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){const t=e.detail.el;!t||t.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}});const Cn=-9.8,Sn=-15;AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;const e=this.beginJump.bind(this),t=this.data.on.split(" ");this.bindings={};for(let i=0;i<t.length;i++)this.bindings[t[i]]=e,this.el.addEventListener(t[i],e);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var e in this.bindings)this.bindings.hasOwnProperty(e)&&(this.el.removeEventListener(e,this.bindings[e]),delete this.bindings[e]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){const e=this.data,t=Math.sqrt(-2*e.distance*(Cn+Sn)),i=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:i.x,y:t,z:i.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}});const Gt=1e-6;AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);const e=this.el,t=this.data,i=new CANNON.Vec3().copy(e.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:i,mass:t.mass,linearDamping:t.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(t.radius),new CANNON.Vec3(0,t.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),e.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(e,t){if(!t)return;const i=this.el,r=this.data,a=this.body;r.enableJumps||a.velocity.set(0,0,0),a.position.copy(i.getAttribute("position"))},step:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3;return function(a,h){if(!h)return;let m=this.body,b=this.data,w=!1,C,x=-1/0,N,_=this.system.getContacts();h=Math.min(h,this.system.data.maxInterval*1e3),r.set(0,0,0),e.copy(this.el.getAttribute("velocity")),m.velocity.copy(e);for(var M=0,P;P=_[M];M++)if(!!P.enabled){if(m.id===P.bi.id)P.ni.negate(i);else if(m.id===P.bj.id)i.copy(P.ni);else continue;w=m.velocity.dot(i)<-Gt,w&&i.y<=.5?e.projectOnPlane(i):i.y>.5&&(C=m.id===P.bi.id?Math.abs(P.rj.y+P.bj.position.y):Math.abs(P.ri.y+P.bi.position.y),C>x&&(x=C,r.copy(i),N=m.id===P.bi.id?P.bj:P.bi))}t.copy(e).normalize(),N&&(!b.enableJumps||t.y<.5)?(b.enableSlopes?r.y<1-Gt&&r.copy(this.raycastToGround(N,r)):r.set(0,1,0),e.projectOnPlane(r)):this.system.driver.world&&e.add(this.system.driver.world.gravity.scale(h*4/1e3)),m.velocity.copy(e),this.el.setAttribute("velocity",m.velocity),this.el.setAttribute("position",m.position)}}(),raycastToGround:function(e,t){let i,r,a=this.body.position,h=this.body.position.clone();return i=new CANNON.Ray(a,h),i._updateDirection(),i.intersectBody(e),i.hasHit?(r=i.result.hitNormalWorld,Math.abs(r.y)>Math.abs(t.y)?r:t):t}});AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",e=>{e.detail.model.traverse(t=>{t.isMesh&&t.geometry.computeVertexNormals()})})}});AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(e=>{e.isMesh&&(e.material=this.material)})}});AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){const e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const e=this.data;let t;e.objects?t=this.el.sceneEl.querySelectorAll(e.objects):t=this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Box3,h=new Map;return function(){const m=this.el,b=this.data,w=m.getObject3D("mesh"),C=[];let x;if(!w)return;h.clear(),m.object3D.getWorldPosition(e),m.object3D.getWorldScale(i),x=b.radius*_(i),this.els.forEach(N),C.sort((M,P)=>h.get(M)>h.get(P)?1:-1).forEach(this.handleHit),C.length===0&&m.emit("hit",{el:null}),this.collisions.filter(M=>!h.has(M)).forEach(this.handleHitEnd),this.collisions=C;function N(M){let P,re,he,ne;!M.isEntity||(re=M.getObject3D("mesh"),re&&(a.setFromObject(re).getSize(r),ne=Math.max(r.x,r.y,r.z)/2,P=Math.sqrt(2*ne*ne),a.getCenter(t),P&&(he=e.distanceTo(t),he<P+x&&(C.push(M),h.set(M,he)))))}function _(M){return Math.max.apply(null,M.toArray())}}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.el.emit("hit",{el:e})},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.el.emit("hitend",{el:e})}});AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){const e=this.el.getObject3D("mesh"),t=this.el.sceneEl.object3D;if(!e)return;let i;if(e.traverse(a=>{a.isMesh&&(i=a)}),!i)return;const r=i.geometry.isBufferGeometry?new THREE.Geometry().fromBufferGeometry(i.geometry):i.geometry.clone();t.updateMatrixWorld(),r.applyMatrix(i.matrixWorld),this.system.setNavMeshGeometry(r),this.hasLoadedNavMesh=!0}});AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,a){const h=this.el,m=this.data,b=this.raycaster,w=m.speed*a/1e3;if(!m.active)return;if(!this.path.length){const P=this.el.object3D.position;this.group=this.group||this.system.getGroup(P),this.path=this.system.getPath(P,e.copy(m.destination),this.group)||[],h.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",m.destination),this.el.setAttribute("nav-agent",{active:!1}),h.emit("navigation-end");return}const C=h.object3D.position,x=this.path[0];t.subVectors(x,C);const N=t.length();let _;if(N<w){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),h.emit("navigation-end");return}i.copy(C),_=this.path[0]}else i.copy(t.setLength(w)).add(C),_=x;_.y=C.y,h.object3D.lookAt(_),b.ray.origin.copy(i),b.ray.origin.y+=1.5,b.ray.direction.y=-1;const M=b.intersectObject(this.system.getNavMesh());M.length?(t.subVectors(M[0].point,C),C.add(t.setLength(w))):C.copy(i)}}()});var Q=function(){};Q.computeCentroids=function(e){var t,i,r;for(t=0,i=e.faces.length;t<i;t++)(r=e.faces[t]).centroid=new THREE.Vector3(0,0,0),r.centroid.add(e.vertices[r.a]),r.centroid.add(e.vertices[r.b]),r.centroid.add(e.vertices[r.c]),r.centroid.divideScalar(3)},Q.roundNumber=function(e,t){return Number(e.toFixed(t))},Q.sample=function(e){return e[Math.floor(Math.random()*e.length)]},Q.mergeVertexIds=function(e,t){var i=[];if(e.forEach(function(w){t.indexOf(w)>=0&&i.push(w)}),i.length<2)return[];i.includes(e[0])&&i.includes(e[e.length-1])&&e.push(e.shift()),i.includes(t[0])&&i.includes(t[t.length-1])&&t.push(t.shift()),i=[],e.forEach(function(w){t.includes(w)&&i.push(w)});for(var r=i[1],a=i[0],h=e.slice();h[0]!==r;)h.push(h.shift());for(var m=0,b=t.slice();b[0]!==a;)if(b.push(b.shift()),m++>10)throw new Error("Unexpected state");return b.shift(),b.pop(),h=h.concat(b)},Q.setPolygonCentroid=function(e,t){var i=new THREE.Vector3,r=t.vertices;e.vertexIds.forEach(function(a){i.add(r[a])}),i.divideScalar(e.vertexIds.length),e.centroid.copy(i)},Q.cleanPolygon=function(e,t){for(var i=[],r=t.vertices,a=0;a<e.vertexIds.length;a++){var h,m,b,w=r[e.vertexIds[a]];a===0?(h=e.vertexIds[1],m=e.vertexIds[e.vertexIds.length-1]):a===e.vertexIds.length-1?(h=e.vertexIds[0],m=e.vertexIds[e.vertexIds.length-2]):(h=e.vertexIds[a+1],m=e.vertexIds[a-1]),b=r[m];var C=r[h].clone().sub(w),x=b.clone().sub(w),N=C.angleTo(x);if(N>Math.PI-.01&&N<Math.PI+.01){var _=[];e.neighbours.forEach(function(M){M.vertexIds.includes(e.vertexIds[a])||_.push(M)}),e.neighbours=_}else i.push(e.vertexIds[a])}e.vertexIds=i,this.setPolygonCentroid(e,t)},Q.isConvex=function(e,t){var i=t.vertices;if(e.vertexIds.length<3)return!1;for(var r=!0,a=[],h=0;h<e.vertexIds.length;h++){var m,b,w=i[e.vertexIds[h]];h===0?(m=i[e.vertexIds[1]],b=i[e.vertexIds[e.vertexIds.length-1]]):h===e.vertexIds.length-1?(m=i[e.vertexIds[0]],b=i[e.vertexIds[e.vertexIds.length-2]]):(m=i[e.vertexIds[h+1]],b=i[e.vertexIds[h-1]]);var C=m.clone().sub(w),x=b.clone().sub(w),N=C.angleTo(x);if(N===Math.PI||N===0)return!1;var _=C.cross(x).y;a.push(_)}return a.forEach(function(M){M===0&&(r=!1)}),a.forEach(a[0]>0?function(M){M<0&&(r=!1)}:function(M){M>0&&(r=!1)}),r},Q.distanceToSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,a=e.z-t.z;return i*i+r*r+a*a},Q.isPointInPoly=function(e,t){for(var i=!1,r=-1,a=e.length,h=a-1;++r<a;h=r)(e[r].z<=t.z&&t.z<e[h].z||e[h].z<=t.z&&t.z<e[r].z)&&t.x<(e[h].x-e[r].x)*(t.z-e[r].z)/(e[h].z-e[r].z)+e[r].x&&(i=!i);return i},Q.isVectorInPolygon=function(e,t,i){var r=1e5,a=-1e5,h=[];return t.vertexIds.forEach(function(m){r=Math.min(i[m].y,r),a=Math.max(i[m].y,a),h.push(i[m])}),!!(e.y<a+.5&&e.y>r-.5&&this.isPointInPoly(h,e))},Q.triarea2=function(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)},Q.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5};var Se=function(e){this.content=[],this.scoreFunction=e};Se.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},Se.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},Se.prototype.remove=function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},Se.prototype.size=function(){return this.content.length},Se.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},Se.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,r=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[i]=t,this.content[e]=r,e=i}},Se.prototype.bubbleUp=function(e){for(var t=this.content.length,i=this.content[e],r=this.scoreFunction(i);;){var a=e+1<<1,h=a-1,m=null,b=void 0;if(h<t&&(b=this.scoreFunction(this.content[h]))<r&&(m=h),a<t&&this.scoreFunction(this.content[a])<(m===null?r:b)&&(m=a),m===null)break;this.content[e]=this.content[m],this.content[m]=i,e=m}};var He=function(){};He.init=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}},He.cleanUp=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}},He.heap=function(){return new Se(function(e){return e.f})},He.search=function(e,t,i){this.init(e);var r=this.heap();for(r.push(t);r.size()>0;){var a=r.pop();if(a===i){for(var h=a,m=[];h.parent;)m.push(h),h=h.parent;return this.cleanUp(m),m.reverse()}a.closed=!0;for(var b=this.neighbours(e,a),w=0,C=b.length;w<C;w++){var x=b[w];if(!x.closed){var N=a.g+x.cost,_=x.visited;if(!_||N<x.g){if(x.visited=!0,x.parent=a,!x.centroid||!i.centroid)throw new Error("Unexpected state");x.h=x.h||this.heuristic(x.centroid,i.centroid),x.g=N,x.f=x.g+x.h,_?r.rescoreElement(x):r.push(x)}}}}return[]},He.heuristic=function(e,t){return Q.distanceToSquared(e,t)},He.neighbours=function(e,t){for(var i=[],r=0;r<t.neighbours.length;r++)i.push(e[t.neighbours[r]]);return i};var Mn=1,Le=function(){};Le.buildZone=function(e){var t=this,i=this._buildNavigationMesh(e),r={};i.vertices.forEach(function(m){m.x=Q.roundNumber(m.x,2),m.y=Q.roundNumber(m.y,2),m.z=Q.roundNumber(m.z,2)}),r.vertices=i.vertices;var a=this._buildPolygonGroups(i);r.groups=[];var h=function(m,b){for(var w=0;w<m.length;w++)if(b===m[w])return w};return a.forEach(function(m){var b=[];m.forEach(function(w){var C=w.neighbours.map(function(N){return h(m,N)}),x=w.neighbours.map(function(N){return t._getSharedVerticesInOrder(w,N)});w.centroid.x=Q.roundNumber(w.centroid.x,2),w.centroid.y=Q.roundNumber(w.centroid.y,2),w.centroid.z=Q.roundNumber(w.centroid.z,2),b.push({id:h(m,w),neighbours:C,vertexIds:w.vertexIds,centroid:w.centroid,portals:x})}),r.groups.push(b)}),r},Le._buildNavigationMesh=function(e){return Q.computeCentroids(e),e.mergeVertices(),this._buildPolygonsFromGeometry(e)},Le._buildPolygonGroups=function(e){var t=[],i=0,r=function(a){a.neighbours.forEach(function(h){h.group===void 0&&(h.group=a.group,r(h))})};return e.polygons.forEach(function(a){a.group===void 0&&(a.group=i++,r(a)),t[a.group]||(t[a.group]=[]),t[a.group].push(a)}),t},Le._buildPolygonNeighbours=function(e,t,i){var r=new Set,a=i.get(e.vertexIds[0]),h=i.get(e.vertexIds[1]),m=i.get(e.vertexIds[2]);a.forEach(function(b){(h.has(b)||m.has(b))&&r.add(t.polygons[b])}),h.forEach(function(b){m.has(b)&&r.add(t.polygons[b])}),e.neighbours=Array.from(r)},Le._buildPolygonsFromGeometry=function(e){for(var t=this,i=[],r=e.vertices,a=e.faceVertexUvs,h=new Map,m=0;m<r.length;m++)h.set(m,new Set);e.faces.forEach(function(w){i.push({id:Mn++,vertexIds:[w.a,w.b,w.c],centroid:w.centroid,normal:w.normal,neighbours:[]}),h.get(w.a).add(i.length-1),h.get(w.b).add(i.length-1),h.get(w.c).add(i.length-1)});var b={polygons:i,vertices:r,faceVertexUvs:a};return i.forEach(function(w){t._buildPolygonNeighbours(w,b,h)}),b},Le._getSharedVerticesInOrder=function(e,t){var i=e.vertexIds,r=t.vertexIds,a=new Set;if(i.forEach(function(m){r.includes(m)&&a.add(m)}),a.size<2)return[];a.has(i[0])&&a.has(i[i.length-1])&&i.push(i.shift()),a.has(r[0])&&a.has(r[r.length-1])&&r.push(r.shift());var h=[];return i.forEach(function(m){r.includes(m)&&h.push(m)}),h};var Et=function(){this.portals=[]};Et.prototype.push=function(e,t){t===void 0&&(t=e),this.portals.push({left:e,right:t})},Et.prototype.stringPull=function(){var e,t,i,r=this.portals,a=[],h=0,m=0,b=0;t=r[0].left,i=r[0].right,a.push(e=r[0].left);for(var w=1;w<r.length;w++){var C=r[w].left,x=r[w].right;if(Q.triarea2(e,i,x)<=0){if(!(Q.vequal(e,i)||Q.triarea2(e,t,x)>0)){a.push(t),t=e=t,i=e,m=h=m,b=h,w=h;continue}i=x,b=w}if(Q.triarea2(e,t,C)>=0){if(!(Q.vequal(e,t)||Q.triarea2(e,i,C)<0)){a.push(i),t=e=i,i=e,m=h=b,b=h,w=h;continue}t=C,m=w}}return a.length!==0&&Q.vequal(a[a.length-1],r[r.length-1].left)||a.push(r[r.length-1].left),this.path=a,a};var dt,ft,_e,pt,vt,We,Me=function(){this.zones={}};Me.createZone=function(e){return Le.buildZone(e)},Me.prototype.setZoneData=function(e,t){this.zones[e]=t},Me.prototype.getGroup=function(e,t){if(!this.zones[e])return null;var i=null,r=Math.pow(50,2);return this.zones[e].groups.forEach(function(a,h){a.forEach(function(m){var b=Q.distanceToSquared(m.centroid,t);b<r&&(i=h,r=b)})}),i},Me.prototype.getRandomNode=function(e,t,i,r){if(!this.zones[e])return new THREE.Vector3;i=i||null,r=r||0;var a=[];return this.zones[e].groups[t].forEach(function(h){i&&r?Q.distanceToSquared(i,h.centroid)<r*r&&a.push(h.centroid):a.push(h.centroid)}),Q.sample(a)||new THREE.Vector3},Me.prototype.getClosestNode=function(e,t,i,r){r===void 0&&(r=!1);var a=this.zones[t].vertices,h=null,m=1/0;return this.zones[t].groups[i].forEach(function(b){var w=Q.distanceToSquared(b.centroid,e);w<m&&(!r||Q.isVectorInPolygon(e,b,a))&&(h=b,m=w)}),h},Me.prototype.findPath=function(e,t,i,r){var a=this.zones[i].groups[r],h=this.zones[i].vertices,m=this.getClosestNode(e,i,r),b=this.getClosestNode(t,i,r,!0);if(!m||!b)return null;var w=He.search(a,m,b),C=function(re,he){for(var ne=0;ne<re.neighbours.length;ne++)if(re.neighbours[ne]===he.id)return re.portals[ne]},x=new Et;x.push(e);for(var N=0;N<w.length;N++){var _=w[N+1];if(_){var M=C(w[N],_);x.push(h[M[0]],h[M[1]])}}x.push(t),x.stringPull();var P=x.path.map(function(re){return new THREE.Vector3(re.x,re.y,re.z)});return P.shift(),P},Me.prototype.clampStep=(_e=new THREE.Vector3,pt=new THREE.Plane,vt=new THREE.Triangle,We=new THREE.Vector3,function(e,t,i,r,a,h){var m=this.zones[r].vertices,b=this.zones[r].groups[a],w=[i],C={};C[i.id]=0,dt=void 0,We.set(0,0,0),ft=1/0,pt.setFromCoplanarPoints(m[i.vertexIds[0]],m[i.vertexIds[1]],m[i.vertexIds[2]]),pt.projectPoint(t,_e),t.copy(_e);for(var x=w.pop();x;x=w.pop()){vt.set(m[x.vertexIds[0]],m[x.vertexIds[1]],m[x.vertexIds[2]]),vt.closestPointToPoint(t,_e),_e.distanceToSquared(t)<ft&&(dt=x,We.copy(_e),ft=_e.distanceToSquared(t));var N=C[x];if(!(N>2))for(var _=0;_<x.neighbours.length;_++){var M=b[x.neighbours[_]];M.id in C||(w.push(M),C[M.id]=N+1)}}return h.copy(We),dt});var _n=Object.freeze(Object.defineProperty({__proto__:null,Pathfinding:Me},Symbol.toStringTag,{value:"Module"})),Hn=an(_n);const{Pathfinding:Yt}=Hn,ze=new Yt,je="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),ze.setZoneData(je,Yt.createZone(e)),Array.from(this.agents).forEach(t=>t.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,i){return this.navMesh?ze.findPath(e,t,je,i):null},getGroup:function(e){return this.navMesh?ze.getGroup(je,e):null},getNode:function(e,t){return this.navMesh?ze.getClosestNode(e,je,t,!0):null},clampStep:function(e,t,i,r,a){if(this.navMesh){if(!r)return a.copy(t),this.getNode(t,i)}else return a.copy(t),null;return ze.clampStep(e,t,r,je,i,a)}});AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}});var Qt={exports:{}},k=Qt.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};k.Board=function(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new k.AStarFinder(t),k.Loader.init(),this.setGrid(e)},k.Board.prototype={setEntityOnTile:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e},addTile:function(e){var t=this.tiles.indexOf(e);t===-1&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)},removeTile:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),t!==-1&&this.tiles.splice(t,1),e.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])},getTileAtCell:function(e){var t=this.grid.cellToHash(e);return e.tile||(typeof this.grid.cells[t]!="undefined"?this.grid.cells[t].tile:null)},snapToGrid:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))},snapTileToGrid:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e},getRandomTile:function(){var e=k.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]},findPath:function(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)},setGrid:function(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach(function(t){this.grid.remove(t.cell),t.dispose()}),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)},generateTilemap:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new THREE.Object3D;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},k.Board.prototype.constructor=k.Board,k.Cell=function(e,t,i,r){this.q=e||0,this.r=t||0,this.s=i||0,this.h=r||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=k.LinkedList.generateID()},k.Cell.prototype={set:function(e,t,i){return this.q=e,this.r=t,this.s=i,this},copy:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this},add:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this},equals:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},k.Cell.prototype.constructor=k.Cell,k.HexGrid=function(e){e=e||{},this.type=k.HEX,this.size=5,this.cellSize=typeof e.cellSize=="undefined"?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,i=[];for(t=0;6>t;t++)i.push(this._createVertex(t));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(i[0].x,i[0].y),t=1;6>t;t++)this.cellShape.lineTo(i[t].x,i[t].y);this.cellShape.lineTo(i[0].x,i[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*k.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new k.Cell(1,-1,0),new k.Cell(1,0,-1),new k.Cell(0,1,-1),new k.Cell(-1,1,0),new k.Cell(-1,0,1),new k.Cell(0,-1,1)],this._diagonals=[new k.Cell(2,-1,-1),new k.Cell(1,1,-2),new k.Cell(-1,2,-1),new k.Cell(-2,1,1),new k.Cell(-1,-1,2),new k.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new k.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},k.HexGrid.TWO_THIRDS=2/3,k.HexGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-((e.s-e.r)*this._cellLength*.5),this._vec3},pixelToCell:function(e){var t=e.x*(k.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+k.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel)},getCellAt:function(e){var t=e.x*(k.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+k.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var r,a,h=this._directions.length;for(this._list.length=0,r=0;h>r;r++)this._cel.copy(e),this._cel.add(this._directions[r]),a=this.cells[this.cellToHash(this._cel)],!a||i&&!i(e,a)||this._list.push(a);if(t)for(r=0;h>r;r++)this._cel.copy(e),this._cel.add(this._diagonals[r]),a=this.cells[this.cellToHash(this._cel)],!a||i&&!i(e,a)||this._list.push(a);return this._list},getRandomCell:function(){var e,t=0,i=k.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s},distance:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s));return i+=t.h-e.h},clearPath:function(){var e,t;for(e in this.cells)t=this.cells[e],t._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var r=Math.abs(e.h);1>r&&(r=1);var a=this._geoCache[r];a||(this.extrudeSettings.amount=r,a=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=a);var h=new k.Tile({size:this.cellSize,scale:t,cell:e,geometry:a,material:i});return e.tile=h,h},generateTiles:function(e){e=e||{};var t=[],i={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};i=k.Tools.merge(i,e),this.cellSize=i.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*k.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=i.extrudeSettings;var r,a,h;for(r in this.cells)h=this.cells[r],a=this.generateTile(h,i.tileScale,i.material),a.position.copy(this.cellToPixel(h)),a.position.y=0,t.push(a);return t},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,k.PI/2),t},generate:function(e){e=e||{},this.size=typeof e.size=="undefined"?this.size:e.size;var t,i,r,a;for(t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)r=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(r)<=this.size&&(a=new k.Cell(t,i,r),this.add(a))},generateOverlay:function(e,t,i){var r,a,h,m=this.cellShape.createPointsGeometry();for(r=-e;e+1>r;r++)for(a=-e;e+1>a;a++)if(h=-r-a,Math.abs(r)<=e&&Math.abs(a)<=e&&Math.abs(h)<=e){this._cel.set(r,a,h);var b=new THREE.Line(m,i);b.position.copy(this.cellToPixel(this._cel)),b.rotation.x=90*k.DEG_TO_RAD,t.add(b)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){var r=this;k.Tools.getJSON({url:e,callback:function(a){r.fromJSON(a),t.call(i||null,a)},cache:!1,scope:r})},fromJSON:function(e){var t,i,r=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*k.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<r.length;t++)i=new k.Cell,i.copy(r[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},r=[];for(t in this.cells)e=this.cells[t],r.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=r,i},_createVertex:function(e){var t=k.TAU/6*e;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(e){var t=Math.round(e.q),i=Math.round(e.r),r=Math.round(e.s),a=Math.abs(t-e.q),h=Math.abs(i-e.r),m=Math.abs(r-e.s);return a>h&&a>m?t=-i-r:h>m?i=-t-r:r=-t-i,this._cel.set(t,i,r)}},k.HexGrid.prototype.constructor=k.HexGrid,k.SqrGrid=function(e){e=e||{},this.type=k.SQR,this.size=5,this.cellSize=typeof e.cellSize=="undefined"?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new THREE.Vector3),t.push(new THREE.Vector3(-this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new k.Cell(1,0,0),new k.Cell(0,-1,0),new k.Cell(-1,0,0),new k.Cell(0,1,0)],this._diagonals=[new k.Cell(-1,-1,0),new k.Cell(-1,1,0),new k.Cell(1,1,0),new k.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new k.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},k.SqrGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3},pixelToCell:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)},getCellAt:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var r,a,h=this._directions.length;for(this._list.length=0,r=0;h>r;r++)this._cel.copy(e),this._cel.add(this._directions[r]),a=this.cells[this.cellToHash(this._cel)],!a||i&&!i(e,a)||this._list.push(a);if(t)for(r=0;h>r;r++)this._cel.copy(e),this._cel.add(this._diagonals[r]),a=this.cells[this.cellToHash(this._cel)],!a||i&&!i(e,a)||this._list.push(a);return this._list},getRandomCell:function(){var e,t=0,i=k.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r},distance:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r));return i+=t.h-e.h},clearPath:function(){var e,t;for(e in this.cells)t=this.cells[e],t._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var r=Math.abs(e.h);1>r&&(r=1);var a=this._geoCache[r];a||(this.extrudeSettings.amount=r,a=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=a);var h=new k.Tile({size:this.cellSize,scale:t,cell:e,geometry:a,material:i});return e.tile=h,h},generateTiles:function(e){e=e||{};var t=[],i={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};i=k.Tools.merge(i,e),this.cellSize=i.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=i.extrudeSettings;var r,a,h;for(r in this.cells)h=this.cells[r],a=this.generateTile(h,i.tileScale,i.material),a.position.copy(this.cellToPixel(h)),a.position.y=0,t.push(a);return t},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,k.PI/2),t},generate:function(e){e=e||{},this.size=typeof e.size=="undefined"?this.size:e.size;var t,i,r,a=Math.ceil(this.size/2);for(t=-a;a>t;t++)for(i=-a;a>i;i++)r=new k.Cell(t,i+1),this.add(r)},generateOverlay:function(e,t,i){var r,a,h=Math.ceil(e/2);for(r=-h;h>r;r++)for(a=-h;h>a;a++){this._cel.set(r,a);var m=new THREE.Line(this.cellGeo,i);m.position.copy(this.cellToPixel(this._cel)),m.rotation.x=90*k.DEG_TO_RAD,t.add(m)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){k.Tools.getJSON({url:e,callback:function(r){this.fromJSON(r),t.call(i||null,r)},cache:!1,scope:this})},fromJSON:function(e){var t,i,r=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<r.length;t++)i=new k.Cell,i.copy(r[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},r=[];for(t in this.cells)e=this.cells[t],r.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=r,i}},k.SqrGrid.prototype.constructor=k.SqrGrid,k.Tile=function(e){e=e||{};var t={cell:null,geometry:null,material:null};if(t=k.Tools.merge(t,e),!t.cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=k.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:k.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=k.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*k.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},k.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return this._emissive!==null&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},k.Tile.prototype.constructor=k.Tile,function(){var e=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},t=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]};t.generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},t.prototype={getNode:function(i){return this.objToNodeMap[i.uniqueID]},addNode:function(i){var r=new e;if(!i.uniqueID)try{i.uniqueID=t.generateID()}catch{return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return r.obj=i,r.free=!1,this.objToNodeMap[i.uniqueID]=r,r},swapObjects:function(i,r){this.objToNodeMap[i.obj.uniqueID]=null,this.objToNodeMap[r.uniqueID]=i,i.obj=r},add:function(i){var r=this.objToNodeMap[i.uniqueID];if(r){if(r.free===!1)return;r.obj=i,r.free=!1,r.next=null,r.prev=null}else r=this.addNode(i);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=r,r.prev=this.last,this.last=r,r.next=null}else this.first=r,this.last=r,r.next=null,r.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(i){return!!this.objToNodeMap[i.uniqueID]},moveUp:function(i){this.dump("before move up");var r=this.getNode(i);if(!r)throw"Oops, trying to move an object that isn't in the list";if(r.prev){var a=r.prev,h=a.prev;r==this.last&&(this.last=a);var m=r.next;h&&(h.next=r),r.next=a,r.prev=a.prev,a.next=m,a.prev=r,this.first==a&&(this.first=r)}},moveDown:function(i){var r=this.getNode(i);if(!r)throw"Oops, trying to move an object that isn't in the list";if(r.next){var a=r.next;this.moveUp(a.obj),this.last==a&&(this.last=r)}},sort:function(i){var r,a,h=this.sortArray,m=this.first;for(h.length=0;m;)h.push(m.obj),m=m.next;for(this.clear(),h.sort(i),a=h.length,r=0;a>r;r++)this.add(h[r])},remove:function(i){var r=this.getNode(i);return!r||r.free?!1:(r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),r.prev||(this.first=r.next),r.next||(this.last=r.prev),r.free=!0,r.prev=null,r.next=null,this.length--,!0)},shift:function(){var i=this.first;return this.length===0?null:(i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),this.first=i.next,i.next||(this.last=null),i.free=!0,i.prev=null,i.next=null,this.length--,i.obj)},pop:function(){var i=this.last;return this.length===0?null:(i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),this.last=i.prev,i.prev||(this.first=null),i.free=!0,i.prev=null,i.next=null,this.length--,i.obj)},concat:function(i){for(var r=i.first;r;)this.add(r.obj),r=r.next},clear:function(){for(var i=this.first;i;)i.free=!0,i=i.next;this.first=null,this.length=0},dispose:function(){for(var i=this.first;i;)i.obj=null,i=i.next;this.first=null,this.objToNodeMap=null},dump:function(i){console.log("===================="+i+"=====================");for(var r=this.first;r;)console.log("{"+r.obj.toString()+"} previous="+(r.prev?r.prev.obj:"NULL")),r=r.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}},t.prototype.constructor=t,k.LinkedList=t}(),function(){var e=function(i,r,a,h,m){this._listener=r,this.isOnce=a,this.context=h,this.signal=i,this._priority=m||0};e.prototype={active:!0,params:null,execute:function(i){var r,a;return this.active&&this._listener&&(a=this.params?this.params.concat(i):i,r=this._listener.apply(this.context,a),this.isOnce&&this.detach()),r},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},e.prototype.constructor=e;var t=function(){this._bindings=[],this._prevParams=null;var i=this;this.dispatch=function(){t.prototype.dispatch.apply(i,arguments)}};t.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(i,r){if(typeof i!="function")throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",r))},_registerListener:function(i,r,a,h){var m,b=this._indexOfListener(i,a);if(b!==-1){if(m=this._bindings[b],m.isOnce!==r)throw new Error("You cannot add"+(r?"":"Once")+"() then add"+(r?"Once":"")+"() the same listener without removing the relationship first.")}else m=new e(this,i,r,a,h),this._addBinding(m);return this.memorize&&this._prevParams&&m.execute(this._prevParams),m},_addBinding:function(i){var r=this._bindings.length;do r--;while(this._bindings[r]&&i._priority<=this._bindings[r]._priority);this._bindings.splice(r+1,0,i)},_indexOfListener:function(i,r){for(var a,h=this._bindings.length;h--;)if(a=this._bindings[h],a._listener===i&&a.context===r)return h;return-1},has:function(i,r){return this._indexOfListener(i,r)!==-1},add:function(i,r,a){return this.validateListener(i,"add"),this._registerListener(i,!1,r,a)},addOnce:function(i,r,a){return this.validateListener(i,"addOnce"),this._registerListener(i,!0,r,a)},remove:function(i,r){this.validateListener(i,"remove");var a=this._indexOfListener(i,r);return a!==-1&&(this._bindings[a]._destroy(),this._bindings.splice(a,1)),i},removeAll:function(i){typeof i=="undefined"&&(i=null);for(var r=this._bindings.length;r--;)i?this._bindings[r].context===i&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)):this._bindings[r]._destroy();i||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var i,r=Array.prototype.slice.call(arguments),a=this._bindings.length;if(this.memorize&&(this._prevParams=r),a){i=this._bindings.slice(),this._shouldPropagate=!0;do a--;while(i[a]&&this._shouldPropagate&&i[a].execute(r)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},t.prototype.constructor=t,k.Signal=t}(),k.AStarFinder=function(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=k.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new k.LinkedList},k.AStarFinder.prototype={findPath:function(e,t,i,r){var a,h,m,b,w,C;for(i=i||this.heuristicFilter,r.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),a=this.list.shift(),a._visited=!0,a===t)return k.PathUtil.backtrace(t);for(m=r.getNeighbors(a,this.allowDiagonal,i),w=0,C=m.length;C>w;w++)if(b=m[w],b.walkable&&(h=a._calcCost+r.distance(a,b),!b._visited||h<b._calcCost)){if(b._visited=!0,b._parent=a,b._calcCost=h,b._priority=h+r.distance(t,b),b===t)return k.PathUtil.backtrace(t);this.list.add(b)}}return null},compare:function(e,t){return e._priority-t._priority}},k.AStarFinder.prototype.constructor=k.AStarFinder,k.PathUtil={backtrace:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()},biBacktrace:function(e,t){var i=this.backtrace(e),r=this.backtrace(t);return i.concat(r.reverse())},pathLength:function(e){var t,i,r,a,h,m=0;for(t=1;t<e.length;++t)i=e[t-1],r=e[t],a=i[0]-r[0],h=i[1]-r[1],m+=Math.sqrt(a*a+h*h);return m},interpolate:function(e,t,i,r){var a,h,m,b,w,C,x=Math.abs,N=[];for(m=x(i-e),b=x(r-t),a=i>e?1:-1,h=r>t?1:-1,w=m-b;e!==i||t!==r;)N.push([e,t]),C=2*w,C>-b&&(w-=b,e+=a),m>C&&(w+=m,t+=h);return N},expandPath:function(e){var t,i,r,a,h,m,b=[],w=e.length;if(2>w)return b;for(h=0;w-1>h;++h)for(t=e[h],i=e[h+1],r=this.interpolate(t[0],t[1],i[0],i[1]),a=r.length,m=0;a-1>m;++m)b.push(r[m]);return b.push(e[w-1]),b},smoothenPath:function(e,t){var i,r,a,h,m,b,w,C,x,N,_,M,P=t.length,re=t[0][0],he=t[0][1],ne=t[P-1][0],me=t[P-1][1];for(i=re,r=he,m=[[i,r]],w=2;P>w;++w){for(x=t[w],a=x[0],h=x[1],N=this.interpolate(i,r,a,h),M=!1,C=1;C<N.length;++C)if(_=N[C],!e.isWalkableAt(_[0],_[1])){M=!0;break}M&&(b=t[w-1],m.push(b),i=b[0],r=b[1])}return m.push([ne,me]),m},compressPath:function(e){if(e.length<3)return e;var t,i,r,a,h,m,b=[],w=e[0][0],C=e[0][1],x=e[1][0],N=e[1][1],_=x-w,M=N-C;for(h=Math.sqrt(_*_+M*M),_/=h,M/=h,b.push([w,C]),m=2;m<e.length;m++)t=x,i=N,r=_,a=M,x=e[m][0],N=e[m][1],_=x-t,M=N-i,h=Math.sqrt(_*_+M*M),_/=h,M/=h,(_!==r||M!==a)&&b.push([t,i]);return b.push([x,N]),b}},k.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new THREE.LoadingManager(function(){},function(){},function(){console.warn("Error loading images")}),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,r){var a=new THREE.Texture(null,t);return this.imageLoader.load(e,function(h){a.image=h,a.needsUpdate=!0,i&&i(a)},null,function(h){r&&r(h)}),a.sourceFile=e,a}},k.MouseCaster=function(e,t,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new k.Signal,this.group=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,i=i||document,i.addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},k.MouseCaster.OVER="over",k.MouseCaster.OUT="out",k.MouseCaster.DOWN="down",k.MouseCaster.UP="up",k.MouseCaster.CLICK="click",k.MouseCaster.WHEEL="wheel",k.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(e=i[0],t=e.object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch(k.MouseCaster.OUT,this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch(k.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(k.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(e){return e=e||window.event,e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=e.which===1,this.rightDown=e.which===3,void this.signal.dispatch(k.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(e){return e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch(k.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(k.MouseCaster.CLICK,this.pickedObject),this.down=e.which===1?!1:this.down,void(this.rightDown=e.which===3?!1:this.rightDown))},_onDocumentMouseMove:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=2*-(e.clientY/window.innerHeight)+1},_onMouseWheel:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta!==void 0?t=e.wheelDelta:e.detail!==void 0&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch(k.MouseCaster.WHEEL,this.wheel)}}},k.MouseCaster.prototype.constructor=k.MouseCaster,k.Scene=function(e,t){var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},r={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(i=k.Tools.merge(i,e),typeof t!="boolean"&&(r=k.Tools.merge(r,t)),this.renderer=new THREE.WebGLRenderer({alpha:i.alpha,antialias:i.antialias}),this.renderer.setClearColor(i.clearColor,0),this.renderer.sortObjects=i.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=i.orthoZoom,this.container=new THREE.Scene,this.container.fog=i.fog,this.container.add(new THREE.AmbientLight(14540253)),i.lightPosition||i.light.position.set(-1,1,-1).normalize(),this.container.add(i.light),i.cameraType==="OrthographicCamera"){var a=window.innerWidth/this.orthoZoom,h=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(a/-2,a/2,h/2,h/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=r.minDistance,this.controls.maxDistance=r.maxDistance,this.controls.zoomSpeed=r.zoomSpeed,this.controls.noZoom=r.noZoom),i.cameraPosition&&this.camera.position.copy(i.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,this.camera.type==="OrthographicCamera"){var m=this.width/this.orthoZoom,b=this.height/this.orthoZoom;this.camera.left=m/-2,this.camera.right=m/2,this.camera.top=b/2,this.camera.bottom=b/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(i.element)},k.Scene.prototype={attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)return void(this.orthoZoom=0);var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()},focusOn:function(e){this.camera.lookAt(e.position)}},k.Scene.prototype.constructor=k.Scene,k.SelectionManager=function(e){this.mouse=e,this.onSelect=new k.Signal,this.onDeselect=new k.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},k.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case k.MouseCaster.DOWN:t||this.clearSelection();break;case k.MouseCaster.CLICK:this.select(t)}}},k.SelectionManager.prototype.constructor=k.SelectionManager,k.Tools={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return arguments.length===1?Math.random()*e-.5*e:Math.random()*(t-e)+e},randomInt:function(e,t){return arguments.length===1?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return e%=this.TAU,e>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if(typeof e!="object"||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},merge:function(e,t){var i=this,r=Array.isArray(t),a=r&&[]||{};return r?(e=e||[],a=a.concat(e),t.forEach(function(h,m){typeof a[m]=="undefined"?a[m]=h:i.isPlainObject(h)?a[m]=i.merge(e[m],h):e.indexOf(h)===-1&&a.push(h)}),a):(e&&i.isPlainObject(e)&&Object.keys(e).forEach(function(h){a[h]=e[h]}),Object.keys(t).forEach(function(h){t[h]&&i.isPlainObject(t[h])&&e[h]?a[h]=i.merge(e[h],t[h]):a[h]=t[h]}),a)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,r){if(t=t||0,i=i||e.length,r=r||31,!(t>=i-1||0>r)){for(var a=t,h=i,m=1<<r;h>a;)if(e[a]&m){--h;var b=e[a];e[a]=e[h],e[h]=b}else++a;this.radixSort(e,t,h,r-1),this.radixSort(e,h,i,r-1)}},randomizeRGB:function(e,t){var i,r,a=e.split(","),h="rgb(";for(t=this.randomInt(t),i=0;3>i;i++)r=parseInt(a[i])+t,0>r?r=0:r>255&&(r=255),h+=r+",";return h=h.substring(0,h.length-1),h+=")"},getJSON:function(e){var t=new XMLHttpRequest,i=typeof e.cache=="undefined"?!1:e.cache,r=i?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(this.status===200){var a=null;try{a=JSON.parse(this.responseText)}catch{return}return void e.callback.call(e.scope||null,a)}this.status!==0&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url)},t.open("GET",r,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}};var Ln={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]};const Ut=Qt.exports,On=Ln;AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}});AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){const e=this.data;e.src?fetch(e.src).then(t=>t.json()).then(t=>this.addMesh(t)):this.addMesh(On)},addMesh:function(e){const t=new Ut.HexGrid;t.fromJSON(e);const i=new Ut.Board(t);i.generateTilemap(),this.el.setObject3D("mesh",i.group),this.addMaterial()},addMaterial:function(){const t=(this.el.components.material||{}).material;!t||this.el.object3D.traverse(i=>{i.isMesh&&(i.material=t)})},remove:function(){this.el.removeObject3D("mesh")}});AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}});AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const e=this.el,t=this.data;let i=e.components.material;const r=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);r.mergeVertices(),this.waves=[];for(let a,h=0,m=r.vertices.length;h<m;h++)a=r.vertices[h],this.waves.push({z:a.z,ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});i||(i={},i.material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(r,i.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(!t)return;const i=this.mesh.geometry.vertices;for(let r,a,h=0;r=i[h];h++)a=this.waves[h],r.z=a.z+Math.sin(a.ang)*a.amp,a.ang+=a.speed*t;this.mesh.geometry.verticesNeedUpdate=!0}});AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}});AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const e=this.el,t=this.data;let i=e.components.material;if(!t.path.length){console.error("[a-tube] `path` property expected but not found.");return}const r=new THREE.CatmullRomCurve3(t.path.map(function(h){return h=h.split(" "),new THREE.Vector3(Number(h[0]),Number(h[1]),Number(h[2]))})),a=new THREE.TubeGeometry(r,t.segments,t.radius,t.radialSegments,t.closed);i||(i={},i.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(a,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){!Object.keys(e).length||(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}});function Dn(e){let t;return{c(){t=Yi("Slide me")},l(i){t=Qi(i,"Slide me")},m(i,r){Ye(i,t,r)},d(i){i&&Oe(t)}}}function Nn(e){let t,i,r,a,h,m,b;const w=e[5].default,C=qi(w,e,e[4],null),x=C||Dn();return{c(){t=Ze("div"),i=Ze("div"),x&&x.c(),r=Zt(),a=Ze("input"),this.h()},l(N){t=Je(N,"DIV",{class:!0});var _=mt(t);i=Je(_,"DIV",{class:!0});var M=mt(i);x&&x.l(M),M.forEach(Oe),r=Jt(_),a=Je(_,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),_.forEach(Oe),this.h()},h(){ye(i,"class","svelte-19nugep"),ye(a,"type","range"),ye(a,"min",e[1]),ye(a,"max",e[2]),ye(a,"step",e[3]),ye(a,"class","svelte-19nugep"),ye(t,"class","slider svelte-19nugep")},m(N,_){Ye(N,t,_),ct(t,i),x&&x.m(i,null),ct(t,r),ct(t,a),Ft(a,e[0]),h=!0,m||(b=[Pt(a,"change",e[6]),Pt(a,"input",e[6])],m=!0)},p(N,[_]){C&&C.p&&(!h||_&16)&&Xi(C,w,N,N[4],h?Zi(w,N[4],_,null):Wi(N[4]),null),(!h||_&2)&&ye(a,"min",N[1]),(!h||_&4)&&ye(a,"max",N[2]),(!h||_&8)&&ye(a,"step",N[3]),_&1&&Ft(a,N[0])},i(N){h||(gt(x,N),h=!0)},o(N){yt(x,N),h=!1},d(N){N&&Oe(t),x&&x.d(N),m=!1,Ji(b)}}}function Fn(e,t,i){let{$$slots:r={},$$scope:a}=t,{value:h=0}=t,{from:m=-180}=t,{to:b=180}=t,{step:w=10}=t;function C(){h=$i(this.value),i(0,h)}return e.$$set=x=>{"value"in x&&i(0,h=x.value),"from"in x&&i(1,m=x.from),"to"in x&&i(2,b=x.to),"step"in x&&i(3,w=x.step),"$$scope"in x&&i(4,a=x.$$scope)},[h,m,b,w,a,r,C]}class Pn extends qt{constructor(t){super(),Xt(this,t,Fn,Nn,Wt,{value:0,from:1,to:2,step:3})}}function In(e){let t,i,r,a,h,m;t=new rn({props:{rotation:e[0]}});function b(C){e[1](C)}let w={from:-200,to:200,step:10};return e[0]!==void 0&&(w.value=e[0]),a=new Pn({props:w}),en.push(()=>tn(a,"value",b)),{c(){It(t.$$.fragment),i=Zt(),r=Ze("div"),It(a.$$.fragment),this.h()},l(C){Bt(t.$$.fragment,C),i=Jt(C),r=Je(C,"DIV",{class:!0});var x=mt(r);Bt(a.$$.fragment,x),x.forEach(Oe),this.h()},h(){ye(r,"class","rotationSlider svelte-1vq9x5a")},m(C,x){zt(t,C,x),Ye(C,i,x),Ye(C,r,x),zt(a,r,null),m=!0},p(C,[x]){const N={};x&1&&(N.rotation=C[0]),t.$set(N);const _={};!h&&x&1&&(h=!0,_.value=C[0],nn(()=>h=!1)),a.$set(_)},i(C){m||(gt(t.$$.fragment,C),gt(a.$$.fragment,C),m=!0)},o(C){yt(t.$$.fragment,C),yt(a.$$.fragment,C),m=!1},d(C){jt(t,C),C&&Oe(i),C&&Oe(r),jt(a)}}}function Bn(e,t,i){let r=0;function a(h){r=h,i(0,r)}return[r,a]}class Qn extends qt{constructor(t){super(),Xt(this,t,Bn,In,Wt,{})}}export{Qn as default};
