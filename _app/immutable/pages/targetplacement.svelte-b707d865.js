import{S as F,i as L,s as q,w as S,x as T,y as E,E as B,q as g,o as h,B as C,J as W,e as D,t as N,k as G,c as M,a as V,h as Y,d,m as O,b as j,g as y,K as H,W as te,X as ne,V as re,l as U,n as X,p as J,f as le,j as ie}from"../chunks/index-f5ab8554.js";import{N as ce,B as K,d as ue,e as se}from"../chunks/NavigationButton-b53e688f.js";import{P as fe}from"../chunks/P5-2f08eded.js";import{t as R,a as oe,D as Z,c as me}from"../chunks/contourLineStore-53888272.js";import"../chunks/@vite-plugin-wasm-pack@wasm-15893286.js";import{d as ae}from"../chunks/difficultyStore-a47291fd.js";import{P as _e}from"../chunks/Page-c2ee491c.js";import{M as de}from"../chunks/Modal-ce439227.js";import"../chunks/preload-helper-60cab3ee.js";import"../chunks/index-bcbe7d6b.js";function ge(a){let t,n;return t=new fe({props:{sketch:a[0]}}),{c(){S(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,r){E(t,e,r),n=!0},p:B,i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){h(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function he(a,t,n){let e,r,l;W(a,R,o=>n(5,e=o)),W(a,ae,o=>n(6,r=o)),W(a,oe,o=>n(7,l=o));let{foregroundWidth:f}=t,{foregroundHeight:i}=t,{targetSelected:s}=t,{curves:c}=t;function u(o){o.setup=()=>{o.createCanvas(f,i)},o.draw=()=>{o.background(230),o.stroke(30),c.forEach(p=>{o.strokeWeight(4),o.noFill(),o.beginShape();for(let[m,$]of p)o.vertex(m,$);o.endShape(o.CLOSE)});const b=l!=null?l:[];for(let p of l){o.strokeWeight(1),o.stroke("#f2682c");const[m,$]=p;o.fill("#f2682c"),o.ellipse(m,$,50,50),o.noFill(),o.strokeWeight(.5),o.ellipse(m,$,r.min_crater_distance*2,r.min_crater_distance*2)}let k=20;for(let p=0;p<e.length;p++){let m=e[p];m.update(o,b,r.min_crater_distance,e,r.min_steam_turbine_separation,p),m.drawCircle(o,k,p+1)}let w="";if(e.length!=r.min_steam_turbines&&r.min_steam_turbines==r.max_steam_turbines?w="You must place exactly "+r.min_steam_turbines+" steam turbines":e.length<r.min_steam_turbines?w="You must place at least "+r.min_steam_turbines+" steam turbines":e.length==r.max_steam_turbines&&(w="You have reached the maximal amount of "+r.max_steam_turbines+" steam turbines"),e.length<r.min_steam_turbines||e.length>=r.max_steam_turbines){o.noStroke(),o.fill(51),o.textSize(15),o.textAlign(o.CENTER);let p=o.textWidth(w);o.rectMode(o.CENTER),o.rect(o.width/2,60,p+10,30),o.strokeWeight(1),o.fill(255),o.text(w,o.width/2,65)}},o.mousePressed=()=>{if(!(e!=null&&e.length))return;let b=!1;for(let k=0;k<e.length;k++){let w=!1;e[k].deselect(),b||(w=e[k].pressed(o),b=w),w&&n(1,s=k)}},o.mouseReleased=()=>{if(!!(e!=null&&e.length)){for(let b of e)b.released();R.set(e)}}}return a.$$set=o=>{"foregroundWidth"in o&&n(2,f=o.foregroundWidth),"foregroundHeight"in o&&n(3,i=o.foregroundHeight),"targetSelected"in o&&n(1,s=o.targetSelected),"curves"in o&&n(4,c=o.curves)},[u,s,f,i,c]}class be extends F{constructor(t){super(),L(this,t,he,ge,q,{foregroundWidth:2,foregroundHeight:3,targetSelected:1,curves:4})}}function pe(a){let t,n,e,r,l,f;return{c(){t=D("div"),n=D("h2"),e=N("Instructions"),r=G(),l=D("div"),f=N(`Add targets where you think the lava will flow. You can't place targets too close to 
		the craters or too close to other targets. How close you can place targets to craters
		and other targets depends on the difficulty mode you selected. There is also a minimum
		amount of targets you need to place, which also depends on your difficulty mode. You
		can never place more than 10 targets.`),this.h()},l(i){t=M(i,"DIV",{class:!0});var s=V(t);n=M(s,"H2",{});var c=V(n);e=Y(c,"Instructions"),c.forEach(d),r=O(s),l=M(s,"DIV",{class:!0});var u=V(l);f=Y(u,`Add targets where you think the lava will flow. You can't place targets too close to 
		the craters or too close to other targets. How close you can place targets to craters
		and other targets depends on the difficulty mode you selected. There is also a minimum
		amount of targets you need to place, which also depends on your difficulty mode. You
		can never place more than 10 targets.`),u.forEach(d),s.forEach(d),this.h()},h(){j(l,"class","instruction"),j(t,"class","instructions svelte-tryer5")},m(i,s){y(i,t,s),H(t,n),H(n,e),H(t,r),H(t,l),H(l,f)},p:B,i:B,o:B,d(i){i&&d(t)}}}class $e extends F{constructor(t){super(),L(this,t,null,pe,q,{})}}function ke(a){let t,n;return t=new $e({}),{c(){S(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,r){E(t,e,r),n=!0},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){h(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function ee(a){let t,n,e,r;function l(i){a[11](i)}let f={foregroundHeight:a[14],foregroundWidth:a[15],curves:a[4].curves};return a[0]!==void 0&&(f.targetSelected=a[0]),n=new be({props:f}),te.push(()=>ne(n,"targetSelected",l)),{c(){t=D("div"),S(n.$$.fragment),this.h()},l(i){t=M(i,"DIV",{class:!0});var s=V(t);T(n.$$.fragment,s),s.forEach(d),this.h()},h(){j(t,"class","sketch svelte-xj8132")},m(i,s){y(i,t,s),E(n,t,null),r=!0},p(i,s){const c={};s&16384&&(c.foregroundHeight=i[14]),s&32768&&(c.foregroundWidth=i[15]),s&16&&(c.curves=i[4].curves),!e&&s&1&&(e=!0,c.targetSelected=i[0],re(()=>e=!1)),n.$set(c)},i(i){r||(g(n.$$.fragment,i),r=!0)},o(i){h(n.$$.fragment,i),r=!1},d(i){i&&d(t),C(n)}}}function ve(a){var r;let t,n,e=((r=a[4])==null?void 0:r.curves)&&a[2]&&a[3]&&ee(a);return{c(){e&&e.c(),t=U()},l(l){e&&e.l(l),t=U()},m(l,f){e&&e.m(l,f),y(l,t,f),n=!0},p(l,f){var i;((i=l[4])==null?void 0:i.curves)&&l[2]&&l[3]?e?(e.p(l,f),f&28&&g(e,1)):(e=ee(l),e.c(),g(e,1),e.m(t.parentNode,t)):e&&(X(),h(e,1,1,()=>{e=null}),J())},i(l){n||(g(e),n=!0)},o(l){h(e),n=!1},d(l){e&&e.d(l),l&&d(t)}}}function ye(a){let t;return{c(){t=D("div"),this.h()},l(n){t=M(n,"DIV",{slot:!0,style:!0}),V(t).forEach(d),this.h()},h(){j(t,"slot","background"),le(t,"background","#aaa")},m(n,e){y(n,t,e)},p:B,d(n){n&&d(t)}}}function we(a){let t,n;return t=new ce({props:{back:!0,to:"/scan/mapscanning",$$slots:{default:[Te]},$$scope:{ctx:a}}}),{c(){S(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,r){E(t,e,r),n=!0},p(e,r){const l={};r&65536&&(l.$$scope={dirty:r,ctx:e}),t.$set(l)},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){h(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function Se(a){let t,n,e,r,l;const f=[Ce,Ee],i=[];function s(u,o){return u[0]!=-1&&u[3].length>u[2].min_steam_turbines?0:u[3].length>0?1:-1}~(t=s(a))&&(n=i[t]=f[t](a));function c(){return a[10](a[15],a[14])}return r=new K({props:{icon:ue,$$slots:{default:[We]},$$scope:{ctx:a}}}),r.$on("click",c),{c(){n&&n.c(),e=G(),S(r.$$.fragment)},l(u){n&&n.l(u),e=O(u),T(r.$$.fragment,u)},m(u,o){~t&&i[t].m(u,o),y(u,e,o),E(r,u,o),l=!0},p(u,o){a=u;let b=t;t=s(a),t===b?~t&&i[t].p(a,o):(n&&(X(),h(i[b],1,1,()=>{i[b]=null}),J()),~t?(n=i[t],n?n.p(a,o):(n=i[t]=f[t](a),n.c()),g(n,1),n.m(e.parentNode,e)):n=null);const k={};o&65536&&(k.$$scope={dirty:o,ctx:a}),r.$set(k)},i(u){l||(g(n),g(r.$$.fragment,u),l=!0)},o(u){h(n),h(r.$$.fragment,u),l=!1},d(u){~t&&i[t].d(u),u&&d(e),C(r,u)}}}function Te(a){let t;return{c(){t=N("No image found. Go to map scanning")},l(n){t=Y(n,"No image found. Go to map scanning")},m(n,e){y(n,t,e)},d(n){n&&d(t)}}}function Ee(a){let t,n;return t=new K({props:{secondary:!0,icon:se,$$slots:{default:[Pe]},$$scope:{ctx:a}}}),t.$on("click",a[7]),{c(){S(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,r){E(t,e,r),n=!0},p(e,r){const l={};r&65536&&(l.$$scope={dirty:r,ctx:e}),t.$set(l)},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){h(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function Ce(a){let t,n;return t=new K({props:{secondary:!0,icon:se,$$slots:{default:[Ie]},$$scope:{ctx:a}}}),t.$on("click",a[6]),{c(){S(t.$$.fragment)},l(e){T(t.$$.fragment,e)},m(e,r){E(t,e,r),n=!0},p(e,r){const l={};r&65537&&(l.$$scope={dirty:r,ctx:e}),t.$set(l)},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){h(t.$$.fragment,e),n=!1},d(e){C(t,e)}}}function Pe(a){let t;return{c(){t=N("Clear all steam turbines")},l(n){t=Y(n,"Clear all steam turbines")},m(n,e){y(n,t,e)},d(n){n&&d(t)}}}function Ie(a){let t,n=a[0]+1+"",e;return{c(){t=N("Remove steam turbine "),e=N(n)},l(r){t=Y(r,"Remove steam turbine "),e=Y(r,n)},m(r,l){y(r,t,l),y(r,e,l)},p(r,l){l&1&&n!==(n=r[0]+1+"")&&ie(e,n)},d(r){r&&d(t),r&&d(e)}}}function We(a){let t;return{c(){t=N("Add steam turbine")},l(n){t=Y(n,"Add steam turbine")},m(n,e){y(n,t,e)},d(n){n&&d(t)}}}function Ne(a){let t,n,e,r;const l=[Se,we],f=[];function i(s,c){return s[4]?0:1}return n=i(a),e=f[n]=l[n](a),{c(){t=D("div"),e.c(),this.h()},l(s){t=M(s,"DIV",{slot:!0});var c=V(t);e.l(c),c.forEach(d),this.h()},h(){j(t,"slot","footer")},m(s,c){y(s,t,c),f[n].m(t,null),r=!0},p(s,c){let u=n;n=i(s),n===u?f[n].p(s,c):(X(),h(f[u],1,1,()=>{f[u]=null}),J(),e=f[n],e?e.p(s,c):(e=f[n]=l[n](s),e.c()),g(e,1),e.m(t,null))},i(s){r||(g(e),r=!0)},o(s){h(e),r=!1},d(s){s&&d(t),f[n].d()}}}function Ye(a){let t,n,e,r,l;function f(s){a[9](s)}let i={title:"transformation instructions",closeButtons:"top",$$slots:{default:[ke]},$$scope:{ctx:a}};return a[1]!==void 0&&(i.visible=a[1]),t=new de({props:i}),te.push(()=>ne(t,"visible",f)),r=new _e({props:{title:"Placing steam turbines",$$slots:{footer:[Ne,({foregroundHeight:s,foregroundWidth:c})=>({14:s,15:c}),({foregroundHeight:s,foregroundWidth:c})=>(s?16384:0)|(c?32768:0)],background:[ye,({foregroundHeight:s,foregroundWidth:c})=>({14:s,15:c}),({foregroundHeight:s,foregroundWidth:c})=>(s?16384:0)|(c?32768:0)],default:[ve,({foregroundHeight:s,foregroundWidth:c})=>({14:s,15:c}),({foregroundHeight:s,foregroundWidth:c})=>(s?16384:0)|(c?32768:0)]},$$scope:{ctx:a}}}),{c(){S(t.$$.fragment),e=G(),S(r.$$.fragment)},l(s){T(t.$$.fragment,s),e=O(s),T(r.$$.fragment,s)},m(s,c){E(t,s,c),y(s,e,c),E(r,s,c),l=!0},p(s,[c]){const u={};c&65536&&(u.$$scope={dirty:c,ctx:s}),!n&&c&2&&(n=!0,u.visible=s[1],re(()=>n=!1)),t.$set(u);const o={};c&114717&&(o.$$scope={dirty:c,ctx:s}),r.$set(o)},i(s){l||(g(t.$$.fragment,s),g(r.$$.fragment,s),l=!0)},o(s){h(t.$$.fragment,s),h(r.$$.fragment,s),l=!1},d(s){C(t,s),s&&d(e),C(r,s)}}}function De(a,t,n){let e,r,l,f;W(a,ae,m=>n(2,e=m)),W(a,R,m=>n(3,r=m)),W(a,oe,m=>n(12,l=m)),W(a,me,m=>n(4,f=m));let i=-1,s=!1;function c(m,$,x,Q){if(r.length>=e.max_steam_turbines)return;const _=new Z(m,$,20);_.enableSelection();for(let P of r)for(;_.isTooCloseTo(P.x,P.y,e.min_steam_turbine_separation);){let I=_.x-P.x,v=_.y-P.y;I==0&&(I=.001),v==0&&(v=.001),_.x+=I,_.y+=v}let A=!1,z=_;for(;;){A=!1,(_.x<=0||_.x>=x||_.y<=0||_.y>=Q)&&(_.x=20+Math.random()*(x-40),_.y=20+Math.random()*(Q-40));for(let v of r)_.isTooCloseTo(v.x,v.y,e.min_steam_turbine_separation)&&(A=!0,z=v);for(let v of l)_.isTooCloseTo(v[0],v[1],e.min_crater_distance)&&(A==!1&&(z=new Z(v[0],v[1],20)),A=!0);if(!A)break;let P=_.x-z.x,I=_.y-z.y;P==0&&(P=.001),I==0&&(I=.001),_.x+=P,_.y+=I}R.add(_)}function u(){i!=-1&&(R.remove(i),n(0,i=-1))}function o(){for(let m=r.length-1;m>=0;m--)n(0,i=m),u()}function b(m,$){let x=!1;for(;r.length<e.min_steam_turbines;)c(m/8,$/8,m,$),x=!0;return x}function k(m){s=m,n(1,s)}const w=(m,$)=>{b(m,$-100)||c(m/8,$/8,m,$-100)};function p(m){i=m,n(0,i)}return[i,s,e,r,f,c,u,o,b,k,w,p]}class Le extends F{constructor(t){super(),L(this,t,De,Ye,q,{})}}export{Le as default};
